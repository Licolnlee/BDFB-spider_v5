/* 未能缩小。正在返回未缩小的内容。
(3558,4721-4727): run-time error JS1300: Strict-mode does not allow assignment to undefined variables: Base64
 */


$.fn.extend({
    //下拉菜单
    dropDowm: function () {
        var me = $(this);
        me.mouseover(function () {
            //alert($(this).html())
            if ($(this).children('.drop-down-list').text().length > 0) {
                //alert(list.html())
                $(this).addClass('active');
                //$(this).parents().css({
                //    position: 'relative',
                //    zIndex: 1000
                //});

                //导航更多小红点
                var showCookie = getCookie("redSpot");
                if (showCookie == null) {

                    var cookietime = new Date();
                    cookietime.setTime(cookietime.getTime() + (24 * 60 * 60 * 1000)); //coockie保存24小时
                    document.cookie = "redSpot=false;expires=" + cookietime.toGMTString();
                };

                var redSpot = $("#redSpot");
                if (redSpot.length > 0) {
                    redSpot.hide();
                }
            };
        });
        me.mouseout(function () {
            if ($(this).children('.drop-down-list').text().length > 0) {
                $(this).removeClass('active');
                //$(this).parents().css({
                //    //position: 'static',
                //    zIndex: 0
                //});
            }
        });
    },
    //模拟下拉
    Jselect: function () {
        var me = $(this);
        var dl = $(this).find("dl");
        var span = me.find("h4");
        var text = dl.find('dd[title]').eq(0).attr('title');

        if (dl.children('.currentSelect').text() == '全部' || dl.children('.currentSelect').text() == 'All') {
            span.text(text);
        } else {
            span.text(dl.children('.currentSelect').text());
        }

        //鼠标离开内容区域隐藏内容
        $(this).hover(function () {
            $(this).addClass('current');
            $(this).siblings().removeClass('current');
            span.html(text);//鼠标经过时title显示默认项内容
        }, function () {
            me.removeClass("current");
            if (dl.children('.currentSelect').text() == '全部' || dl.children('.currentSelect').text() == 'All') {
                span.text(text);
            } else {
                span.html(dl.children('.currentSelect').text());
            }
        })
        dl.children().click(function () {
            span.html($(this).text());
            $(this).addClass('currentSelect').siblings().removeClass('currentSelect');
            me.removeClass('current');
            if (dl.children('.currentSelect').text() == '全部' || dl.children('.currentSelect').text() == 'All') {
                span.text(text);
            }
        })
    },

    //跟随页面滚动
    smartFloat: function () {
        if ($(window).scrollTop() > $(this).position().top) {
            $(this).css({
                position: "fixed",
                top: 0
            });
        }
        var position = function (element) {
            var top = element.position().top, pos = element.css("position");
            $(window).scroll(function () {
                var scrolls = $(this).scrollTop();
                if (scrolls > top) {
                    if (window.XMLHttpRequest) {
                        element.css({
                            position: "fixed",
                            top: 0
                        });
                    } else {
                        element.css({
                            position: "absolute",
                            top: scrolls
                        });
                    }
                } else {
                    element.css({
                        position: "relative"
                    });
                }
            });
        }

        return $(this).each(function () {
            position($(this));
        });
    },

    //返回顶部
    returnTop: function () {
        var me = $(this);
        var meC = me.find('.gotop');

        var position = function () {
            if ($(window).width() == $('.container').width() || ($(window).width() - $('.container').width()) / 2 < me.width()) {
                me.css({
                    right: $(window).width() - $('.container').width() - ($(window).width() - $('.container').width()) / 2
                });
            } else {
                me.css({
                    right: $(window).width() - $('.container').width() - ($(window).width() - $('.container').width()) / 2 - me.width()
                });
            }
        }
        $(window).resize(function () {
            position(me);
        });
        position(me);

        $(window).on('scroll', function () {
            var st = $(window).scrollTop();
            if (st > 100) {
                meC.show('linear');
            } else {
                meC.hide('linear');
            }
        });
        meC.on('click', function () {
            $('html,body').animate({ 'scrollTop': 0 }, 500);
        });
    },

    //子元素scroll父元素容器不跟随滚动JS实现
    scrollUnique: function () {
        return $(this).each(function () {
            var eventType = 'mousewheel';
            // 火狐是DOMMouseScroll事件
            if (document.mozHidden !== undefined) {
                eventType = 'DOMMouseScroll';
            }
            $(this).on(eventType, function (event) {
                // 一些数据
                var scrollTop = this.scrollTop,
                    scrollHeight = this.scrollHeight,
                    height = this.clientHeight;

                var delta = (event.originalEvent.wheelDelta) ? event.originalEvent.wheelDelta : -(event.originalEvent.detail || 0);

                if ((delta > 0 && scrollTop <= delta) || (delta < 0 && scrollHeight - height - scrollTop <= -1 * delta)) {
                    // IE浏览器下滚动会跨越边界直接影响父级滚动，因此，临界时候手动边界滚动定位
                    this.scrollTop = delta > 0 ? 0 : scrollHeight;
                    // 向上滚 || 向下滚
                    event.preventDefault();
                }
            });
        });
    },

    //页顶导航判断浏览器宽度重新设置栏目导航间距
    columnMarginLeft: function () {
        var me = $(this);
        if ($(window).width() < 1024) {
            me.addClass('main-nav-1000');
        }
    },
    //列表页筛选条件判断分辨率大小及数量是否超过3个
    filtraterWidth: function () {
        var me = $(this);
        if ($(window).width() <= 1024) {
            me.addClass('group-type-row');
        }
    },
    //正文内容选中内容弹出搜索
    captureSearch: function () {
        var me = $(this);
        me.unbind();
        me.bind('mouseup dbclick', function (e) {

            var text = escape(getSelectedTxt());
            var position = getMouseCoord(e);
            var aiSearchUrl = "/" + $("input[name='curMenu']").val() + "/aisearch/" + $("input[id='DbId']").val();
            if (text.length >= 1) {
                $('.layout-wrap').css({
                    left: position.x,
                    top: position.y + 10,
                    display: 'block'
                });
            } if (text.length <= 0) {
                $('.layout-wrap').css({
                    display: 'none'
                });
            }
            //点击弹出窗口搜索选中关键词
            $('.layout-wrap a').unbind();
            $('.layout-wrap a').bind('click', function (e) {

                var isUserLogin = $("#IsUserLogin").val();
                //用户未登录
                if (isUserLogin != "true") {
                    $("#loginBuyBtn").click();
                    return false;
                } else {
                    var authorityType = $("#authorityType").val();
                    if (authorityType != "ValidUser") {
                        $("#loginAuthorityBtn").click();
                        return false;
                    }
                }

                var mark = $(this).attr('mark');
                $('.layout-wrap').css({
                    display: 'none'
                });
                switch (mark) {
                    case 'capture':
                        $(this).attr('href', aiSearchUrl + '');
                        var aiCookie = getCookie("xAiSearch");
                        if (aiCookie == null) {

                            var aiText = escape(getSelectedTxt());
                            //把选中的词加入cookie
                            var cookietimes = new Date();
                            cookietimes.setTime(cookietimes.getTime() + (60 * 5000)); //coockie保存1分钟
                            document.cookie = "xAiSearch=" + aiText + ";expires=" + cookietimes.toGMTString() + ";path=/";
                        }
                        break;
                    case 'annotation':
                        $U.showProgress();
                        var selectedTxt = getSelectedTxt();
                        //此处对字数做限制
                        //var selectedTxt2= escape(getSelectedTxt());
                        if (selectedTxt == "" || selectedTxt == undefined) {
                            return false;
                        }
                        if (selectedTxt.length > 85) {
                            selectedTxt = selectedTxt.substring(0, 85) + "...";
                        }
                        var gid = $("#journalGid").val();


                        var fields;
                        $.post("/Full/AddUserNote", { gid: gid }, function (html) {

                            layer.open({
                                content: html, //内容
                                area: ['750px', '550px'],
                                title: false,
                                fix: false, //不随滚动条滚动
                                move: false, //不可移动
                                btn: false, //按钮不展示           
                                shade: [0.01, '#000'],
                                success: function () {
                                    $U.hideProgress();

                                    $("#content").text(selectedTxt);

                                    var onLabelSearch = function () {

                                        var keyword = $('#noteLabelTxt').val();

                                        $.get("/Full/GetLabelByName?keyword=" + encodeURIComponent(keyword), function (list) {

                                            if (list != null && list.trim() != "") {
                                                fields = list.split('|');

                                                var listitem = "<li value=\"{0}\"'>{1}</li>";
                                                var templete = "";
                                                $.each(fields, function (i, n) {

                                                    if (n != "" && n != null) {
                                                        var label = n.split(',');

                                                        if (label[1].length > 30) {

                                                            label[1] = label[1].substr(0, 30) + "...";
                                                        }

                                                        templete += String.format(listitem, label[0], label[1]);
                                                    }
                                                });

                                                //加载完成添加元素并显示
                                                removeLabelSearch();
                                                $("#labelList").append(templete);
                                                $('.select-layer').show();
                                                //备选项单击事件
                                                $("#labelList li").each(function () {
                                                    var cur = $(this);
                                                    cur.click(function (e) {
                                                        var labelId = cur.attr("value");
                                                        var labelName = cur.text();
                                                        $("#noteLabelId").val(labelId);
                                                        $('#noteLabelTxt').val(labelName);
                                                        $('.select-layer').hide();

                                                        e = e || window.event;
                                                        if (e.stopPropagation) { //W3C阻止冒泡方法  
                                                            e.stopPropagation();
                                                        } else {
                                                            e.cancelBubble = true; //IE阻止冒泡方法  
                                                        }
                                                    });
                                                });

                                                $(document).click(function () {
                                                    var noteLabelId = $("#noteLabelId").val();
                                                    var labelName = $('#noteLabelTxt').val();
                                                    if (noteLabelId == "" && labelName != "") {

                                                        $.each(fields, function (i, n) {
                                                            if (n != "" && n != null) {
                                                                var label = n.split(',');
                                                                if (label[1] == labelName) {
                                                                    $("#noteLabelId").val(label[0]);
                                                                }
                                                            }
                                                        }
                                                        );
                                                    };
                                                    $('.select-layer').hide();
                                                });

                                                //没有从备选项中选择则自动获取LabelId
                                                //$('#noteLabelTxt').blur(function () {
                                                //    $('.select-layer').hide();
                                                //    var noteLabelId = $("#noteLabelId").val();
                                                //    if (noteLabelId == "" || noteLabelId == undefined) {
                                                //        var labelName = $('#noteLabelTxt').val();
                                                //        $.each(fields, function (i, n) {
                                                //            if (n != "" && n != null) {
                                                //                var label = n.split(',');
                                                //                if (label[1] == labelName) {
                                                //                    $("#noteLabelId").val(label[0]);
                                                //                }
                                                //            }
                                                //        }
                                                //        );
                                                //    }
                                                //});


                                            } else {
                                                removeLabelSearch();
                                                if (keyword == "") {
                                                    $("#labelList").append("<li>输入名称新建标签</li>");
                                                    $('.select-layer').show();
                                                } else {
                                                    $('.select-layer').hide();
                                                }
                                            }

                                        });

                                    };

                                    var removeLabelSearch = function () {
                                        var labelList = $("#labelList").find("li");
                                        if (labelList != undefined && labelList.length > 0) {
                                            labelList.remove();
                                        }

                                    }

                                    $('#noteLabelTxt').keypress(function (e) {
                                    }).click(function (e) {
                                        $("#labelTips").hide();
                                        onLabelSearch();
                                        $('.select-layer').css({
                                            display: 'block',
                                            width: $(this).outerWidth() / 2 + 20,
                                            left: $(this).offset().left - $('.layui-layer-content').offset().left,
                                            top: $(this).offset().top - $('.layui-layer-content').offset().top + 30
                                        });
                                    }).keyup(function (e) {
                                        //这里要清空一下labrlId，和点击备选项保留的labelId区分开
                                        $("#noteLabelId").val("");
                                        onLabelSearch();
                                    });

                                    $("#source").click(function (e) {
                                        $("#sourceTips").hide();
                                        $("#sourceCountTips").hide();

                                    });

                                    $("#note").click(function () {
                                        $("#noteCountTips").hide();
                                        var noteText = $(this).text();
                                        if (noteText.trim() == "请输入您此刻的想法...") {
                                            $("#note").empty();
                                        }
                                    });

                                    $("#note").blur(function () {
                                        var noteText = $(this).text();
                                        if (noteText.trim() == "") {
                                            $("#note").text("请输入您此刻的想法...");
                                        }
                                    });


                                    //保存标签
                                    $("#saveNoteBtn").click(function () {

                                        var labelName = $("#noteLabelTxt").val().trim();

                                        var noteLabelId = $("#noteLabelId").val();
                                        if (noteLabelId == "" && labelName != "") {
                                            if (fields != null && fields != undefined) {
                                                $.each(fields, function (i, n) {
                                                    if (n != "" && n != null) {
                                                        var label = n.split(',');
                                                        if (label[1] == labelName) {
                                                            $("#noteLabelId").val(label[0]);
                                                        }
                                                    }
                                                });
                                            }
                                        };

                                        var labelId = $("#noteLabelId").val();
                                        var content = $("#content").text().trim();
                                        var source = $("#source").text().trim();
                                        var note = $("#note").text().trim();

                                        if (labelName == "") {
                                            $("#labelTips").show();
                                            return false;
                                        };
                                        if (source == "") {
                                            $("#sourceTips").show();
                                            return false;
                                        };
                                        if (note == "请输入您此刻的想法...") {
                                            note = "";
                                        }

                                        if (source.length >= 900) {
                                            $("#sourceCountTips").show();
                                            return false;
                                            //source = source.substring(0, 900);

                                        }
                                        if (note.length >= 900) {
                                            $("#noteCountTips").show();
                                            return false;
                                            //note = note.substring(0, 900);
                                        }


                                        $.post("/Full/SaveLabelNote?", {
                                            labelId: labelId, labelName: encodeURIComponent(labelName), content: encodeURIComponent(content), source: encodeURIComponent(source), note: encodeURIComponent(note), gid: gid
                                        }, function (data) {
                                            if (data > 0) {
                                                layer.closeAll();
                                                layer.msg('保存成功，可前往个人中心查看引注记录！');
                                            };
                                        });
                                    });
                                }
                            });
                        });

                        break;
                }

            });
        });

        var getSelectedTxt = function () {
            var text = "";
            if (window.getSelection) {
                //text = window.getSelection().toString().substr(0, 100);
                text = window.getSelection().toString();
                if (text.length > 500) {
                    text = text.substring(0, 500);
                }
            } else if (document.selection && document.selection.type != "Control") {
                //text = document.selection.createRange().text.substr(0,100);
                text = document.selection.createRange().text;
                if (text.length > 500) {
                    text = text.substring(0, 500);
                }
            }
            return text;
        };
        var getMouseCoord = function (event) {
            var coord = { x: 0, y: 0 };
            var dot, eventDoc, doc, body, pageX, pageY;
            event = event || window.event; // IE-ism
            if (event.pageX == null && event.clientX != null) {
                eventDoc = (event.target && event.target.ownerDocument) || document;
                doc = eventDoc.documentElement;
                body = eventDoc.body;
                event.pageX = event.clientX +
                    (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
                event.pageY = event.clientY +
                    (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);
            }
            coord = { x: event.pageX, y: event.pageY };
            return coord;
        }
    },

    //鼠标经过添加class
    addClassHover: function () {
        var me = $(this);
        me.hover(function () {
            $(this).addClass("current");
        }, function () {
            $(this).removeClass("current");
        });
    },
    addSenClassHover: function () {
        var me = $(this);
        me.hover(function () {
            $(this).addClass("bg");
        }, function () {
            $(this).removeClass("bg");
        });
    },

    //鼠标经过父级添加class
    addParentClassHover: function () {
        var me = $(this);
        me.hover(function () {
            $(this).parent().addClass("current");
        }, function () {
            $(this).parent().removeClass("current");
        });
    },

    //点击当前元素添加class
    addClassClick: function () {
        var me = $(this);
        me.click(function () {
            me.parent().removeClass('current');
            $(this).parent().addClass('current');
        });
    },

    //点击当前元素添加class
    addClassClickCurrent: function () {
        var me = $(this);
        me.click(function () {
            me.removeClass('current');
            $(this).addClass('current');
        });


    },

    //排序效果
    sortChang: function () {
        var me = $(this);
        var currentSelect = me.parent().find('.currentSelect');
        me.parent().prepend(currentSelect);
        me.click(function () {
            $(this).addClass('currentSelect').siblings().removeClass('currentSelect');
            me.parent().prepend($(this));
            me.parent().removeClass('current');
        });
    },

    //选项卡
    addClassHoverTab: function () {
        var me = $(this);
        me.parent().nextAll().hide();
        me.parent().nextAll().eq(0).show();
        me.click(function () {
            $(this).addClass("current").siblings().removeClass("current");
            me.parent().nextAll().hide().eq($(this).index()).show();
        })
    },
    //选项卡-点击
    addClassClickTab: function () {
        var me = $(this);
        me.parent().nextAll().hide();
        me.parent().nextAll().eq(0).show();
        me.click(function () {
            $(this).addClass("current").siblings().removeClass("current");
            me.parent().nextAll().hide().eq($(this).index()).show();
        })
    },

    //选项卡-点击
    addClassClickSelectTab: function () {
        var me = $(this);
        me.parent().parent().next().children().hide();
        me.parent().parent().next().children().eq(0).show();
        me.click(function () {
            $(this).addClass("current").siblings().removeClass("current");
            me.parent().parent().next().children().hide().eq($(this).index()).show();
        });
    },



    //首页选项卡点击
    addClassClickHomeTab: function () {
        var me = $(this);
        me.parent().parent().next().children().hide();
        me.parent().parent().next().children().eq(0).show();
        me.click(function () {
            $(this).addClass("current").siblings().removeClass("current");
            me.parent().parent().next().children().hide().eq($(this).index()).show();
        })
    },
    //关闭祖先元素
    closeAncestor: function () {
        var me = $(this);
        me.click(function () {
            var exp = new Date();
            document.cookie = "xClose=" + exp.getDate();//设置关闭广告的cookie，不设置过期时间 在浏览器关闭的时候就失效了
            me.parents('div').hide();
        });
    },

    //图片列表展示形式切换 块状 or 列表
    imagesType: function () {
        var me = $(this);
        me.click(function () {
            $('.images-type').removeClass('images-type-grid images-type-list');
            if ($(this).hasClass('list')) {
                $('.images-type').addClass('images-type-list');
            } else {
                $('.images-type').addClass('images-type-grid');
            }
            $(this).addClass('current').siblings().removeClass('current');
        });
    },

    //正文工具条判断浏览器宽度设置宽度
    toolWidth: function () {
        var me = $(this);
        if ($(window).width() < 1024) {
            me.addClass('fulltext-tool-min');
        }
    },

    //边栏及工具条滚动
    elementScroll: function () {
        if ($(this).length != 0) {
            if ($(window).scrollTop() > $(this).position().top) {
                $(this).css({
                    position: "fixed",
                    top: 0
                });
            }
        }

        var position = function (element) {
            var top = element.position().top, pos = element.css("position");
            $(window).scroll(function () {
                var scrolls = $(this).scrollTop();
                if (scrolls > top) {
                    if (window.XMLHttpRequest) {
                        element.css({
                            position: "fixed",
                            top: 0
                        });
                        element.addClass('current');
                    } else {
                        element.css({
                            position: "absolute",
                            top: scrolls
                        });
                        element.removeClass('current');
                    }
                } else {
                    element.css({
                        position: "relative"
                    });
                    element.removeClass('current');
                }
            });
        }

        return $(this).each(function () {
            position($(this));
        });
    },

    //首页检索下拉
    subSearchJselect: function () {
        var me = $(this);
        var ul = me.find("ul");
        var span = me.find("div");
        var hidden = me.find("input[type=hidden]");
        me.mouseover(function () {
            ul.show();
            me.addClass("current");
        });
        me.mouseleave(function () {
            ul.hide();
            me.removeClass("current");
        })
        $(document).click(function () {
            ul.hide();
            me.removeClass("current");
        });

        ul.children().click(function (event) {
            event.stopPropagation();
            me.find("div").html($(this).text());
            hidden.val($(this).text());
            ul.hide();
            me.removeClass("current");
        });
    },
    //图片左右切换
    eleSingleTab: function () {
        var me = $(this);
        var li = me.find('li');
        var prev = $('.prev');
        var next = $('.next');
        var total = 0;
        me.width(li.length * li.outerWidth());
        prev.click(function () {
            if (total > 0) {
                total--;
            }



            ClickScroll();
        })
        next.click(function () {
            if (total < li.length - 5) {
                total++;
            }
            ClickScroll();
        })
        function ClickScroll() {
            total == 0 ? prev.addClass('prev-first') : prev.removeClass('prev-first');
            total == li.length - 5 ? next.addClass("next-last") : next.removeClass("next-last");
            me.animate({ left: -total * li.outerWidth() })
        }
    },

    //table隔行换色
    tableBg: function () {
        var me = $(this);
        me.each(function () {
            if ($(this).index() % 2 == 0) {
                $(this).addClass('bg');
            }
        });
    },

    //当前选中条展示内容 展开收起
    moreContent: function () {
        var me = $(this);
        var meText = $(this).eq(0).text();
        //var meParent = me.parent().find('div');
        var meParent = me.parent().find('#detail');
        var meAttrText = me.attr('text');
        //初始化内容高度
        /*meParent.css({
            height : 150,
            overflow : 'hidden'
        });*/
        meParent.each(function () {//$(this).parent().find('div').eq(0).height()
            if (parseInt($(this).height()) > 150) {
                $(this).css({
                    height: 150,
                    overflow: 'hidden'
                });
                $(this).siblings().show();
            } else {
                $(this).css({
                    height: 'auto',
                    overflow: 'auto'
                });
                me.hide();
            }
        });
        ////点击更多展示
        //me.click(function () {

        //});
    },

    //登录注册判断内容高度是否超过可视区高度
    contentHeight: function () {
        var me = $(this);
        var header = me.find('login-header')
        if (me.height() >= $(window).height()) {
            me.css({
                top: 0,
                marginTop: 0
            })
        } else {
            me.css({
                top: '50%',
                marginTop: -me.height() / 2 - header.height()
            })
        }
    },

    customization: function (defaultNum) {
        var me = $(this);
        var meEle = me.find('li');
        var more = me.find('.more');
        more.hide();
        meEle.slice(0, defaultNum).show();
        if (meEle.length > defaultNum) {
            more.show();
            meEle.slice(0, defaultNum).show();
            $('.c-arrow-down').click(function () {
                if ($(this).hasClass('c-arrow-up')) {
                    $(this).removeClass('c-arrow-up');
                    meEle.hide();
                    meEle.slice(0, defaultNum).show();
                } else {
                    $(this).addClass('c-arrow-up');
                    meEle.show();
                }
            });
        }


    },
    //正文新版本展开收起
    foldContent: function () {
        var me = $(this);
        var meParent = me.parent();
        me.click(function () {
            if (me.find('span').text() == '收起') {
                me.nextAll('.box').slideUp();
                meParent.addClass('current');
                me.find('span').text('展开');
            } else {
                me.nextAll('.box').slideDown();
                meParent.removeClass('current');
                me.find('span').text('收起')
            }
        })
    },

    //正文下载

    fulltextDown: function () {

        var me = $(this);
        var W = parseInt($('.down-content').outerWidth());
        var library = $("input[name='Library']").val();
        var curMenu = $("input[name='curMenu']").val();
        me.click(function (event) {
            event.stopPropagation();
            var isHaveSingleBuyRight = $("#isHaveSingleBuyRight").val();
            var isHaveRight = $("#isHaveRight").val();
            var isLogin = $("#IsUserLogin").val();//是否登录的标志

            $('.down-content').css({
                width: W - 50
            });
            if ($(this).text() == '下载' || $(this).text() == 'Download' || $(this).text() == '下载目录' || $(this).text() == '批量下载') {

                if ($(this).text() == '下载' || $(this).text() == 'Download') {
                    //未购买
                    if (isHaveSingleBuyRight != "true" && isHaveRight != "true") {
                        if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                            $("#loginBtn").click();
                            return false;
                        }
                    }
                    me.parent().addClass('current');
                    $('.down-content').css({
                        left: -(W - me.width() - me.outerWidth() + 1)
                    });
                }
                if ($(this).text() == '下载') {
                    $('.down-content').css({
                        left: -(W - me.width() - me.outerWidth() + 1)
                    });
                }
                if ($(this).attr('title') == '批量下载') {
                    $('.down-content').css({
                        //width: W - 120,
                        left: 0,
                        zIndex: 99999
                    });
                }
                $('.down-content').mouseleave(function () {
                    $(this).parent().removeClass('current');
                });
                $('.down-content').click(function (eve) {
                    eve.stopPropagation();
                });

                $(window).click(function () {
                    $('.operation').removeClass('current');
                });

                $('.down-content input[type="radio"]').each(function () {

                    if ($('#tool-word').is(':checked') || $('#tool-hyper').is(':checked') || $('#tool-pdf').is(':checked') || $('#english').is(':checked') || $('#chinese').is(':checked')
                        || $('#block').is(':checked') || $('#list').is(':checked') || $('#fullPdf').is(':checked')) {//|| $('#tool-txt').is(':checked') 

                        $('.about-info').show();
                        $('.down-content .tips').hide();
                        if ($('#tool-hyper').is(':checked')) {
                            $('.down-content .tips').show();
                        }
                        if ($('#tool-pdf').is(':checked') && (curMenu == "journal" || curMenu == "lawfirm")) {
                            $('.about-info').hide();
                            $('.down-content .tips').hide();
                        }
                    } else {
                        $('.about-info').hide();
                        $('.down-content .tips').hide();
                    }


                    if ($("#catalogExcel").is(':checked')) {
                        $('.excel-info').show();
                    } else {
                        $('.excel-info').hide();
                    }
                    $(this).click(function () {
                        if ($('#tool-word').is(':checked') || $('#tool-txt').is(':checked') || $('#tool-hyper').is(':checked') || $('#tool-pdf').is(':checked') || $('#english').is(':checked') || $('#chinese').is(':checked')
                            || $('#block').is(':checked') || $('#list').is(':checked') || $('#fullPdf').is(':checked')) {
                            $('.about-info').show();
                            $('.down-content .tips').hide();
                            if ($('#tool-hyper').is(':checked')) {
                                $('.down-content .tips').show();
                            }
                            if ($('#tool-pdf').is(':checked') && (curMenu == "journal" || curMenu == "lawfirm")) {
                                $('.about-info').hide();
                                $('.down-content .tips').hide();
                            }
                        } else {
                            $('.about-info').hide();
                            $('.down-content .tips').hide();
                        }
                        if ($("#catalogExcel").is(':checked')) {
                            $('.excel-info').show();
                        } else {
                            $('.excel-info').hide();
                        }
                    });


                });
            }
            return false;
        });
    },
    recordDown: function () {
        var isLogin = $("#IsUserLogin").val();//是否登录的标志
        var library = $("input[name='Library']").val();
        var me = $(this);
        var W = parseInt($('.down-content').outerWidth());
        $('.down-content').css({
            width: W - 50
        });


        var selectedCount = 0;
        me.click(function (event) {
            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }
            event.stopPropagation();
            var me = $(this);
            $('.print-content').hide();
            me.parent().addClass('current');
            $('.down-content').css({
                //width: W - 120,
                left: 0,
                zIndex: 99999
            });


            selectedCount = $("input[name='recordList']:checkbox:checked").length;

            $('.down-content input[type="radio"]').each(function () {
                var checkedVal = $(this).val();

                if ($(this).is(':checked') && checkedVal == "catalogExcel") {
                    $(".NumberRemind").css("display", "none");
                    $("#batchDownload").css("background-color", "#06a9ee");
                    $('.excel-info').show();
                    $('.about-info').hide();
                } else if ($(this).is(':checked') && (checkedVal == "fullWord" || checkedVal == "fullPdf" || checkedVal == "fullHyper")) {
                    if (selectedCount != null && selectedCount > 10) {
                        $(".NumberRemind").css("display", "block");
                        $("#batchDownload").css("background-color", "gray");
                    } else {
                        $(".NumberRemind").css("display", "none");
                        $("#batchDownload").css("background-color", "#06a9ee");
                    }
                    $('.excel-info').hide();
                    $('.about-info').show();
                    if (checkedVal == "fullPdf" && (library == "qikan" || library == "lawfirmarticles")) {
                        $('.about-info').hide();
                        $('.down-content .tips').hide();
                    }
                } else if ($(this).is(':checked') && checkedVal == "fullPure") {
                    $(".NumberRemind").css("display", "none");
                    $("#batchDownload").css("background-color", "#06a9ee");
                    $('.excel-info').hide();
                    $('.about-info').hide();
                }

                $(this).click(function () {

                    if ($(this).is(':checked') && checkedVal == "catalogExcel") {
                        $(".NumberRemind").css("display", "none");
                        $("#batchDownload").css("background-color", "#06a9ee");
                        $('.excel-info').show();
                        $('.about-info').hide();
                    } else if ($(this).is(':checked') && (checkedVal == "fullWord" || checkedVal == "fullPdf" || checkedVal == "fullHyper")) {
                        if (selectedCount != null && selectedCount > 10) {
                            $(".NumberRemind").css("display", "block");
                            $("#batchDownload").css("background-color", "gray");
                        } else {
                            $(".NumberRemind").css("display", "none");
                            $("#batchDownload").css("background-color", "#06a9ee");
                        }
                        $('.excel-info').hide();
                        $('.about-info').show();
                    } else if ($(this).is(':checked') && (checkedVal == "fullPure" || checkedVal == "fullTxt")) {
                        if (checkedVal == "fullPdf" && (library == "qikan" || library == "lawfirmarticles")) {
                            $('.about-info').hide();
                            $('.down-content .tips').hide();
                        }
                        $(".NumberRemind").css("display", "none");
                        $("#batchDownload").css("background-color", "#06a9ee");
                    } else if ($(this).is(':checked') && checkedVal == "fullPure") {
                        $(".NumberRemind").css("display", "none");
                        $("#batchDownload").css("background-color", "#06a9ee");
                        $('.excel-info').hide();
                        $('.about-info').hide();
                    }

                });

            });


        });




        $('.down-content').mouseleave(function () {
            $(this).parent().removeClass('current');
        });
        $('.down-content').click(function (event) {
            event.stopPropagation();
        });
        $(window).click(function () {
            $('.operation').removeClass('current');
        });

    },

    //打印

    fulltextPrint: function () {
        var me = $(this);
        var W = parseInt($('.print-content').outerWidth());
        $('.print-content').css({
            width: W - 50
        });
        me.click(function (event) {

            var isLogin = $("#IsUserLogin").val();//是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }
            event.stopPropagation();
            me.parent().removeClass('current');
            $('.print-content').show();
        });
        $('.print-content').mouseleave(function () {
            $(this).hide();
        });
        $('.print-content').click(function (event) {
            event.stopPropagation();
        });
        $(window).click(function () {
            $('.print-content').hide();
        });
    },
    //分享
    fulltextShare: function () {
        var me = $(this);
        me.click(function (event) {
            event.stopPropagation();
            me.parent().removeClass('current');
            $('.share-content').show();
        });
        $('.share-content').mouseleave(function () {
            $(this).hide();
        });
        $('.share-content').click(function (event) {
            event.stopPropagation();
        });
        $(window).click(function () {
            $('.share-content').hide();
        });
    },
    //搜索单字符提示
    searchTips: function (leftDifferNum, widthDifferNum, differEle) {
        var me = $(this);
        var iconClick = $('.c-warning-search');

        iconClick.click(function (event) {
            event.stopPropagation();
            me.css({
                position: 'absolute',
                left: parseInt(differEle.css('padding-left')) - leftDifferNum,
                width: parseInt($('#txtSearch').css('width')) - widthDifferNum,
                display: 'block'
            });
        });
        $(document).click(function () {
            me.hide();
        });
    },
    /*,

    //法宝联想选中当前条显示对应内容
    tiaoChose : function(){
        $('.associate-wrap div[tiaonum]').hide();
        $('.associate-wrap div[tiaonum = '+ $('.associate-filtrater dd[class="currentSelect"]').attr('tiaonum') +']').show();
        var me = $(this);
        me.click(function() {
            var meTiao = $(this).attr('tiaonum');
            var content = $('.associate-wrap div[tiaonum]');
            content.hide();
            $('.associate-wrap div[tiaonum = '+ meTiao +']').show();
        });
    }*/

    //列表全选功能
    checkBoxForAll: function () {
        var me = $(this);
        me.click(function () {
            var isChecked = me.prop("checked");

            if (isChecked) {
                $('.list-wrap .checkbox').prop("checked", true);
            } else {
                $('.list-wrap .checkbox').prop("checked", false);
            }


            //$.each(cebmatchResult, function(index, value) {
            // $("input[name='checkbox']").attr("checked", "true");
        });
    }



})
//法宝感谢滚动
function ScrollImgLeft() {
    var speed = 100;
    var scroll_begin = document.getElementById("scroll_begin");
    var scroll_end = document.getElementById("scroll_end");
    var scroll_div = document.getElementById("scroll_div");
    if (scroll_end) {
        scroll_end.innerHTML = scroll_begin.innerHTML;

        function Marquee() {
            if (scroll_end.offsetWidth - scroll_div.scrollLeft <= 0)
                scroll_div.scrollLeft -= scroll_begin.offsetWidth;
            else
                scroll_div.scrollLeft++;
        }

        var MyMar = setInterval(Marquee, speed);
        scroll_div.onmouseover = function () {
            clearInterval(MyMar);
        }
        scroll_div.onmouseout = function () {
            MyMar = setInterval(Marquee, speed);
        }
    }
}

//正文页面底部加载广告位
function InitFullBottomAdvertisement() {

    if (window.document.getElementById("ads_container") == null) {
        return;
    }
    var advertisement = "https://manage.pkulaw.cn/AdPosition/GetAdByAdPositionId?callback=?&Id=";
    var qikanAdvIdTop = "8f2e83fc-0222-460d-858b-1b65c997f073"; //正文页底部广告位Id
    var advSbTo = "";
    var picPath = "https://manage.pkulaw.cn";

    advUrl = advertisement + qikanAdvIdTop;
    $.ajax({
        url: advUrl,
        type: "Get",
        dataType: 'jsonp',
        success: function (adv) {

            if (adv != null) {

                var len = adv.length;
                if (len > 0) {

                    for (var i = 0; i < 1; i++) {

                        var advSet = adv[i];
                        var picSrc = advSet.PictureSrc;

                        var picHref = advSet.PictureHref;
                        var picAlt = advSet.PictureAlt;
                        var errorPic = "/Content/ad-images/pic-1.jpg";
                        var cha = '"';

                        if (i == 0) {
                            advSbTo += "<a href='" + picHref + "' target='_blank'><img src='" + picPath + picSrc + "' data-bd-imgshare-binded='1'></a>";
                        }
                    }
                    if (advSbTo != "") {

                        window.document.getElementById("ads_container").innerHTML = advSbTo;

                    }

                }
            }
        }

    });
}

//左侧智能法宝加载广告位
function wisdomLeftAdvertisement() {

    if (window.document.getElementById("wisdomLeftAdvertisement") == null) {
        return;
    }
    var advertisement = "https://manage.pkulaw.cn/AdPosition/GetAdByAdPositionId?callback=?&Id=";
    var qikanAdvIdTop = "c856b3db-eb32-4cb4-9238-e0b1ad076f53"; //左侧智能法宝加载广告位Id
    var advSbTo = "";
    var picPath = "https://manage.pkulaw.cn";
    advUrl = advertisement + qikanAdvIdTop;
    $.ajax({
        url: advUrl,
        type: "Get",
        dataType: 'jsonp',
        success: function (adv) {

            if (adv != null) {

                var len = adv.length;
                if (len > 0) {

                    for (var i = 0; i < len; i++) {

                        var advSet = adv[i];
                        var picSrc = advSet.PictureSrc;

                        var picHref = advSet.PictureHref;
                        var picAlt = advSet.PictureAlt;
                        var num = advSet.Sort;

                        advSbTo += "<li><a href='" + picHref + "' target='_blank' num='" + num + "'><img src='" + picPath + picSrc + "' alt='" + picAlt + "'></a></li>";
                    }
                    if (advSbTo != "") {
                        window.document.getElementById("wisdomLeftAdvertisement").innerHTML = advSbTo;
                         

                    }

                }
            }
        }

    });

}

//layer插件
var layerLoad = {
    counting: 0,
    Open: function () {
        layerLoad.counting++;
        if (layerLoad.counting == 1) {
            layer.load(1);
        }
    },
    Close: function () {
        layerLoad.counting--;
        if (layerLoad.counting == 0) {
            layer.closeAll('loading');
        }
    },
    Message: function (message) {
        layer.msg(message, {
            icon: 18,
            shade: [0.01, '#000']
        });
    },
    Error: function (errorInfo) {
        layer.msg(errorInfo, {
            icon: 2,
            shade: [0.01, '#000']
        });
    },
    open: function (content) {
        layer.open({
            type: 1,
            title: false,
            fix: false,
            closeBtn: 0,
            area: ['380px', 'auto'],
            skin: 'layer-wrap',
            shade: 0,
            shadeClose: true,
            content: content,
            success: function (layero, index) {
                $(layero).mousemove(function () {
                    layer.close();
                });
            }
        });
    }

}

var bindBtnSearch = function () {
    $("#btnSearch").unbind("click");
    $("#btnSearch").click(function () {
        var str = $(this).attr("url");
        var keyword = $("#txtSearch").val();
        var menu = $("input[name=Menu]").val();
        if (keyword.length == 0) {

            $("#txtSearch").focus();
            return false;
        }


        if (keyword.length > 200) {
            event.stopPropagation();
            $('.c-warning-search').show();
            $('.tt-menu3').hide();
            $('.toomany').css({
                display: 'block'
            });

            return false;
        } else {
            $('.c-warning-search').hide();
            $('.toomany').hide();
        }

        //过滤违禁词  q
        if (CheckSensitiveSword(keyword) == false) {
            event.stopPropagation();
            $('.c-warning-search').show();
            $('.tt-menu3').hide();
            $('.sword').css({
                position: 'absolute',
                left: parseInt($('.search-panel .search').css('padding-left')) - 10,
                width: parseInt($('#txtSearch').css('width')) - 2,
                display: 'block'
            });

            return false;
        } else {
            $('.c-warning-search').hide();
            $('.sword').hide();
        }

        var href = str + "?Keyword=" + encodeURIComponent(keyword);
        var curSearchType = $('.areajSelect .jSelectList .current').children().attr('areacode');



        var matchType = $("input[name='Search_Mode']:checked").val();
        var rangeType = $("input[name='RangeType']").val();


        if (curSearchType == "Title" || curSearchType == "Fulltext") {
            href += "&MatchType=" + matchType + "&SearchKeywordType=" + curSearchType + "&RangeType=" + rangeType;
        }
        if (curSearchType == "Author") {

            if (menu == "lawfirm") {
                href = "/lawfirm/findarticle?SearchKeywordType=Author&Keyword=" + keyword;
            } else {
                href = "/journal/findarticle?SearchKeywordType=Author&Keyword=" + keyword;
            }
        }
        if (curSearchType == "AuthorUnit") {

            if (menu == "lawfirm") {
                href = "/lawfirm/findarticle?SearchKeywordType=AuthorUnit&Keyword=" + keyword;
            } else {
                href = "/journal/findarticle?SearchKeywordType=AuthorUnit&Keyword=" + keyword;
            }
        }

        if (curSearchType == "JournalId") {
            if (menu == "lawfirm") {
                href = "/lawfirm/findarticle?SearchKeywordType=JournalId&Keyword=" + keyword;
            } else {
                href = "/journal/findarticle?SearchKeywordType=JournalId&Keyword=" + keyword;
            }
        }

        if (menu == "video") {
            href = str + "?Keywords=" + encodeURIComponent(keyword) + "&SearchKeywordType=" + curSearchType;
        }



        window.location.href = href + "&QueryType=HomeSearch";
        return false;
    });
}

//获取Url 里面指定参数的值
function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return decodeURI(r[2]); return null;
}

//子页面登录显示权限
function ShowQuanX(menuUrl) {
    var area = $("#areaHiddenId").val();
    //动态获取数据添加到指定位置
    var menuUrl = "/" + menuUrl;
    $.post(menuUrl, {
        isEng: area
    }, function (data) {
        $('.limits-wrap').append(data);
    });
}

//调用方法
$(function () {


    //跟随滚动二维码
    $('.mod-side-bar .code').addClassHover();
    //权限提示
    $('.limits').addClassHover();
    //页底鼠标经过展示二维码
    $('.code li').addClassHover();
    //法宝感谢
    ScrollImgLeft();
    //正文页面底部加载广告位
    InitFullBottomAdvertisement();
    //左侧智能法宝加载广告位
    wisdomLeftAdvertisement();

    //处理浏览器1024导航换行
    $('.main-nav').columnMarginLeft();

    $(".nav-wrap #companySearch").click(function () {
        var isLogin = $("#IsUserLogin").val();//是否登录的标志
        if (isLogin != "true") {
            $("#loginBtn").click();
            return false;
        }
    });

    //最新消息显示隐藏
    //$('.mod-side-bar .btn a').click(function () {
    //    var exp = new Date();
    //    exp.setTime(exp.getTime() + (3600 * 1000 * 24));//24小时
    //    document.cookie = "xCloseNew=" + exp + ";expires=" + exp.toGMTString() + ";path=/";//设置路径保证其他页面也可以获取到
    //    $('.new-wrap').hide();
    //});
    //最新消息显示隐藏
    var newCookie = getCookie("xCloseNew");
    if (newCookie != null) { //关闭 不显示
        $('.new-wrap').hide();
    } else {
        //显示5s自动隐藏
        $('.new-wrap').show();
        setTimeout(function () {
            var exp = new Date();
            exp.setTime(exp.getTime() + (3600 * 1000 * 24)); //24小时
            document.cookie = "xCloseNew=" + exp.getDate() + ";expires=" + exp.toGMTString() + ";path=/"; //设置路径保证其他页面也可以获取到
            $('.new-wrap').hide();
        }, 5000);
    }


    //登录
    $('#123,#123').click(function () {
        var $link = $(this);
        var menu = $("input[name='Menu']").val();
        if (menu == undefined) {
            menu = "Index";
        }
        var url = $link.attr("url");
        $.ajax(
            {
                url: url + "?menu=" + menu + "",
                type: "POST",
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                }
                , success: function (html) {
                    layer.open({
                        content: html, //内容
                        area: ['405px', '430px'], //宽带400，高度自适应
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true //点击遮罩关闭弹框
                    });
                    //选项卡
                    $('.register-tab a').addClassHoverTab();

                    $('#loginByUserName').unbind();

                    var exCh = $("#exchangCh");
                    var exEn = $("#exChangeEn");

                    //切换中文
                    exCh.click(function () {

                        exCh.addClass('current');
                        exEn.removeClass('current');
                        var log = $(".register-tab a");
                        log.eq(0).text(log.eq(0).attr('ch'));
                        log.eq(1).text(log.eq(1).attr('ch'));
                        $("input[id='inputUserName']").text($("input[id='inputUserName']").attr('ch'));
                        $("input[id='inputPwd']").text($("input[id='inputPwd']").attr('ch'));
                        $("#loginByUserName").html($("#loginByUserName").attr('ch'));
                        $(".ip-register span").eq(0).text($(".ip-register span").eq(0).attr('ch'));
                        $(".have-account a").eq(0).text($(".have-account a").eq(0).attr('ch'));
                        $("#lbRem").text($("#remember").attr('ch'));
                        $("#loginByIp").html($("#loginByUserName").attr('ch'));
                        $("#inputUserName").attr("placeholder", $("#inputUserName").attr('ch'));
                        $("#inputPwd").attr("placeholder", $("#inputPwd").attr('ch'));
                        $("#userTips").text("");
                        $("#pwdTips").text("");
                        var ipName = $("#hidIp").val();
                        $(".ip-scope").html("<p class='ip-register'>您当前的ip地址是:" + ipName + "</p>");
                        $(".have-account a").eq(0).attr("href", "/foregetpassword/law");
                        menu = "chinese";
                    });


                    exEn.click(function () {

                        exEn.addClass('current');
                        exCh.removeClass('current');
                        var log = $(".register-tab a");
                        log.eq(0).text(log.eq(0).attr('en'));
                        log.eq(1).text(log.eq(1).attr('en'));
                        $("input[id='inputUserName']").text($("input[id='inputUserName']").attr('en'));
                        $("input[id='inputPwd']").text($("input[id='inputPwd']").attr('en'));
                        $("#loginByUserName").html($("#loginByUserName").attr('en'));
                        $(".ip-register span").eq(0).text($(".ip-register span").eq(0).attr('en'));
                        $(".have-account a").eq(0).text($(".have-account a").eq(0).attr('en'));
                        $("#lbRem").text($("#remember").attr('en'));
                        $("#loginByIp").html($("#loginByUserName").attr('en'));
                        $("#inputUserName").attr("placeholder", $("#inputUserName").attr('en'));
                        $("#inputPwd").attr("placeholder", $("#inputPwd").attr('en'));
                        $("#userTips").text("");
                        $("#pwdTips").text("");
                        var ipName = $("#hidIp").val();
                        $(".ip-scope").html("<p class='ip-register'>Your IP:" + ipName + "</p>");
                        $(".have-account a").eq(0).attr("href", "/foregetpassword/english");
                        menu = "english";

                    });


                    //绑定回车
                    document.onkeydown = function (e) {
                        var theEvent = window.event || e;
                        var code = theEvent.keyCode || theEvent.which;
                        if (code == 13) {
                            $('#loginByUserName').click();
                        }
                    }
                    $('#loginByUserName').click(function () {
                        $(".warning").html("");
                        var userName = escape($('#inputUserName').val());
                        var userPwd = $('#inputPwd').val();
                        var url = $('#LoginPostUrl').val();
                        var menuUrl = $('#ShowMenuQuanXianUrl').val().replace("/", "");
                        var autoLogin = $("#remember").is(":checked");
                        if (userName == undefined || userName == "") {
                            if (menu == "english") {
                                $("#userTips").html("Please enter your user name！");
                            } else {
                                $("#userTips").html("请输入用户名！");
                            }


                            return false;
                        }
                        if (userPwd == undefined || userPwd == "") {

                            if (menu == "english") {
                                $("#pwdTips").html("Please enter your password！");
                            } else {
                                $("#pwdTips").html("请输入密码！");
                            }


                            return false;
                        }

                        $.ajax(
                            {
                                beforeSend: function () {

                                    if (menu == "english") {
                                        $("#loginByUserName").html("Logining...");
                                    } else {
                                        $("#loginByUserName").html("正在登录...");
                                    }

                                },
                                url: url + "?menu=" + menu + "&isAutoLogin=" + autoLogin,
                                type: "POST",
                                data:
                                {
                                    LoginName: userName, LoginPwd: userPwd
                                },

                                success: function (data) {
                                    var result = $.parseJSON(data);
                                    if (result.State.startsWith("ok")) {
                                        var isFullLogin = $("#isFullLogin").val();
                                        if (isFullLogin == "true") {
                                            var curMenu = $("input[name='Menu']").val();
                                            var centerUrl = "/usercenter/changeuserinfo/False";
                                            var exitName = "退出";
                                            if (curMenu == "english") {
                                                centerUrl = "/usercenter/changeuserinfo/True";
                                                exitName = "Logout";
                                            }
                                            var returnStr = result.State.split('+');
                                            var exitUrl = GetUrlRelativePath();
                                            $('.login').addClass('login-after');
                                            var showHtml = " <div class='limits'><a href='javascript:void(0);' class='c-icon c-limite'>权限</a><div class='limits-wrap'></div><a href='" + centerUrl + "' target='_blank' class='user-name' title='" + returnStr[1] + "'>" + returnStr[1] + "</a><a href='/logout/?ReturnUrl=" + exitUrl + "' class='exit'>" + exitName + "</a><a href='" + centerUrl + "' target='_blank' id='iCount' style='display: none;' class='tips'></a><input type='hidden' id='LoginOutPostUrl' value='/logout'><input type='hidden' id='CountFindUnRead' value='/usercenter/countfindunread'><input type='hidden' id='IsUserLogin' value='true' />";
                                            $('.login').html(showHtml);
                                            ShowQuanX(menuUrl);
                                            if ($("#CountFindUnRead").length > 0) {
                                                $.ajax({
                                                    url: $("#CountFindUnRead").val(),
                                                    type: "POST",
                                                    data: null,
                                                    success: function (results) {
                                                        if (parseInt(results) > 0) {
                                                            $("#iCount").html(results).show();
                                                            var regiolUrl = $(".user-name").attr("href");
                                                            $(".user-name").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                                                            $("#iCount").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                                                        }
                                                    }
                                                });
                                            }
                                            $('.limits').addClassHover();
                                            layer.close(layer.index);
                                            $('#IsUserLogin').val("true");
                                            $('.isShowTian').show();
                                            RecordSearch.init();
                                        } else {
                                            window.location.reload();
                                        }




                                    } else {
                                        if (result.State == "error") {
                                            if (menu == "english") {
                                                $("#pwdTips").html("Login failure！");
                                            } else {
                                                $("#pwdTips").html("登录失败！");
                                            }

                                        } else {
                                            $("#pwdTips").html(result.State);
                                        }

                                    }
                                    if (menu == "english") {
                                        $("#loginByUserName").html("Login");
                                    } else {
                                        $("#loginByUserName").html("登&nbsp;&nbsp;录");
                                    }

                                }
                            });
                    });

                    $('#loginByIp').unbind();
                    $('#loginByIp').click(function () {
                        var menuUrl = $('#ShowMenuQuanXianUrl').val().replace("/", "");
                        $(".warning").html("");
                        var url = $('#LoginByIpPostUrl').val();
                        $.ajax(
                            {
                                beforeSend: function () {
                                    if (menu == "english") {
                                        $("#loginByIp").html("Logining...");
                                    } else {
                                        $("#loginByIp").html("正在登录...");
                                    }

                                },
                                url: url + "?menu=" + menu + "",
                                type: "POST",
                                data: null,
                                success: function (result) {
                                    if (result.startsWith("ok")) {
                                        var isFullLogin = $("#isFullLogin").val();


                                        if (isFullLogin == "true") {
                                            var curMenu = $("input[name='Menu']").val();
                                            var centerUrl = "/usercenter/changeuserinfo/False";
                                            var exitName = "退出";
                                            if (curMenu == "english") {
                                                centerUrl = "/usercenter/changeuserinfo/True";
                                                exitName = "Logout";
                                            }
                                            var returnStr = result.split('+');
                                            var exitUrl = GetUrlRelativePath();
                                            $('.login').addClass('login-after');
                                            var showHtml = " <div class='limits'><a href='javascript:void(0);' class='c-icon c-limite'>权限</a><div class='limits-wrap'></div><a href='" + centerUrl + "' target='_blank' class='user-name' title='" + returnStr[1] + "'>" + returnStr[1] + "</a><a href='/logout/?ReturnUrl=" + exitUrl + "' class='exit'>" + exitName + "</a><a href='" + centerUrl + "' target='_blank' id='iCount' style='display: none;' class='tips'></a><input type='hidden' id='LoginOutPostUrl' value='/logout'><input type='hidden' id='CountFindUnRead' value='/usercenter/countfindunread'><input type='hidden' id='IsUserLogin' value='true' />";
                                            $('.login').html(showHtml);
                                            ShowQuanX(menuUrl);
                                            if ($("#CountFindUnRead").length > 0) {
                                                $.ajax({
                                                    url: $("#CountFindUnRead").val(),
                                                    type: "POST",
                                                    data: null,
                                                    success: function (results) {
                                                        if (parseInt(results) > 0) {
                                                            $("#iCount").html(results).show();
                                                            var regiolUrl = $(".user-name").attr("href");
                                                            $(".user-name").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                                                            $("#iCount").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                                                        }
                                                    }
                                                });
                                            }
                                            $('.limits').addClassHover();
                                            layer.close(layer.index);
                                            $('#IsUserLogin').val("true");
                                            RecordSearch.init();
                                            $('.isShowTian').show();
                                        } else {
                                            window.location.reload();
                                        }
                                    } else {
                                        if (result == "error") {
                                            if (menu == "english") {
                                                $("#ipTips").html("Login failure！");
                                            } else {
                                                $("#ipTips").html("登录失败！");
                                            }

                                        } else {
                                            $(".ip-scope").html(result);
                                        }

                                    }
                                    if (menu == "english") {
                                        $("#loginByIp").html("Login");
                                    } else {
                                        $("#loginByIp").html("登&nbsp;&nbsp;录");
                                    }

                                }
                            });
                    });
                }
            });




        //登录注册判断内容高度是否超过可视区高度
        $('.login-wrap').contentHeight();
        //选项卡
        $('.register-tab a').addClassClickTab();
    });

    //登录
    $('#loginBtnBottom,#loginBtn').click(function () {

        var $link = $(this);
        var menu = $("input[name='Menu']").val();
        if (menu == undefined) {
            menu = "Index";
        }
        var url = $link.attr("url");
        $.ajax(
            {
                url: url + "?menu=" + menu,
                type: "POST",
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                },
                data: {
                    "pUrl": window.location.href
                }
                , success: function (html) {
                    layer.closeAll();
                    layer.open({
                        type: 1,
                        content: html, //内容
                        area: ['404px', '373px'], //宽带400，高度自适应
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true //点击遮罩关闭弹框
                    });
                    //选项卡
                    $('.register-tab a').addClassHoverTab();

                    $('#loginbtnofpartial').unbind();
                    //绑定回车
                    document.onkeydown = function (e) {
                        var theEvent = window.event || e;
                        var code = theEvent.keyCode || theEvent.which;
                        if (code == 13) {
                            $('#loginbtnofpartial').click();
                        }
                    }
                    $('#loginbtnofpartial').click(function () {
                        $("#newloginbtn").click();
                    });
                }
            });

        //登录注册判断内容高度是否超过可视区高度
        $('.login-wrap').contentHeight();
        //选项卡
        $('.register-tab a').addClassClickTab();
    });

    //登陆访问付费内容
    $('#loginBuyBtn').click(function () {

        var $link = $(this);
        var menu = $("input[name='Menu']").val();
        if (menu == undefined) {
            menu = "Index";
        }
        var url = $link.attr("url");
        $.ajax(
            {
                url: url + "?menu=" + menu,
                type: "POST",
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                },
                data: { "pUrl": window.location.href, "loginType": "Pay" }
                , success: function (html) {
                    layer.closeAll();
                    layer.open({
                        type: 1,
                        content: html, //内容
                        area: ['404px', '270px'], //宽带400，高度自适应
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true //点击遮罩关闭弹框
                    });

                    $("#btnhulue").click(function () {
                        layer.closeAll();
                    });

                }
            });

        //登录注册判断内容高度是否超过可视区高度
        $('.login-wrap').contentHeight();
        //选项卡
        $('.register-tab a').addClassClickTab();
    });


    //登陆后访问付费内容
    $("#loginAuthorityBtn").click(function () {
        var $link = $(this);
        var menu = $("input[name='Menu']").val();
        if (menu == undefined) {
            menu = "Index";
        }
        var authorityType = $("#authorityType").val();
        var isWeChatLogin = $("#isWechatLogin").val();
        var url = $link.attr("url");
        var newHight = "230px";
        $.ajax(
            {
                url: url + "?menu=" + menu,
                type: "POST",
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                },
                data: { "pUrl": window.location.href, "authorityType": authorityType, "isWeChat": isWeChatLogin }
                , success: function (html) {
                    layer.closeAll();
                    layer.open({
                        type: 1,
                        content: html, //内容
                        area: ['404px', newHight], //宽带400，高度自适应
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true //点击遮罩关闭弹框
                    });

                    $("#btnhulue").click(function () {
                        layer.closeAll();
                    });

                }
            });
    });

    $('#newloginbtn').click(function () {

        var $link = $(this);
        var url = $link.attr("url"); 
        var isadv = $link.attr("isadv");
        var LoginShowTitle = $("#LoginShowTitle").val();

        //处理高级检索的检索条件
        if (isadv != "" && isadv != undefined) {

            var strFilter = "";
            $("div[advsearch]").each(function () {

                var prop = $(this).attr("property");
                var searchtype = $(this).attr("searchtype");
                var targetobj = $("input[name='AdvSearchDic." + prop + "']");
                switch (searchtype) {
                    case "date":
                    case "datebetween":
                    case "number":
                    case "numberbetween":
                        var newbval = "{ 'Start': '" + $(this).find("input[start]").val() + "', 'End': '" + $(this).find("input[end]").val() + "' }";
                        targetobj.val(newbval);
                        strFilter += searchtype + "●" + prop + "★" + newbval + "◆";
                        break;
                    case "text":
                        var newtval = $.trim($(this).find("input[prop]").val());
                        targetobj.val(newtval);
                        strFilter += searchtype + "●" + prop + "★" + newtval + "◆";
                        break;
                    case "select":
                        var dialogValues = "";

                        $(this).find("span[filter_value]").each(function () {
                            dialogValues += this.getAttribute("filter_value") + ",";
                        });
                        targetobj.val(dialogValues);
                        var title = $(this).find("span").parent().attr("title");
                        strFilter += searchtype + "●" + prop + "★" + title + "■" + dialogValues + "◆";
                        break;
                    case "dropdown":
                    case "radio":
                        //var newdval = $(this).find("dd.currentSelect").attr("filter_value");
                        var newdval = $(this).find("div[showhead] span").attr("filter_value");
                        var title1 = $(this).find("div[showhead] span").attr("title");
                        if (newdval != null) {
                            targetobj.val(newdval);
                            strFilter += searchtype + "●" + prop + "★" + title1 + "■" + newdval + "◆";
                        }
                        break;
                }
            });
            //保存条件到cookie
            var advcookietime = new Date();
            advcookietime.setTime(advcookietime.getTime() + (10 * 60 * 1000)); //coockie保存一分钟
            document.cookie = "specialAdvFilter=" + strFilter + ";expires=" + advcookietime.toGMTString();
            if (LoginShowTitle != undefined) {
                window.location.href = url;
            }
        }
        else {
            //处理普通列表检索条件
            var baseRequestValue = $("input[name='QueryBase64Request']").val();
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            var filterValue = "";
            var filterItem = $("#right_form").find("input[name^='FilterItems']");
            $.each(filterItem, function (n, m) {
                if (n + 1 < filterItem.length) {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value + "$";
                } else {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value;
                }

            });
            var extValue = "";
            var extCondition = $("#right_form").find("input[name^='ExtCondition']");
            $.each(extCondition, function (l, k) {
                if (l + 1 < extCondition.length) {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value + "$";
                } else {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value;
                }
            });

            var matchType = $("input[name='MatchType']").val();

            //栏目+库别+QueryBase64Request+聚类+筛选+匹配方式+ExtCondition
            var specialFilter = $("input[name='Menu']").val() + "◆" + $("input[name='Library']").val() + "◆" + baseRequestValue + "◆" + classCodeKey + "◆" + filterValue + "◆" + matchType + "◆" + extValue;

            //保存条件到cookie
            var cookietime = new Date();
            cookietime.setTime(cookietime.getTime() + (10 * 60 * 1000)); //coockie保存一分钟
            document.cookie = "specialFilter=" + specialFilter + ";expires=" + cookietime.toGMTString();

            //搜索框中的检索词
            var keyword = $("#txtSearch").val();
            if (keyword != undefined) {
                if (keyword.length > 200) {
                    keyword = keyword.substring(0, 199);
                }
                if (keyword != null && keyword != "") {

                    document.cookie = "searchBoxKerwords=" + keyword + ";expires=" + cookietime.toGMTString();
                }
            }  
            if (LoginShowTitle != undefined) { 
                window.location.href = url;
            }
        }
      
     
    });


    $('.nav-list li').dropDowm();
    //返回顶部
    $('.mod-side-bar').returnTop();

    //取未读消息数
    if ($("#CountFindUnRead").length > 0) {
        $.ajax({
            url: $("#CountFindUnRead").val(),
            type: "POST",
            data: null,
            success: function (result) {
                if (parseInt(result) > 0) {
                    $("#iCount").html(result).show();
                    var regiolUrl = $(".user-name").attr("href");
                    $(".user-name").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                    $("#iCount").attr("href", regiolUrl.replace("changeuserinfo", "message"));
                }
            }
        });
    }

    var pathname = getQueryString("keyword");
    if ($.trim($("#txtSearch").val()) == "") {

        $("#txtSearch").val(pathname);

    }

    //搜索框中的检索词
    var searchBoxKerwords = getCookie("searchBoxKerwords");
    if (searchBoxKerwords != null) {

        //获取当前时间
        var date = new Date();
        //将date设置为过去的时间
        date.setTime(date.getTime() - 10000);
        document.cookie = "searchBoxKerwords=''; expire=" + date.toGMTString();

        var index = searchBoxKerwords.indexOf("=");
        var keywords = searchBoxKerwords.substring(index + 1, searchBoxKerwords.length).replace(';', '').replace('"', '');
        if (keywords != "" && keywords != null && keywords != "''") {
            $("#txtSearch").val(keywords);
        }

    };





    //点击栏目保留检索词
    $(".nav-list a").click(function () {
        var keyword = $.trim($("#txtSearch").val());
        if ($.trim(keyword) != "" && $(this).attr("target") == undefined) {
            var selfHref = $(this).attr("href");
            if (selfHref.indexOf("keyword") > 0) {
                var reg = new RegExp("(^|&)keyword=([^&]*)(&|$)", "i");
                var index = selfHref.indexOf("?");
                var r = selfHref.substr(index + 1).match(reg);
                var curKeryword = decodeURI(r[2]);
                selfHref = selfHref.replace(curKeryword, keyword);
            } else {
                selfHref = $(this).attr("href") + "?keyword=" + encodeURIComponent(keyword);
            }
            $(this).attr("href", selfHref);
        }
    });


    //购物车添加案例报告
    $(".caseReportLi").click(function () {


        var isUserLogin = $("#IsUserLogin").val();
        //用户未登录
        if (isUserLogin != "true") {
            $("#loginBuyBtn").click();
            return false;
        } else {
            var authorityType = $("#authorityType").val();
            if (authorityType != "ValidUser") {
                $("#loginAuthorityBtn").click();
                return false;
            }
        }

        $U.showProgress();

        var title = "案例检索报告";
        var gids = $("#shoppingCartGid").val();

        //if (gids != null && gids != "") {
        $.post("/Full/CaseReportShoppingCart", {
            newcasegids: gids
        }, function (html) {



            $U.hideProgress();
            layer.open({
                content: html, //内容
                area: ['830px', '580px'],
                title: title, //不要标题栏
                fix: false, //不随滚动条滚动
                move: false, //不可移动
                btn: false, //按钮不展示           
                shade: [0.01, '#000'],
                //offset: ['0px', '0px'],//定位
                success: function () {


                    //购物车案例
                    var shoppingGids = $("#shoppingGids").val();

                    if (shoppingGids == null || shoppingGids == "") {
                        //购物车窗口数量                  
                        $("#articleCount").html(0);
                        //滚动栏购物车数量
                        //$('.number').html(0);
                        $("span[name='caseReportNum']").html(0);
                        $("#shoppingCartGid").val("");

                        //$('.number').hide();
                        $("span[name='caseReportNum']").hide(0);
                    } else {
                        var num = shoppingGids.split(',').length;
                        //购物车窗口数量     
                        $("#articleCount").html(num);
                        //滚动栏购物车数量
                        //$('.number').html(num);
                        $("span[name='caseReportNum']").html(num);
                        $("#shoppingCartGid").val(shoppingGids);

                        //$('.number').show();
                        $("span[name='caseReportNum']").show(0);
                    }




                    //选项卡
                    $('#selectReport').click(function () {
                        $('.current-list').show();

                        $('#selectReportDiv').show();
                        $('#newReportDiv').hide();

                        var count = $('.current-list').length + $('.shopping-list').length;
                        $("#articleCount").html(count);
                    });

                    $('#newReport').click(function () {
                        $('.current-list').hide();

                        $('#selectReportDiv').hide();
                        $('#newReportDiv').show();

                        var count = $('.shopping-list').length;
                        $("#articleCount").html(count);

                    });


                    $("#report").change(function () {

                        var gidParam = new Array();

                        $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                            gidParam.push($(this).val());
                        });

                        $("input[name='caseReportId']").val($(this).val());
                        $("input[name='newcasegids']").val(gidParam);

                        $("#report_form").submit();

                    });



                    //添加报告
                    $('#NewshoppingCart,#OldshoppingCart').click(function () {

                        var arraygids = new Array();
                        var casegids = "";
                        var reportId = "";
                        var reportTitle = "";
                        //报告类型
                        var reportType = $("input[name='reportType']:radio:checked").val();
                        if (reportType == "report") {
                            $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                                arraygids.push($(this).val());
                            });

                            reportTitle = $("#reportTitle").val();
                            if (reportType != "reportArticle") {
                                if (reportTitle == "" || reportTitle == null) {
                                    alert("报告名称不能为空");
                                    return false;
                                };
                            }
                        } else {
                            var options = $("#report option:selected"); //获取选中的项
                            reportId = options.val();
                            if (reportId == "clear") {
                                alert("请选择检索报告");
                                return false;
                            }

                            $("#shoppingList").find("input[name='shoppingGid']").each(function () {
                                arraygids.push($(this).val());
                            });
                            $("#shoppingList").find("input[name='caseReportGid']").each(function () {
                                arraygids.push($(this).val());
                            });

                        }
                        if (arraygids.length == 0) {
                            alert("请选择要添加的案例");
                            return false;
                        }

                        casegids = arraygids.join(",");

                        var form = $("<form></form>");
                        form.attr('action', "/UserRelated/GenerateReport");
                        form.attr('method', 'post');
                        form.attr('target', '_blank');

                        form.append("<input name='reportType' value='" + reportType + "'/>");
                        form.append("<input name='reportTitle' value='" + reportTitle + "'/>");
                        form.append("<input name='reportId' value='" + reportId + "'/>");
                        form.append("<input name='casegids' value='" + casegids + "'/>");

                        form.appendTo("body");
                        form.css('display', 'none');
                        form.submit();
                        form.remove();

                        layer.closeAll();

                        //var gidArray = new Array();
                        //$("#shoppingList").find("input[name='shoppingGid']").each(function () {
                        //    gidArray.push($(this).val());
                        //});
                        //if (gidArray.length > 0) {

                        //    gidArray = gidArray.join(",");

                        //    $.post("/Full/DeleteShoppingCart", { gids: gidArray }, function (data) {
                        //        if (data != "0") {

                        //            $(".number").html(0);
                        //            $("#articleCount").html(0);
                        //            $("#shoppingCartGd").val("");
                        //            $("#shoppingList").find("li").remove();
                        //            $(".grid-right").find("div[class='search-report-wrap']").find("i").attr("class", "c-icon c-search-report-on");
                        //        }
                        //    });
                        //}
                        //layer.closeAll();

                        //$.post("/UserRelated/GenerateReport", {                                    
                        //    reportType: reportType,
                        //    reportTitle: reportTitle,
                        //    reportId: reportId,
                        //    casegids: casegids
                        //}, function(data) {
                        //    if (data == "true") {
                        //        $('.form').hide();
                        //        $('.succeed').show();
                        //    } else if (data == "false") {
                        //        alert("案例报告中已有此篇文章！");
                        //    } else {
                        //        alert("案例报告最多添加100篇文章！");
                        //    }

                        //});


                    });
                }
            });
        });
        //} else {
        //    $U.hideProgress();
        //    alert("请先选择案例报告！");
        //}
    });




    //栏目无权限弹窗
    if (($("#PermissionWarn").val() != undefined && $("#PermissionWarn").val() != '') || ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() != '') || ($("#GroupWarn").val() != undefined && $("#GroupWarn").val() != '') || ($("#IsHaveWeChatLoginMenu").val() != undefined && $("#IsHaveWeChatLoginMenu").val() != '')) {

        var area = $("#areaHiddenId").val();
        var newBuyUrl = "/ActivePage/BuyActivePage";
        var urlType = $("#UrlBuyType").val();
        var isLawyer = $("#IsLawyer").val();
        if (urlType != "") {
            if (urlType == "false") {
                newBuyUrl = "https://www.pkulaw.com/helps/63.html";
            }
        }
        var areaName = "法律法规";
        if (area == "case") {
            areaName = "司法案例";
        }
        if (area == "journal") {
            areaName = "法学期刊";
        }
        if (area == "lawfirm") {
            areaName = "律所实务";
        }
        if (area == "reference") {
            areaName = "专题参考";
        }
        if (area == "english") {
            areaName = "English";
        }
        if (area == "video") {
            areaName = "法宝视频";
        }
        if (area == "procuratorate") {
            areaName = "检察文书";
        }
        if (area == "penalty") {
            areaName = "行政处罚";
        }
        var html = "";
        if ($("#IsHaveWeChatLoginMenu").val() != undefined && $("#IsHaveWeChatLoginMenu").val() == 'True') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in the Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">Your Package for Lawyers purchased with WeChat is only used through WeChat for your access.</p><div class=\"btn-wrap\"><div class=\"two\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a><a href=\"/logout\">WeChat Login</a></div></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您已购买1898律师套餐，是否通过微信登录获取权限?</p><div class=\"btn-wrap\"><div class=\"two\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续</a><a  href=\"/logout\">微信登录</a></div></div></div></div>";
            }
        } else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'true') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"three\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"../usercenter/bindaccount/True\">Account Binding</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">Trial Account Application</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"three\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"../usercenter/bindaccount/False\">绑定账号</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">试用</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
            //<div><a href=\"http://chinalawinfo.com/adhtml/20180817/\" target=\"_blank\"><img width='410' src=\"https://www.pkulaw.com/Content/images/lawyerActivePage.jpg\" /></a></div>
        } else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'false') {
            if (area == "english") {
                if (isLawyer == "true") {
                    html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"../usercenter/bindaccount/True\">Account Binding</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
                } else {
                    html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"../usercenter/bindaccount/True\">Account Binding</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
                }
            } else {
                if (isLawyer == "true") {
                    html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"../usercenter/bindaccount/False\">绑定账号</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
                } else {
                    html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"../usercenter/bindaccount/False\">绑定账号</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
                }
            }
            //<div><a href=\"http://chinalawinfo.com/adhtml/20180817/\" target=\"_blank\"><img width='410' src=\"https://www.pkulaw.com/Content/images/lawyerActivePage.jpg\" /></a></div>
        } else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'JiTuanTrue') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">Trial Account Application</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">试用</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div><div class=\"ad\"></div>";
            }
            //<div><a href=\"http://chinalawinfo.com/adhtml/20180817/\" target=\"_blank\"><img width='410' src=\"https://www.pkulaw.com/Content/images/lawyerActivePage.jpg\" /></a></div>
        } else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'JiTuanFalse') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"one\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"one\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
            //<div><a href=\"http://chinalawinfo.com/adhtml/20180817/\" target=\"_blank\"><img width='410' src=\"https://www.pkulaw.com/Content/images/lawyerActivePage.jpg\" /></a></div>
        } else if ($("#PermissionWarn").val() != undefined && $("#PermissionWarn").val() == 'true') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"three\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"../usercenter/bindaccount/True\">Account Binding</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">Trial Account Application</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"three\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"../usercenter/bindaccount/False\">绑定账号</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">试用</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
        } else if ($("#PermissionWarn").val() != undefined && $("#PermissionWarn").val() == 'false') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"../usercenter/bindaccount/True\">Account Binding</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"../usercenter/bindaccount/False\">绑定账号</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
        } else if ($("#GroupWarn").val() != undefined && $("#GroupWarn").val() == 'true') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">Trial Account Application</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">试用</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
        } else if ($("#GroupWarn").val() != undefined && $("#GroupWarn").val() == 'false') {
            if (area == "english") {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">You have signed in Pkulaw.cn</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">You can get full access to English Databases by the following means: </p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">Purchase</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">Trial Account Application</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">Proceed</a></div></div></div>";
            } else {
                html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您可用下列方式获取" + areaName + "数据库全部权限</p><div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"" + newBuyUrl + "\">购买</a><a target=\"_blank\" href=\"/applyTryOutsLayer\">试用</a></div></div><div class=\"go-on\"><a href=\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div>";
            }
        }
        if ($("#IsHaveWeChatLoginMenu").val() != undefined && $("#IsHaveWeChatLoginMenu").val() == 'True') {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['620px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['450px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        }
        else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'false') {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['480px', '230px'],//['450px', '380px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['410px', '230px'],//['410px', '287px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        } else if ($("#WeChatUnion").val() != undefined && $("#WeChatUnion").val() == 'true') {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['700px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['410px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        } else if ($("#WeChatUnion").val() != undefined && ($("#WeChatUnion").val() == 'JiTuanTrue' || $("#WeChatUnion").val() == 'JiTuanFalse')) {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['600px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['410px', '230px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        }
        else if ($("#PermissionWarn").val() != undefined && $("#PermissionWarn").val() != '') {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    content: html, //内容
                    area: ['700px', '230px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    content: html, //内容
                    area: ['410px', '230px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        } else {
            if (area == "english") {
                var layerIndex = layer.open({
                    type: 1,
                    content: html, //内容
                    area: ['600px', '210px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            } else {
                var layerIndex = layer.open({
                    type: 1,
                    content: html, //内容
                    area: ['410px', '230px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: true, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerIndex);
                        });
                    }
                });
            }
        }
    };
    $("#layui-layer2").map(function () {
        layer.close(layerIndex);
    });


    var isHaveSingleBuyRight = $("#isHaveSingleBuyRight").val();
    if (isHaveSingleBuyRight != "" && isHaveSingleBuyRight != undefined) {
        if (isHaveSingleBuyRight == "true") {


            var paycode = "";

            var reg = new RegExp("(^|&)paycode=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                paycode = unescape(r[2]);
            }
            if (paycode != "" && paycode != undefined) {
                $.get("https://wxcallback.pkulaw.cn/api/ApiTakeDate", {
                    paycode: paycode
                }, function (data) {

                    var str = "<div class='layer-wrap'><div class='download-tips'><strong style='color:#218fc4;'>法小宝提醒您：</strong>此链接有效期到" + data + "为止，为方便您下次查阅请将此文档下载到本地。</div></div>";

                    var downBtn = $(".c-down");
                    var off = downBtn.offset();
                    off.top = off.top - $U.getViewPortScrollY() + 30;
                    off.left = off.left - 620;

                    layer.open({
                        content: str, //内容
                        offset: [off.top, off.left], //定位
                        area: ['650px', '65px'], //宽带400，高度自适应
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示
                        shade: [0.05, '#000'], //遮罩透明度
                        shadeClose: true //点击遮罩关闭弹框
                    });
                });
            }
        }
    }



    //更新优化小红点
    $("#updateNote").click(function () {
        var showCookie = getCookie("updateRedSpot");
        if (showCookie == null) {
            var cookietime = new Date();
            cookietime.setTime(cookietime.getTime() + (24 * 60 * 60 * 1000)); //coockie保存24小时
            document.cookie = "updateRedSpot=false;expires=" + cookietime.toGMTString() + ";path=/";
        };

        var updateredSpot = $("#updateredSpot");
        if (updateredSpot.length > 0) {
            updateredSpot.hide();
        }
    });


    $('.more-fields a').click(function () {
        if ($('.more-fields a').find('.c-icon').hasClass('arrow-down')) {
            $('.field-wrap .fields-height').css({
                height: 'auto'
            })
            $('.arrow-down').addClass('arrow-up').removeClass('arrow-down');
            $('.more-fields a span').text('收起')
        } else {
            $('.field-wrap .fields-height').css({
                height: '82'
            })
            $('.arrow-up').addClass('arrow-down').removeClass('arrow-up');
            $('.more-fields a span').text($(this).attr('content'))
        }
    });
});

//法宝联想点击更多按钮
function moreclick(t) {
    var me = $(t);
    var meAttrText = me.attr('text');
    if ("更多" == meAttrText) {
        if (parseInt(me.parent().find('#detail').height()) > 150) {
            me.parent().find('#detail').css({
                height: 150,
                overflow: 'hidden'
            });
            me.siblings().show();
        } else {
            me.parent().find('#detail').css({
                height: 'auto',
                overflow: 'auto'
            });
            me.hide();
        }

        me.attr('text', me.html());
        me.html(meAttrText);
    } else {
        $('.single-detail div#detail').css({
            height: 'auto',
            overflow: 'auto'
        });
        me.attr('text', me.html());
        me.html(meAttrText);
    }
}

//案例库法宝联想中的更多加登录判断
function associationMore() {

    var isLogin = $("#IsUserLogin").val();

    if (isLogin != "true") {
        $("#loginBtn").click();
        return false;
    }
}

//根据参数名获取参数内容
function GetUrlParam(paraName) {
    var url = document.location.toString();
    var arrObj = url.split("?");

    if (arrObj.length > 1) {
        var arrPara = arrObj[1].split("&");
        var arr;

        for (var i = 0; i < arrPara.length; i++) {
            arr = arrPara[i].split("=");

            if (arr != null && arr[0] == paraName) {
                return arr[1];
            }
        }
        return "";
    }
    else {
        return "";
    }
}

function GetUrlRelativePath() {
    var url = document.location.toString();
    var arrUrl = url.split("//");

    var start = arrUrl[1].indexOf("/");
    var relUrl = arrUrl[1].substring(start);//stop省略，截取从start开始到结尾的所有字符

    if (relUrl.indexOf("?") != -1) {
        relUrl = relUrl.split("?")[0];
    }
    return relUrl;
}


String.prototype.startsWith = function (str) {
    var reg = new RegExp("^" + str);
    return reg.test(this);
}


$(function () {

    $("#returnAll").click(function () {
        var rootUrl = window.location.pathname;
        var reg = new RegExp(/condition/, 'gi');
        if (reg.test(rootUrl)) {
            rootUrl = rootUrl.replace('condition', '');
        }
        window.location.href = rootUrl;
    });

});

$(function () {
    //正文操作下拉展开
    $('.operation-btn').on('click', function () {
        var me = $(this);
        var operaSub = $('.operation-sub');
        if (operaSub.css('display') == 'none') {
            me.addClass('current');
            operaSub.slideDown();
        } else {
            operaSub.slideUp();
            me.removeClass('current');
        }
    })
});

(function ($, window, document, undefined) {
    if (!window.browser) {

        var userAgent = navigator.userAgent.toLowerCase(), uaMatch;
        window.browser = {}
        function isIE() {
            return ("ActiveXObject" in window);
        }
        if (!uaMatch) {
            if (userAgent.match(/msie ([\d.]+)/) != null) {
                uaMatch = userAgent.match(/msie ([\d.]+)/);
                window.browser['name'] = 'ie';
                window.browser['version'] = uaMatch[1];
            } else {
                if (isIE() && !!document.attachEvent && (function () {
                    "use strict"; return !this;
                }())) {
                    window.browser['name'] = 'ie';
                    window.browser['version'] = '10';
                } 
                if (isIE() && !document.attachEvent) {
                    window.browser['name'] = 'ie';
                    window.browser['version'] = '11';
                }
            }
        }
        if (!$.isIE) {
            $.extend({
                isIE: function () {
                    return (window.browser.name == 'ie');
                }
            });
        }
    }
})(jQuery, window, document);

//检查敏感词后端
function CheckSword(str) {
    var swords = true;
    $.ajax({
        type: "Get",
        url: "/Tool/CheckSensitiveSword",
        data: {
            sensitive: str
        },
        async: false,
        success: function (result) {
            if (result != "") {
                swords = false;
            }
        }
    });
    return swords;
}


//获取关闭广告的cookie
function getCookie(name) {
    var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

    if (arr = document.cookie.match(reg))

        return unescape(arr[0]);
    else
        return null;
}

//检查敏感词前端
function CheckSensitiveSword(senWord) {
    var swords = true;
    $.ajax({
        url: "/config/xml/sensitive_words.xml",
        dataType: 'xml',
        async: false,
        type: 'GET',       
        success: function (data) {
            if (data != null) {
                var valueHtml = $(data).find("value");
                var sensitWords = valueHtml[0].textContent;
                var cebReg = new RegExp(sensitWords);
                var isSentiWord = senWord.match(cebReg);
                if (isSentiWord != null) {
                    swords = false;
                }
            }
        },
        error: function (error) {
            var errors = error;
        }
    })
    return swords;
}




function delHtmlTag(str) {
    return str.replace(/<[^>]+>/g, ""); //去掉所有的html标记
}



//同义词浮窗
$('.synonym>div').addParentClassHover();

//列表单篇正文下载
function downloadSingleFulltext() {

    var gid = $("#downLoadGid").val();
    var lib = $("#library").val();
    var isEn = $("#isEn").val();
    if (lib == "gdd") {
        lib = $("#gddLib").val();
    }
    var keepfields = $("input[name='fields']").is(':checked');
    var downloadUrl = "/Tool/DownloadFulltext";
    var url = "";
    var currentUrl = window.location.href;

    if (isEn == "true") {


        var fileType = $(".down-content input[name='formatType']:checked").val();
        var viewType = $(".down-content input[name='viewType']:checked").val();

        url += "?library=" + lib + "&gid=" + gid + "&type=" + fileType + "&flag=" + viewType + "&keepFields=" + keepfields + "&keepFblxInFulltext=false&keepRelatedFile=false&tbWidth=880&downloadType=DownloadFile&currentUrl=" + currentUrl;
        downloadUrl += url

    } else {
        var type = $(".down-content input[name='downLoadType']:checked").val();
        url += "?library=" + lib + "&gid=" + gid + "&type=" + type + "&flag=" + type + "&keepFields=false&keepFblxInFulltext=false&keepRelatedFile=false&tbWidth=880&downloadType=DownloadFile&currentUrl=" + currentUrl;
        downloadUrl += url
    }



    var checkLimitUrl = "/Tool/CheckDownloadLimit";
    var data = { "downloadType": "DownloadFullText", "library": lib, "gids": gid, "curLib": lib };
    if (!checkIsLimited(checkLimitUrl, data)) {
        window.location.href = downloadUrl;
        layer.closeAll();
    }

}

function checkIsLimited(url, data) {
    //先查询下载数量是否被限制，
    var isLimited = true;
    $.ajax({
        type: "POST",
        url: url,
        data: data,
        async: false,
        contentType: "application/x-www-form-urlencoded; charset=utf-8",
        success: function (result) {
            isLimited = false;

        },
        error: function (result) {

            isLimited = true;
            //被限制，弹窗提醒
            var html = result.responseText;
            var layerIndex = layer.open({
                type: 1,
                title: false, //不显示标题
                area: ['475px', 'auto'],
                offset: 'auto',
                btn: false,
                move: false, //不可移动
                content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                shade: [0.05, '#000'], //遮罩透明度
                shadeClose: true, //点击遮罩关闭弹框
                success: function () {
                    $('#BtnCloseLayer').click(function () {
                        layer.close(layerIndex);
                    });
                }
            });
        }
    });
    return isLimited;
}
function GetDesEnCryptyTooken(library, gid) {

    var paramValue = "";
    $.ajax({
        type: "Get",
        url: "/Tool/GetDesEnCryptyTooken",
        data: {
            library: library,
            gid: gid
        },
        async: false,
        success: function (result) {
            if (result != "") {
                paramValue = result;
            }
        }
    });
    return paramValue;
}




////页脚的案例对比点击事件，打开案例对比盒子
//$(".caseComparetLi").click(function () {
//    $.post("/Tool/CaseCompareBox", function (result) {
//        if (result != null) {
//            var resultJson = JSON.parse(result);
//            var resState = resultJson.resState;
//            var resMessage = resultJson.resMessage;

//            if (resState == "noCase") {
//                resMessage = "<div class=\"layer-wrap\"><h4 class=\"title\">案例对比</h4><div class=\"tip-col-wrap\">" +
//                    "<p class=\"tip-col\">您当前还未选择案例，快去添加吧！</p><div class=\"btn-wrap\"><div class=\"one\">" +
//                    "<a class=\"empty\" href=\"javascript:layer.closeAll()\">确定</a>" +
//                    "</div></div></div></div>";
//                layer.closeAll();
//                layer.open({
//                    type: 1,
//                    content: resMessage, //内容 
//                    area: ['500px', '200px'],
//                    title: false, //不要标题栏
//                    fix: false, //不随滚动条滚动
//                    move: false, //不可移动         
//                    shade: [0.01, '#000'],
//                    success: function () {
//                    }, cancel: function () {
//                        layer.closeAll();
//                    }
//                });
//            } else if (resState == "haveCase") {
//                layer.closeAll();
//                layer.open({
//                    type: 1,
//                    title: false,
//                    shade: 0,
//                    area: ['1000px', '160px'],
//                    content: resMessage,
//                    success: function (layero, index) {

//                        $('#layui-layer' + index).css({
//                            bottom: '2px',
//                            border: '2px solid #218fc4',
//                            top: 'auto'
//                        });
//                        $(window).resize(function () {
//                            $('#layui-layer' + index).css({
//                                bottom: '2px',
//                                top: 'auto'
//                            })
//                        })
//                        $('.diff-wrap .block .list-title').each(function () {
//                            let me = $(this);
//                            me.hover(function () {
//                                me.next('.mask').show();
//                                me.next('.mask').animate({
//                                    height: '100%',
//                                    opacity: 1
//                                })
//                            })

//                            me.parents('.block').mouseleave(function () {
//                                $(this).find('.mask').animate({
//                                    height: 0,
//                                    opacity: 0,
//                                    callback: function () {
//                                        me.next('.mask').hide();
//                                    }
//                                });
//                            })
//                        });
//                    }, cancel: function () {

//                    }
//                });


//                //盒子弹窗中的对比按钮点击事件
//                $("#btnCaseCompare").click(function () {

//                    $.post("/Tool/GetCaseCompareBoxCount", function (result) {

//                        var resultStr = "<div class=\"layer-wrap\"><h4 class=\"title\">案例对比</h4><div class=\"tip-col-wrap\">" +
//                            "<p class=\"tip-col\">您当前还未选择案例，快去添加吧！</p><div class=\"btn-wrap\"><div class=\"one\">" +
//                            "<a class=\"empty\" href=\"javascript:layer.closeAll()\">确定</a>" +
//                            "</div></div></div></div>";



//                        var resultJson = JSON.parse(result);
//                        var resState = resultJson.result;
//                        var resRowCount = resultJson.rowCount;
//                        if (resState == "Y") {
//                            if (resRowCount == 0) {
//                                layer.closeAll();
//                                layer.open({
//                                    type: 1,
//                                    content: resultStr, //内容 
//                                    area: ['500px', '200px'],
//                                    title: false, //不要标题栏
//                                    fix: false, //不随滚动条滚动
//                                    move: false, //不可移动         
//                                    shade: [0.01, '#000'],
//                                    success: function () {
//                                    }, cancel: function () {
//                                        layer.closeAll();
//                                    }
//                                });
//                            } else {
//                                var url = GetUrlRelativePath();
//                                window.location.href = "/Tool/CaseComparePage?returnUrl=" + url;
//                            }
//                        } else if (resState == "N") {

//                        }
//                    });
//                });
//                //删除单条案例
//                $("div[name='delCaseFromBox']").click(function () {
//                    var curBtn = $(this);
//                    var caseGid = curBtn.attr("currGid");
//                    $.post("/Tool/DeleteCaseCompareBox", { caseGid: caseGid }, function (result) {

//                        var rowCount = JSON.parse(result).rowCount;
//                        var rel = JSON.parse(result).result;

//                        if (rowCount > 0 && rowCount < 5 && rel == "Y") {
//                            var sort = curBtn.parent().attr("sort");
//                            curBtn.parent().attr("style", "display:none");
//                            $("#more_" + sort).attr("style", "display:inline-block");
//                        }
//                        else {
//                            layer.closeAll();
//                        }
//                        if (rowCount <= 0) {
//                            $("span[name='caseCompareNum']").hide();
//                            $(this).attr("class", "contrast addCaseCompare");
//                        }

//                        $("span[name='caseCompareNum']").html(rowCount);
//                        $(".addCaseCompare").each(function () {
//                            if ($(this).attr("curGid") == caseGid) {
//                                $(this).html("<i class=\"c-icon c-contrast\"></i>案例对比");
//                                $(this).attr("class", "contrast addCaseCompare");
//                            }

//                        });
//                    });

//                });

//                //清空案例
//                $("#removeAll").click(function () {
//                    $.post("/Tool/RemoveAllCompareBox", function (result) {

//                        var rowCount = JSON.parse(result).rowCount;
//                        var rel = JSON.parse(result).result;

//                        if (rel == "Y") {
//                            layer.closeAll();
//                        }
//                        $("span[name='caseCompareNum']").html(0);
//                        $("span[name='caseCompareNum']").hide();

//                        $(".addCaseCompare").each(function () {
//                            $(this).html("<i class=\"c-icon c-contrast\"></i>案例对比");
//                            $(this).attr("class", "contrast addCaseCompare");
//                        });

//                    });
//                });
//            }
//        }
//    });
//});

//$("#toolBarCaseCompare").click(function () {

//    var curBtn = $(this);
//    if (curBtn.innerText == "已加入对比" || curBtn.innerText == "") {
//        return;
//    }
//    var isUserLogin = $("#IsUserLogin").val();
//    //用户未登录
//    if (isUserLogin != "true") {
//        $("#loginBuyBtn").click();
//        return false;
//    } else {
//        var authorityType = $("#authorityType").val();
//        if (authorityType != "ValidUser") {
//            $("#loginAuthorityBtn").click();
//            return false;
//        }
//    }

//    $U.showProgress();

//    var signal = $("#toolBarCaseCompare");
//    var gid = $("#toolBarCaseCompare").attr("curgid");
//    var lib = $("input[name='curLib']").val();
//    var title = $("#toolBarCaseCompare").attr("curtitle");
//    var relatedIfno = $("#toolBarCaseCompare").attr("relatedIfno");
//    var catagroy = $("#toolBarCaseCompare").attr("catagroy");

//    $.post("/Tool/AddToCaseCompareBox", { library: lib, caseGid: gid, title: title, relatedInfo: relatedIfno, category: catagroy }, function (result) {
//        $U.hideProgress();
//        if (result == null) {
//            return;
//        }

//        var resultObj = JSON.parse(result);
//        var state = resultObj.state;
//        var message = resultObj.message;
//        var num = resultObj.num;
//        if (state == "success") {
//            signal.html("<i class='c-icon c-contrast-selected'></i>已加入对比");
//            //signal.html("<span class='contrast' curGid=''><i class='c-icon c-contrast-selected addCaseCompare'></i>已加入对比</span>");
//            //文章数量
//            $("span[name='caseCompareNum']").show();
//            $("span[name='caseCompareNum']").html(num);
//            $("#toolBarCaseCompare").attr("class", "contrast addCaseCompare current");

//            signal.find("i").attr("class", "c-icon c-contrast-selected");

//            //动画效果 数量添加
//            $("span[name='caseCompareNum']").animate({ 'font-size': '30px', opacity: '0.3' });
//            $("span[name='caseCompareNum']").animate({ 'font-size': '12px', opacity: '1' });

//            $("div[name='caseCompareMore']").each(function () {
//                if ($(this).attr("style") == "display:inline-block") {
//                    $(this).attr("style", "display:none");
//                    var sort = $(this).attr("sort");
//                    var newTitle = title;
//                    if (title.Length >= 36) {
//                        newTitle = title.Substring(0, 35) + "...";
//                    }

//                    $("#title_" + sort).attr("style", "display:inline-block");


//                    $("#title_" + sort).children().first().children().first().attr("title", title).text(newTitle);
//                    $("#title_" + sort).children().first().next().attr("currgid", gid).attr("title", title);
//                    return false;
//                }
//            });
//            return;

//        } else if (state == "haveCase" || state == "failure") {

//            alert(message);

//        } else if (state == "moreCase") {

//            var html = "<div class=\"layer-wrap\"><h4 class=\"title\">案例对比</h4><div class=\"tip-col-wrap\">" +
//                "<p class=\"tip-col\">每次可最多加入5个案例</p><div class=\"btn-wrap\"><div class=\"two\">" +
//                "<a href=\"javascript:layer.closeAll()\">确定</a>" +
//                "</div></div></div></div>";

//            layer.open({
//                content: html, //内容
//                area: ['400px', '220px'],
//                title: false, //不要标题栏
//                fix: false, //不随滚动条滚动
//                move: false, //不可移动
//                btn: false, //按钮不展示
//                shade: [0.01, '#000'],
//                success: function () {

//                }, cancel: function () {
//                    layer.closeAll();
//                    RecordSearch.init();
//                }
//            });
//        }
//        $('.diff-wrap .block .list-title').each(function () {
//            let me = $(this);
//            me.hover(function () {
//                me.next('.mask').show();
//                me.next('.mask').animate({
//                    height: 77,
//                    opacity: 1
//                })
//            })
//            me.mouseleave(function () {
//                $(this).next('.mask').animate({
//                    height: 0,
//                    opacity: 0,
//                    callback: function () {
//                        me.next('.mask').hide();
//                    }
//                });
//            })
//        });
//    });

//});;
var $U =
{

    showProgress : function(message, target)
    {
        layerLoad.Open();
    },

    hideProgress : function()
    {
        layerLoad.Close();
    },

    confirm : function(title, message, okHandler,cancelHandler)
    {
        //todo
        layer.confirm(message, options, yes, cancel);
    },

    messageBox : function(title, message, isError, onOk) {
        layer.msg(message, options, end);
    },

    blockUI : function()
    {
        layerLoad.Open();
    },

    unblockUI : function()
    {
        layerLoad.Close();
    },

    center : function(e)
    {
        var x = (($U.getViewPortWidth() - e[0].offsetWidth) /2);
        var y = (($U.getViewPortHeight() - e[0].offsetHeight) /2) + $U.getViewPortScrollY();

        $U.setLocation(e, x, y);
    },

    setLocation : function(e, x, y)
    {
        e.css({position : 'absolute', left : (x + 'px'), top : (y + 'px')});
    },

    getViewPortWidth : function()
    {
        var width = 0;

        if ((document.documentElement) && (document.documentElement.clientWidth))
        {
            width = document.documentElement.clientWidth;
        }
        else if ((document.body) && (document.body.clientWidth))
        {
            width = document.body.clientWidth;
        }
        else if (window.innerWidth)
        {
            width = window.innerWidth;
        }

        return width;
    },

    getViewPortHeight : function()
    {
        var height = 0;

        if (window.innerHeight)
        {
            height = (window.innerHeight);
        }
        else if ((document.documentElement) && (document.documentElement.clientHeight))
        {
            height = document.documentElement.clientHeight;
        }

        return height;
    },

    getContentHeight : function()
    {
        if (document.body)
        {
            if (document.body.scrollHeight)
            {
                return document.body.scrollHeight;
            }

            if (document.body.offsetHeight)
            {
                return document.body.offsetHeight;
            }
        }

        return 0;
    },

    getViewPortScrollX : function()
    {
        var scrollX = 0;

        if ((document.documentElement) && (document.documentElement.scrollLeft))
        {
            scrollX = document.documentElement.scrollLeft;
        }
        else if ((document.body) && (document.body.scrollLeft))
        {
            scrollX = document.body.scrollLeft;
        }
        else if (window.pageXOffset)
        {
            scrollX = window.pageXOffset;
        }
        else if (window.scrollX)
        {
            scrollX = window.scrollX;
        }

        return scrollX;
    },

    getViewPortScrollY : function()
    {
        var scrollY = 0;

        if ((document.documentElement) && (document.documentElement.scrollTop))
        {
            scrollY = document.documentElement.scrollTop;
        }
        else if ((document.body) && (document.body.scrollTop))
        {
            scrollY = document.body.scrollTop;
        }
        else if (window.pageYOffset)
        {
            scrollY = window.pageYOffset;
        }
        else if (window.scrollY)
        {
            scrollY = window.scrollY;
        }

        return scrollY;
    }
};;
(function (global) { "use strict"; var _Base64 = global.Base64; var version = "2.3.2"; var buffer; if (typeof module !== "undefined" && module.exports) { try { buffer = require("buffer").Buffer } catch (err) { } } var b64chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"; var b64tab = function (bin) { var t = {}; for (var i = 0, l = bin.length; i < l; i++) t[bin.charAt(i)] = i; return t }(b64chars); var fromCharCode = String.fromCharCode; var cb_utob = function (c) { if (c.length < 2) { var cc = c.charCodeAt(0); return cc < 128 ? c : cc < 2048 ? fromCharCode(192 | cc >>> 6) + fromCharCode(128 | cc & 63) : fromCharCode(224 | cc >>> 12 & 15) + fromCharCode(128 | cc >>> 6 & 63) + fromCharCode(128 | cc & 63) } else { var cc = 65536 + (c.charCodeAt(0) - 55296) * 1024 + (c.charCodeAt(1) - 56320); return fromCharCode(240 | cc >>> 18 & 7) + fromCharCode(128 | cc >>> 12 & 63) + fromCharCode(128 | cc >>> 6 & 63) + fromCharCode(128 | cc & 63) } }; var re_utob = /[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g; var utob = function (u) { return u.replace(re_utob, cb_utob) }; var cb_encode = function (ccc) { var padlen = [0, 2, 1][ccc.length % 3], ord = ccc.charCodeAt(0) << 16 | (ccc.length > 1 ? ccc.charCodeAt(1) : 0) << 8 | (ccc.length > 2 ? ccc.charCodeAt(2) : 0), chars = [b64chars.charAt(ord >>> 18), b64chars.charAt(ord >>> 12 & 63), padlen >= 2 ? "=" : b64chars.charAt(ord >>> 6 & 63), padlen >= 1 ? "=" : b64chars.charAt(ord & 63)]; return chars.join("") }; var btoa = global.btoa ? function (b) { return global.btoa(b) } : function (b) { return b.replace(/[\s\S]{1,3}/g, cb_encode) }; var _encode = buffer ? buffer.from && buffer.from !== Uint8Array.from ? function (u) { return (u.constructor === buffer.constructor ? u : buffer.from(u)).toString("base64") } : function (u) { return (u.constructor === buffer.constructor ? u : new buffer(u)).toString("base64") } : function (u) { return btoa(utob(u)) }; var encode = function (u, urisafe) { return !urisafe ? _encode(String(u)) : _encode(String(u)).replace(/[+\/]/g, function (m0) { return m0 == "+" ? "-" : "_" }).replace(/=/g, "") }; var encodeURI = function (u) { return encode(u, true) }; var re_btou = new RegExp(["[À-ß][-¿]", "[à-ï][-¿]{2}", "[ð-÷][-¿]{3}"].join("|"), "g"); var cb_btou = function (cccc) { switch (cccc.length) { case 4: var cp = (7 & cccc.charCodeAt(0)) << 18 | (63 & cccc.charCodeAt(1)) << 12 | (63 & cccc.charCodeAt(2)) << 6 | 63 & cccc.charCodeAt(3), offset = cp - 65536; return fromCharCode((offset >>> 10) + 55296) + fromCharCode((offset & 1023) + 56320); case 3: return fromCharCode((15 & cccc.charCodeAt(0)) << 12 | (63 & cccc.charCodeAt(1)) << 6 | 63 & cccc.charCodeAt(2)); default: return fromCharCode((31 & cccc.charCodeAt(0)) << 6 | 63 & cccc.charCodeAt(1)) } }; var btou = function (b) { return b.replace(re_btou, cb_btou) }; var cb_decode = function (cccc) { var len = cccc.length, padlen = len % 4, n = (len > 0 ? b64tab[cccc.charAt(0)] << 18 : 0) | (len > 1 ? b64tab[cccc.charAt(1)] << 12 : 0) | (len > 2 ? b64tab[cccc.charAt(2)] << 6 : 0) | (len > 3 ? b64tab[cccc.charAt(3)] : 0), chars = [fromCharCode(n >>> 16), fromCharCode(n >>> 8 & 255), fromCharCode(n & 255)]; chars.length -= [0, 0, 2, 1][padlen]; return chars.join("") }; var atob = global.atob ? function (a) { return global.atob(a) } : function (a) { return a.replace(/[\s\S]{1,4}/g, cb_decode) }; var _decode = buffer ? buffer.from && buffer.from !== Uint8Array.from ? function (a) { return (a.constructor === buffer.constructor ? a : buffer.from(a, "base64")).toString() } : function (a) { return (a.constructor === buffer.constructor ? a : new buffer(a, "base64")).toString() } : function (a) { return btou(atob(a)) }; var decode = function (a) { return _decode(String(a).replace(/[-_]/g, function (m0) { return m0 == "-" ? "+" : "/" }).replace(/[^A-Za-z0-9\+\/]/g, "")) }; var noConflict = function () { var Base64 = global.Base64; global.Base64 = _Base64; return Base64 }; global.Base64 = { VERSION: version, atob: atob, btoa: btoa, fromBase64: decode, toBase64: encode, utob: utob, encode: encode, encodeURI: encodeURI, btou: btou, decode: decode, noConflict: noConflict }; if (typeof Object.defineProperty === "function") { var noEnum = function (v) { return { value: v, enumerable: false, writable: true, configurable: true } }; global.Base64.extendString = function () { Object.defineProperty(String.prototype, "fromBase64", noEnum(function () { return decode(this) })); Object.defineProperty(String.prototype, "toBase64", noEnum(function (urisafe) { return encode(this, urisafe) })); Object.defineProperty(String.prototype, "toBase64URI", noEnum(function () { return encode(this, true) })) } } if (global["Meteor"]) { Base64 = global.Base64 } if (typeof module !== "undefined" && module.exports) { module.exports.Base64 = global.Base64 } else if (typeof define === "function" && define.amd) { define([], function () { return global.Base64 }) } })(typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : this);;

//ajax请求，公共函数
var AjaxRequestFun = {
    ajaxBegin: function () {
        layerLoad.Open();
        //alert("ajaxBegin");
    },
    ajaxComplete: function () {
        layerLoad.Close();
        //todo 公共
        //alert("Complete");
    },
    ajaxSuccess: function () {
        //todo 公共
        //alert("ajaxSuccess");
    },
    ajaxFailure: function () {
        //todo 公共
        //alert("请求失败");
        layerLoad.Message("加载失败...");
    },
    ajaxClassComplete: function () {
        layerLoad.Close();
        //todo 公共
        //alert("Complete");
        //这是公用方法 此处判断只针对聚类回调
        //var classIndex = $("#LeftClassIndex").val();
        //if (classIndex != "" && classIndex != undefined) {
        //    //先判断当前点击的index是否在可视化范围内
        //    var curClickClass = $("div[cluster_index='" + classIndex + "']");
        //    var a = curClickClass.offset().top;
        //    if (a >= $(window).scrollTop() && a < ($(window).scrollTop() + $(window).height())) {

        //    } else {
        //        var scrollHight = a - ($(window).height() / 2);
        //        $(document).scrollTop(scrollHight);
        //    }
        //    $("#LeftClassIndex").val("");
        //}
        $('html,body').scrollTop(0);//点击完聚类返回顶部
    },

    exeCallBack: function (callback) {
        if ($.isFunction(callback)) {
            callback.apply();
        }
    },

    SetFormAjaxSuccess: function (targetForm, callback) {
        targetForm.attr("data-ajax-success", callback);
    },



    //栏目检索成功后要执行方法，即：初始化子库检索事件绑定，分组统计事件绑定，列表事件绑定
    menuAjaxSuccess: function (data, status, xhr) {
        $("input[name='RequestFrom']").val("");
        var menu = $("#main_form input[name='Menu']").val();
        var checkResult = $("input[name='QuerySearchCondition']").val().split('+');//记录当前查询条件和次数       
        if (status == "nocontent" && checkResult.length > 2) {//检索没有结果
            var qq = $.trim($('#txtSearch').val());
            if (checkResult[3] == "0") { //第一次检索 要弹框
                var searchType = checkResult[0];
                if (searchType == "casecause" || searchType == "casecourt" || searchType == "JournalId" || searchType == "AuthorUnit" || searchType == "Code" || searchType == "caselawfirm" || searchType == "DisputedIssues" || searchType == "TrialAfter" || searchType == "PlaintiffClaims" || searchType == "DefenseViewpoint" || searchType == "ControversialFocus" || searchType == "Ascertain" || searchType == "Identified" || searchType == "RefereeBasis" || searchType == "RefereeResult") { //默认就是精确匹配 切换为模糊匹配                                   
                    $("input[name='Keywords']").val(qq);
                    $("input[name='MatchType']").val("Fuzzy");
                    $("input[name='QuerySearchCondition']").val(searchType + "+Fuzzy");
                    $("#main_form").submit();
                } else {
                    var tips = "<div class=\"layer-wrap\"><div class=\"title\">检索提示</div><div class=\"form\"><ul><li class=\"row\"><p>抱歉，在指定检索条件下，本库无结果。是否为您在本库内智能切换检索条件？</p></li></ul><div class=\"btn-s\"><a href=\"javascript:void(0);\"  class=\"search-btn\">确定</a><a href=\"javascript:void(0);\"  class=\"cancel\">取消</a></div></div></div>";
                    layer.open({
                        content: tips, //内容
                        area: ['380px', '250px'],
                        title: false, //不要标题栏
                        fix: false, //不随滚动条滚动
                        move: false, //不可移动
                        btn: false, //按钮不展示           
                        shade: [0.01, '#000'],
                        success: function () {
                            var urlRelatedSearch = "/" + menu + "/related/" + $("#main_form input[name='Library']").val() + "/?currentMenu=" + menu + "&keywords=" + encodeURIComponent($("#main_form input[name='Keywords']").val()) + "&searchKeywordType=" + $("#main_form input[name='SearchKeywordType']").val() + "&matchType=" + $("#main_form input[name='MatchType']").val() + "&rangeType=" + $("#main_form input[name='RangeType']").val();
                            $("#hidRelatedSearch").val(urlRelatedSearch);//记录下第一次相关检索
                            //确定按钮点击
                            $(".btn-s .search-btn").click(function () {
                                $("input[name='QueryOnClick']").val('True');
                                layer.closeAll();
                                var curMatch = checkResult[1];
                                var searchType = checkResult[0];
                                var rangeType = checkResult[2];
                                if (curMatch == "Exact") { //精确检索要区分标题还是全文
                                    if (searchType == "Title") { //如果当前检索是标题+精确 就切换为标题+模糊                                    
                                        $("input[name='MatchType']").val("Fuzzy");
                                        $("input[name='SearchKeywordType']").val("Title");
                                        $("input[name='Keywords']").val(qq);
                                        var searchNum = parseInt(checkResult[3].toString()) + 1;
                                        $("input[name='QuerySearchCondition']").val("Title+Fuzzy+Piece+" + searchNum);
                                        $("#main_form").submit();
                                        $(".results-btn").show();
                                        $(this).html("新检索");
                                    } else if (searchType == "Fulltext") {
                                        if (rangeType == "Sen" || rangeType == "Seg" || rangeType == "Strip") { //全文+精确+同句 =》全文+精确+同篇                                       
                                            $("input[name='SearchKeywordType']").val("Fulltext");
                                            $("input[name='MatchType']").val("Exact");
                                            $("input[name='Keywords']").val(qq);
                                            $("input[name='RangeType']").val("Piece");
                                            var searchNum3 = parseInt(checkResult[3].toString()) + 1;
                                            $("input[name='QuerySearchCondition']").val("Fulltext+Exact+Piece+" + searchNum3);
                                            $("#main_form").submit();
                                        } else {//当前检索是全文 精确 同篇 切换为全文 模糊 同篇                                        
                                            $("input[name='SearchKeywordType']").val("Fulltext");
                                            $("input[name='MatchType']").val("Fuzzy");
                                            $("input[name='Keywords']").val(qq);
                                            $("input[name='QuerySearchCondition']").val("Fulltext+Fuzzy");
                                            $("#main_form").submit();
                                        }
                                    } else if (searchType == "DefaultSearch") {

                                        $("input[name='SearchKeywordType']").val("DefaultSearch");
                                        $("input[name='MatchType']").val("Fuzzy");
                                        $("input[name='Keywords']").val(qq);
                                        var searchNum4 = parseInt(checkResult[3].toString()) + 1;
                                        $("input[name='QuerySearchCondition']").val("DefaultSearch+Fuzzy+" + searchNum4);
                                        $("#main_form").submit();
                                    }
                                } else {
                                    if (searchType == "Title") {//如果当前是标题+模糊 切换为全文 精确 同篇                                   
                                        $("input[name='SearchKeywordType']").val("Fulltext");
                                        $("input[name='MatchType']").val("Exact");
                                        $("input[name='Keywords']").val(qq);
                                        var searchNum2 = parseInt(checkResult[3].toString()) + 1;
                                        $("input[name='QuerySearchCondition']").val("Fulltext+Exact+" + searchNum2);
                                        $("#main_form").submit();
                                    } else if (searchType1 == "DefaultSearch") {
                                        $("input[name='SearchKeywordType']").val("Fulltext");
                                        $("input[name='MatchType']").val("Exact");
                                        $("input[name='Keywords']").val(qq);
                                        var searchNum6 = parseInt(checkResult[3].toString()) + 1;
                                        $("input[name='QuerySearchCondition']").val("DefaultSearch+Exact+" + searchNum6);
                                        $("#main_form").submit();
                                    } else {//点击新检索，MatchType 和RangeType都为null的情况

                                        $("input[name='SearchKeywordType']").val("Fulltext");
                                        $("input[name='MatchType']").val("Exact");
                                        $("input[name='Keywords']").val(qq);
                                        $("input[name='QuerySearchCondition']").val("Fulltext+Exact+" + 0);
                                        $("#main_form").submit();

                                    }
                                }
                            });
                            //取消按钮点击
                            $(".btn-s .cancel").click(function () {
                                //没有结果先用旧条件进行相关检索
                                //var urlRelatedSearch = "/" + menu + "/related/" + $("#main_form input[name='Library']").val() + "/?currentMenu=" + menu + "&keywords=" + encodeURIComponent($("#main_form input[name='Keywords']").val()) + "&searchKeywordType=" + $("#main_form input[name='SearchKeywordType']").val() + "&matchType=" + $("#main_form input[name='MatchType']").val() + "&rangeType=" + $("#main_form input[name='RangeType']").val();
                                $.ajax({
                                    url: urlRelatedSearch,
                                    type: "Get",
                                    data: null,
                                    dataType: "html",
                                    success: function (result) {
                                        if (result.length > 0) {
                                            $("#navbar .relevant-retrieval").remove();
                                            $("#navbar").append(result);
                                        }
                                    }
                                });
                                var preKeyword = $("input[name='PreKeywords']").val();
                                if (preKeyword != "" && preKeyword != undefined) {
                                    $("input[name='Keywords']").val(preKeyword);
                                }                             
                                layer.closeAll();
                            });
                        }
                    });
                }
            } else {//不是第一次检索
                var curMatch1 = checkResult[1];
                var searchType1 = checkResult[0];
                if (curMatch1 == "Fuzzy") {
                    if (searchType1 == "Title") { //当前检索是标题+模糊 切换为 全文 精确 同篇
                        $("input[name='SearchKeywordType']").val("Fulltext");
                        $("input[name='MatchType']").val("Exact");
                        $("input[name='Keywords']").val(qq);
                        var searchNum1 = parseInt(checkResult[3].toString()) + 1;
                        $("input[name='QuerySearchCondition']").val("Fulltext+Exact+Piece+" + searchNum1);
                        $("#main_form").submit();
                    } else if (searchType1 == "DefaultSearch") {
                        $("input[name='SearchKeywordType']").val("Fulltext");
                        $("input[name='MatchType']").val("Exact");
                        $("input[name='Keywords']").val(qq);
                        var defaultNum = parseInt(checkResult[2].toString()) + 1;
                        $("input[name='QuerySearchCondition']").val("Fulltext+Exact+" + defaultNum);
                        $("#main_form").submit();
                    }
                } else {
                    if (searchType1 == "Fulltext") { //当前检索是全文 精确 同篇 切换为全文 模糊 同篇 直接返回 并修改隐藏域值 保证下次不再判断                     
                        $("input[name='SearchKeywordType']").val("Fulltext");
                        $("input[name='MatchType']").val("Fuzzy");
                        $("input[name='Keywords']").val(qq);
                        $("input[name='QuerySearchCondition']").val("Fulltext+Fuzzy");
                        $("#main_form").submit();
                    }
                }
            }

        }

        if (status != "nocontent" || $("input[name='QuerySearchCondition']").val().split('+').length < 3) {//检索有结果 并且 条件切换是最后一次

            if ($("input[name='Menu']").val() != "case") {
                $("#subLib_form").submit();
            }           

            if ($("input[name='Library']").val() == "pfnl" && $("input[name='Menu']").val() == "case") {

                var pathname = window.location.pathname;
                if (!pathname.endsWith("rightkeyword")) {
                    ClassResultSearch.CaseClassResultInit();
                }

               
            }


            SubLibrarySearch.init();
            ClassResultSearch.init();
            RecordSearch.init();
            InitFullBottomAdvertisement();


            if ($("input[name='SearchKeywordType']").val() != "Author") {

                //检索成功后判断第一项然后打开第一项链接  要是提示检索就不跳转了
                var leftUrl = "/" + menu + "/search/GetLeftFilterForSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    leftUrl = "/" + menu + "/FindArticle/GetLeftFilterForSearch";
                }
                var dropLibrary = $("input[name='Library']").val();
                var areaCode = $("#main_form input[name='SearchKeywordType']").val();
                if (dropLibrary != "chl" && dropLibrary != "lar" && dropLibrary != "pfnl" && (areaCode == "DefaultSearch")) {
                    areaCode = "Title";
                }

                if ($("input[name='QueryOnClick']").val() != "True") {

                    //请求配置文件 异步加载检索框左侧筛选项 //切换过条件的不更新
                    $.ajax({
                        url: leftUrl,
                        type: "Get",
                        data: { dropLibrary: dropLibrary, areacode: areaCode },
                        dataType: "html",
                        success: function (result) {
                            if (result != "" && result.length > 0) {
                                var jsonObj = eval('(' + result + ')');
                                var dropHtml = "";
                                var isHaveCurCode = false;
                                $.each(jsonObj, function (i, n) {//先循环找到当前检索的项
                                    if (n.DropConfig.AreaCode.toLowerCase() == areaCode.toLowerCase()) {
                                        isHaveCurCode = true;
                                        dropHtml = "<div class=\"areajSelect\"><div>" + n.DropConfig.ShowName + "</div><i class=\"c-icon arrow-line-gray-down\"></i><ul class=\"jSelectList\" style=\"display: none;\">";
                                    }
                                })

                                if (!isHaveCurCode) {
                                    dropHtml += "<div class=\"areajSelect\"><div>标 题</div><i class=\"c-icon arrow-line-gray-down\"></i><ul class=\"jSelectList\" style=\"display: none;\">";
                                    areaCode = "Title";
                                }


                                $.each(jsonObj, function (i, m) {//循环拼接所有项

                                    if (m.DropConfig.AreaCode.toLowerCase() == areaCode.toLowerCase()) {
                                        dropHtml += "<li class=\"current\"><a href=\"javascript:void(0);\" areacode=\"" + m.DropConfig.AreaCode + "\">" + m.DropConfig.ShowName + "</a></li>";
                                    }
                                    else if (m.DropConfig.AreaCode == "DisputedIssues") {
                                        dropHtml += "<li><a href=\"javascript:void(0);\" areacode=\"" + m.DropConfig.AreaCode + "\">" +
                                            m.DropConfig.ShowName + "</a></li><li class=\"line\"></li>";
                                    }
                                    else {
                                        dropHtml += "<li><a href=\"javascript:void(0);\" areacode=\"" + m.DropConfig.AreaCode + "\">" +
                                            m.DropConfig.ShowName + "</a></li>";
                                    }
                                })
                                dropHtml += "</ul></div>";

                                $(".areajSelect").replaceWith(dropHtml);
                                MenuSearch.init();
                                $('.areajSelect').subSearchJselect();
                                //var rangRdo = $("input[name='Search_Range']");
                                //var searchMode = $("input[name='Search_Mode']");
                                //if (areaCode == "Title") {
                                //    for (var i = 0; i < rangRdo.length; i++) {
                                //        rangRdo[i].checked = false;
                                //        rangRdo[i].disabled = true;
                                //    }
                                //    for (var j = 0; j < searchMode.length; j++) {
                                //        searchMode[j].checked = true;
                                //        searchMode[j].disabled = false;
                                //    }
                                //    $("#otherHtml").remove();
                                //    $(".mselect").show();
                                //    ResetSearchMode();
                                //} else if (areaCode == "DefaultSearch") {
                                //    for (var i = 0; i < rangRdo.length; i++) {
                                //        rangRdo[i].checked = false;
                                //        rangRdo[i].disabled = true;
                                //    }
                                //    for (var j = 0; j < searchMode.length; j++) {
                                //        searchMode[j].checked = false;
                                //        searchMode[j].disabled = true;
                                //    }
                                //    $("#otherHtml").remove();
                                //    $(".mselect").show();
                                //} else if (areaCode == "Fulltext") {
                                //    for (var i = 0; i < rangRdo.length; i++) {
                                //        rangRdo[i].checked = true;
                                //        rangRdo[i].disabled = false;
                                //    }
                                //    for (var j = 0; j < searchMode.length; j++) {
                                //        searchMode[j].checked = true;
                                //        searchMode[j].disabled = false;
                                //    }
                                //    $("#otherHtml").remove();
                                //    $(".mselect").show();
                                //    ResetSearchMode();
                                //} else {
                                //    $("#otherHtml").remove();
                                //    $(".mselect").hide();
                                //    var showHtml = $(".other").html();
                                //    if (showHtml != undefined) {
                                //        showHtml = "<div class=\"mselect search-form\" id=\"otherHtml\"><div class=\"other\">" + showHtml + "</div></div>";
                                //        $(".search-wrap").after(showHtml);
                                //    }
                                //    $("input[name=MatchType]").val("Exact");
                                //}
                            }
                        }
                    });

                }
                //请求相关栏目检索
                var lastRelatedSearch = "";

                if ($("input[name='QueryOnClick']").val() == "True") {//是否点击过检索提示的确定按钮 点击过就按照记录的相关链接检索，没有点击过就按照当前的条件检索
                    lastRelatedSearch = $("#hidRelatedSearch").val();
                } else {
                    var menu = $("#main_form input[name='Menu']").val();
                    lastRelatedSearch = "/" + menu + "/related/" + $("#main_form input[name='Library']").val() + "/?currentMenu=" + menu + "&keywords=" + encodeURIComponent($("#main_form input[name='Keywords']").val()) + "&searchKeywordType=" + $("#main_form input[name='SearchKeywordType']").val() + "&matchType=" + $("#main_form input[name='MatchType']").val() + "&rangeType=" + $("#main_form input[name='RangeType']").val();
                }  

                if ($("input[name='Library']").val() != "pfnl") {
                    $.ajax({
                        url: lastRelatedSearch,
                        type: "Get",
                        data: null,
                        dataType: "html",
                        success: function (result) {

                            if (result.length > 0) {
                                $("#navbar .relevant-retrieval").remove();
                                $("#navbar").append(result);
                            }

                        }
                    });  
                }

            }
        }

    },


    //左侧分组统计执行成功后要执行的方法，初始化分组统计事件绑定
    leftAjaxSuccess: function () {
        ClassResultSearch.init();
        if ($("input[name='Library']").val() == "pfnl" && $("input[name='Menu']").val() == "case") {

            var pathname = window.location.pathname;
            if (!pathname.endsWith("rightkeyword")) {
                ClassResultSearch.CaseClassResultInit();
            }            
        }
    },

    //右侧列表执行成功后要执行的方法，初始化列表事件绑定
    rightAjaxSuccess: function () {
        RecordSearch.init();
        if ($(".tool-bar .tool .btn-readed").html() != undefined) {
            if ($("#CountFindUnRead").length >= 0) {
                $.ajax({
                    url: $("#CountFindUnRead").val(),
                    type: "POST",
                    data: null,
                    success: function (results) {
                        if (parseInt(results) > 0) {
                            $("#iCount").html(results).show();
                        } else if (parseInt(results) == 0) {
                            $("#iCount").html(results).hide();
                        }
                    }
                });
            }
        }      


        //请求相关栏目检索
        var lastRelatedSearch = "";
        var menu = $("#main_form input[name='Menu']").val();
        if ($("input[name='QueryOnClick']").val() == "True") {//是否点击过检索提示的确定按钮 点击过就按照记录的相关链接检索，没有点击过就按照当前的条件检索
            lastRelatedSearch = $("#hidRelatedSearch").val();
        } else {          
            lastRelatedSearch = "/" + menu + "/related/" + $("#main_form input[name='Library']").val() + "/?currentMenu=" + menu + "&keywords=" + encodeURIComponent($("#main_form input[name='Keywords']").val()) + "&searchKeywordType=" + $("#main_form input[name='SearchKeywordType']").val() + "&matchType=" + $("#main_form input[name='MatchType']").val() + "&rangeType=" + $("#main_form input[name='RangeType']").val();
        }

        if ($("input[name='Library']").val() != "pfnl" && $("input[name='IsAdv']").val() != "True" && menu !="video") {
            $.ajax({
                url: lastRelatedSearch,
                type: "Get",
                data: null,
                dataType: "html",
                success: function (result) {

                    if (result.length > 0) {
                        $("#navbar .relevant-retrieval").remove();
                        $("#navbar").append(result);
                    }

                }
            });
        }

        ////请求相关栏目检索
        //var menu = $("#main_form input[name='Menu']").val();
        //var urlRelatedSearch = "/" + menu + "/related/" + $("#main_form input[name='Library']").val() + "/?currentMenu=" + menu + "&keywords=" + encodeURIComponent($("#main_form input[name='Keywords']").val()) + "&searchKeywordType=" + $("#main_form input[name='SearchKeywordType']").val() + "&matchType=" + $("#main_form input[name='MatchType']").val() + "&rangeType=" + $("#main_form input[name='RangeType']").val();
        //$.ajax({
        //    url: urlRelatedSearch,
        //    type: "Get",
        //    data: null,
        //    dataType: "html",
        //    success: function (result) {

        //        if (result.length > 0) {
        //            $("#navbar .relevant-retrieval").remove();
        //            $("#navbar").append(result);
        //        }

        //    }
        //});
        $('html,body').scrollTop(0);//点击完聚类返回顶部
    },


    libAjaxSuccess: function () {
        var isAdvSearch = $("input[name='IsAdv']").val();
        if (isAdvSearch != "True") {
            SubLibrarySearch.init();
        }

    },


    rightKeywordAjaxSuccess: function () {
        RightKeywordSearch.init();
        ClassResultSearch.init();
        RecordSearch.init();
    },


    LawfirmOrLawyerAjaxSuccess: function () {
        //LawfirmOrLawyerSearch.init();
        ClassResultSearch.init();
        RecordSearch.init();
    },


    CourtOrJudgerAjaxSuccess: function () {
        CourtOrJudgerSearch.init();
        ClassResultSearch.init();
        RecordSearch.init();
    }
    ,
    JournalAjaxSuccess: function () {
        IniLeftClass();
    },
    VideoAjaxSuccess: function () {
        RecordSearch.init();
        VideoSearch.init();
    },
    ReportAjaxSuccess: function () {
        CaseReportFun.init();
    },
    AiNoteAjaxSuccess: function () {
        RecordSearch.init();
        AiNoteFun.init();
    },

};
//分组统计 2016-5-6 by likai

var ClassResultSearch =
{
    //初始化各个元素的事件绑定

    init: function () {

        ClassResultSearch.dispose();

        //分组统计项点击
        $("#leftContent").find("a").each(function () {
            $(this).click(function () {
                var curCli = $(this);
                //跳转营商环境首页
                if ($(this).attr("cluster_code") == '119' | $(this).attr("cluster_code") == '营商环境') {
                    var form = document.createElement('form');
                    form.action = 'https://dobusiness.pkulaw.com/';
                    form.target = '_blank';
                    form.method = 'POST';
                    document.body.appendChild(form);
                    form.submit();
                    return;
                }
                var curGroupName = $("#recordgroup").find(".currentSelect").text();
                $("#LeftClassIndex").val($(this).parents(".block").attr("cluster_index"));
                var className = curCli.attr('class');
                //获取分组统计项值
                var classCodeKey = $("input[name='ClassCodeKey']").val();
                //同义词检索
                var isSynonym = $("#synonym").is(':checked');
                $("input[name='IsSynonymSearch']").val(isSynonym);

                if (className != "szyy" && className != "label-annotation recom") {

                    if (className == "c-icon c-return") {

                        var curSlect = curCli.parent().parent().find(".current").attr('class');
                        if (curSlect != undefined && curSlect != '') {
                            var curLevel = curSlect.split('-')[1];
                            //从第二级开始点击前一级，第一级则返回到根节点
                            if (curLevel > 1) {
                                var father = curLevel - 1;
                                var fatherlevel = ".level-" + father;
                                curCli.parent().parent().find(fatherlevel).find('a:first-child').click();

                                if (curCli.siblings().text() == curGroupName) {
                                    $("input[name='ShowType']").val("Group");
                                }

                            } else {
                                //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
                                var thisClickIndex = "";
                                thisClickIndex = $(this).parents(".block").attr("cluster_index") * 1;

                                //将分组值按，打节，
                                var classCodeKeyArray = classCodeKey.split(",");
                                classCodeKeyArray[thisClickIndex] = "";
                                classCodeKey = classCodeKeyArray.join(",");
                                //重新给分组统计项赋值
                                $("input[name='ClassCodeKey']").val(classCodeKey);

                                if ($("input[name='Library']").val() != "pfnl") {
                                    $("#left_form").submit();
                                } else {
                                    ClassResultSearch.CaseClassResultInit(classCodeKey);
                                }
                                $("#right_form").submit();
                                //curCli.parent().parent().find(".filter-title").find('a').click();
                            }

                        };
                        return false;
                    }
                    if (className == "label-annotation") {
                        var zhuId = $(this).attr("id");
                        if (zhuId == "zhuCaseGrade") {
                            var returnHtml = "<div class=\"layer-wrap\"><h4>参照级别</h4><ul class=\"fields\"><li class=\"row\"><strong>指导性案例：</strong>由最高人民法院、最高人民检察院确定并统一发布，是已经发生法律效力，认定事实清楚，适用法律正确，裁判说理充分，法律效果和社会效果良好，对审理类似案件具有普遍指导意义的案例。</li><li class=\"row\"><strong>公报案例：</strong>是指发布在《最高人民法院公报》和《最高人民检察院公报》这两种法定刊物上的案例。</li>" +
                                "<li class=\"row\"><strong>典型案例：</strong>主要是指最高人民法院和最高人民检察院以公文形式发布的具有典型意义的司法案例，也包含少量地方各级法院和检察院发布的典型案例。</li><li class=\"row\"><strong>参阅案例：</strong>经省法院审判委员会确认并以固定形式编号的案例，该类案例对全省法院处理同类案件具有指导、参考和借鉴作用。</li><li class=\"row\"><strong>经典案例：</strong>来源为权威出版物的案例。</li><li class=\"row\"><strong>应用案例：</strong>指援引指导性案例的案例。</li><li class=\"row\"><strong>法宝推荐：</strong>由北大法宝经过专业筛选推送的案例。</li><li class=\"row\"><strong>普通案例：</strong>除以上参照级别之外，各级法院审结发布的案例。</li></ul></div>";
                            layer.open({
                                content: returnHtml, //内容
                                area: '600px',
                                title: false, //不要标题栏
                                fix: false, //不随滚动条滚动
                                move: false, //不可移动
                                btn: false, //按钮不展示           
                                shade: [0.1, '#000']
                            });
                        }
                        if (zhuId == "zhuGac") {
                            var returnHtml = "<div class=\"layer-wrap\"><h4>指导性案例应用</h4><ul class=\"fields\"><li class=\"row\"><strong>应用案例：</strong>在裁判文书中检察人员、诉讼参与人或者法官援引指导性案例的案件。</li><li class=\"row\"><strong>应用主体：</strong>在裁判文书中首次提出援引指导性案例的人。</li><li class=\"row\"><strong>应用方式：</strong>按照法官在裁判案件时是否明确援引了指导性案例进行说理，分为明示援引、隐性援引、评析援引。</li>" +
                                "<li class=\"row\">（1）明示援引：是指法官作出裁判时明确援引了指导性案例进行说理。主要包括法官主动援引和被动援引两种情形，前者是指法官主动援引指导性案例进行说理；后者是指法官被动援引指导性案例进行说理，即检察人员建议或诉讼参与人请求参照指导性案例时，法官在裁判理由中对此做出了回应。</li><li class=\"row\">（2）隐性援引：是指在审判过程中，检察人员建议或诉讼参与人请求法官参照指导性案例进行裁判，法官对此在裁判理由部分未明确作出回应，但是其裁判结果与指导性案例的精神是一致的情况。</li><li  class=\"row\">（3）评析援引：是指裁判文书正文中并未提及指导性案例，但是该案例后所附的专家点评、评析、补评及典型意义等中提到指导性案例的情况。</li>" +
                                "<li class=\"row\"><strong>应用内容：</strong>在引用指导性案例时，对裁判要点、基本案情、裁判理由、裁判结果、裁判思路的引述情况。其中的未明确，是指在引用指导性案例时未明确说明其引用的具体内容，且根据裁判文书也不能判断其引用的内容。</li><li class=\"row\"><strong>应用表述：</strong>援引指导性案例时的文字表述，主要包括发布主体、发布日期、发布批次、指导性案例编号、指导性案例字号、指导性案例标题、指导性案例案号、裁判要点等要素。</li><li class=\"row\"><strong>应用结果：</strong>法官在审理案件时是否参照指导性案例。其中的未说明，是指一审法官在审理该案件时援引了某一指导性案例，但是二审法官在终审判决中并未对此进行回应和说明。其中未回应，是指法官对是否参照指导性案例未作出具体回应。</li></ul></div>";
                            layer.open({
                                content: returnHtml, //内容
                                area: '600px',
                                title: false, //不要标题栏
                                fix: false, //不随滚动条滚动
                                move: false, //不可移动
                                btn: false, //按钮不展示           
                                shade: [0.1, '#000']
                            });
                        }
                        if (zhuId == "zhuColumnName") {
                            var returnHtml = "<div class=\"layer-wrap\"><h4>案例特征</h4><ul class=\"fields\"><li class=\"row\"><strong>权威发布：</strong>为各级人民法院、人民检察院、各机构部门发布、公布、评选的典型案例、指导性案例。</li><li class=\"row\"><strong>国内首案：</strong>某一地区或全国关于某一类型案件的第一案。</li><li class=\"row\"><strong>热点案例：</strong>近期热点讨论、舆论媒体广泛关注报道的案件。</li><li class=\"row\"><strong>其他案例：</strong>除权威发布、国内首案及热点案例之外的其他各类案例的相关资讯报道。</li></ul></div>";
                            layer.open({
                                content: returnHtml, //内容
                                area: '600px',
                                title: false, //不要标题栏
                                fix: false, //不随滚动条滚动
                                move: false, //不可移动
                                btn: false, //按钮不展示           
                                shade: [0.1, '#000']
                            });
                        }
                        if (zhuId == "anyouZhu") {
                            var url = $(this).attr("url");
                            $.get(url, null, function (html) {
                                layer.open({
                                    content: html, //内容
                                    area: '600px',
                                    title: false, //不要标题栏
                                    fix: false, //不随滚动条滚动
                                    move: false, //不可移动
                                    btn: false, //按钮不展示           
                                    shade: [0.1, '#000'],
                                    shadeClose: true //点击遮罩关闭弹框
                                });
                            });
                        }

                        return false;
                    }
                    if (className == "fold") {
                        var iClass = curCli.children().attr("class");
                        if (iClass == "c-icon c-minus") {

                            var thisUl = $(this).parent().siblings().eq(0);
                            var thisUUl = $(this).parent().siblings().eq(1);
                            thisUl.slideUp();
                            thisUUl.slideUp();
                            $(this).children().removeClass("c-icon c-minus");
                            $(this).children().addClass("c-icon c-plus");
                            return false;
                        }
                        if (iClass == "c-icon c-plus") {

                            var isNo = curCli.attr("isno");
                            if (isNo == "true") {
                                var isUserLogin = $("#IsUserLogin").val();
                                //用户未登录
                                if (isUserLogin != "true") {
                                    $("#loginBuyBtn").click();
                                    return false;
                                } else { //判断权限类型
                                    var authorityType = $("#authorityType").val();
                                    if (authorityType != "ValidUser") {
                                        $("#loginAuthorityBtn").click();
                                        return false;
                                    } else {

                                        //判断是否第一次展开
                                        var searchname = $(this).attr("searchname");
                                        var curPortId = searchname + "port";
                                        var isHaveChild = $(".list-side-bar").find("[portid='" + curPortId + "']").children();
                                        var thisUll = $(this).parent().siblings().eq(0);
                                        var thisUUll = $(this).parent().siblings().eq(1);
                                        thisUll.slideDown();
                                        thisUUll.slideDown();
                                        $(this).children().removeClass("c-icon c-plus");
                                        $(this).children().addClass("c-icon c-minus");
                                        if (isHaveChild.length == 0) {

                                            $(this).attr("isno", "false");
                                            SingleClassResult(searchname, classCodeKey);
                                        }
                                        return false;
                                    }
                                }
                            } else {
                                var thisUll = $(this).parent().siblings().eq(0);
                                var thisUUll = $(this).parent().siblings().eq(1);
                                thisUll.slideDown();
                                thisUUll.slideDown();
                                $(this).children().removeClass("c-icon c-plus");
                                $(this).children().addClass("c-icon c-minus");
                                return false;
                            }

                        }

                    }
                    if (className != "partRules") {
                        var curClassName = curCli.parent().parent().siblings().eq(0).find('a').text();

                        var lib = $("input[name='Library']").val();

                        if (curClassName.toLowerCase() == curGroupName.toLowerCase() || lib == "specialtopic") {

                            $("input[name='ShowType']").val("Default");
                            var noGroupIndex = $("#recordgroup").find('a').last().attr("group_index");
                            $("input[name='GroupByIndex']").val(noGroupIndex);
                        }
                        if (curCli.text() == curGroupName.toLowerCase()) {
                            $("input[name='ShowType']").val("Group");
                        }
                        //获取分组统计项值
                        var classCodeKey = $("input[name='ClassCodeKey']").val();

                        //将分组值按，打节，
                        var classCodeKeyArray = classCodeKey.split(",");

                        //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
                        var thisClickIndex = "";

                        thisClickIndex = $(this).parents(".block").attr("cluster_index") * 1;

                        //当前点击项值
                        var thisClickCode = $(this).attr("cluster_code");

                        //如果点击值未变，则不进行请求
                        if (thisClickCode == classCodeKeyArray[thisClickIndex]) {
                            return;
                        }

                        classCodeKeyArray[thisClickIndex] = thisClickCode;

                        classCodeKey = classCodeKeyArray.join(",");

                        //重新给分组统计项赋值
                        $("input[name='ClassCodeKey']").val(classCodeKey);

                        //法宝联想
                        var referenceGid = $("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val();
                        $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(referenceGid);

                        //分页置为首页
                        $("input[name='Pager.PageIndex']").val(0);
                        var isAdv = $("input[name='IsAdv']").val();
                        var menu = $("input[name='Menu']").val();
                        $("input[name='Keywords']").val($("#main_form input[name='Keywords']").val());


                        if (lib == "pfnl" && menu == "case") {

                            //案例的权责关键词栏目比较特殊无法分辨 
                            var pathname = window.location.pathname;
                            if (pathname.endsWith("rightkeyword")) {
                                $("#left_form").submit();
                            } else {
                                ClassResultSearch.CaseClassResultInit(classCodeKey);
                            }
                        } else {

                            $("#left_form").submit();
                        }

                        //$("#left_form").submit();

                        $("#right_form").submit();


                        if (isAdv != "True" && menu != "case") {
                            $("#subLib_form").submit();
                        }
                    }

                }

            });
        });


        //分组统计项分页


        if ($("input[name='Library']").val() != "pfnl") {
            $("#leftContent").find(".filter-list").each(function (i, ul) {
                //声明分页的容器
                var pgcontainer = $(ul).next(".page");
                //注意分页只是将最后一级分页
                $(ul).find("li.inner").quickpaginate({ pager: pgcontainer, perpage: 13, showall: true });
            });
        }



        //往期数据
        $(".block #thepast").click(function () {
            $.ajax({
                type: "GET",
                url: $("#ZhuUrl").val(),
                data: { court: "past" },
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                },
                success: function (returnHtml) {
                    if (returnHtml != "") {
                        layer.open({
                            content: returnHtml, //内容
                            area: ['650px', '500px'],
                            title: false, //不要标题栏
                            fix: false, //不随滚动条滚动
                            move: false, //不可移动
                            btn: false, //按钮不展示           
                            shade: [0.1, '#000']

                        });
                    }

                }

            });
        });


        //案例的注
        $(".more-list .recom").click(function () {
            var curZhu = $(this).attr("court");
            $.ajax({
                type: "GET",
                url: $("#ZhuUrl").val(),
                data: { court: curZhu },
                beforeSend: function () {
                    AjaxRequestFun.ajaxBegin();
                },
                complete: function () {
                    AjaxRequestFun.ajaxComplete();
                },
                error: function () {
                    AjaxRequestFun.ajaxFailure();
                },
                success: function (returnHtml) {
                    if (returnHtml != "") {
                        layer.open({
                            content: returnHtml, //内容
                            area: '600px',
                            title: false, //不要标题栏
                            fix: false, //不随滚动条滚动
                            move: false, //不可移动
                            btn: false, //按钮不展示           
                            shade: [0.1, '#000']

                        });
                    }
                }
            });
        });


        //更多新兴法院
        $("#morecourt").click(function () {
            if ($(this).text() == '收起') {
                $(this).parent().next().css({
                    height: 96
                });
                $(this).text('更多');
            } else {
                $(this).parent().next().css({
                    height: 'auto'
                })
                $(this).text('收起');
            }
        });
        //广告跳转并记录访问日志 zyt
        $(".leftShowAd li a").each(function () {
            $(this).click(function () {
                var webUrl = $(this).attr("url");
                var webId = $(this).attr("num");

                var form = document.createElement('form');
                form.action = webUrl;
                form.target = '_blank';
                form.method = 'GET';
                document.body.appendChild(form);
                form.submit();
                var url = location.host;
                var apiUrl = "https://openapi.pkulaw.cn/api/log/AddLookLog";
                $.ajax({
                    url: apiUrl,
                    type: "GET",
                    data: { urlReferrer: url, visitLink: webUrl, visitId: webId },
                    dataType: "jsonp", //数据格式设置为jsonp
                    jsonp: "callback", //Jquery生成验证参数的名称
                    success: function () {
                    }
                });
            });
        });
        //加载法宝学堂推送视频
        $(
            function () {
                var num = 3;
                var menu_item = document.getElementsByName("Menu")[0].value;
                var advertisement = "https://manage.pkulaw.cn/AdPosition/GetAdByAdPositionIdNumber";
                var advStr = "";
                var picPath = "https://manage.pkulaw.cn";
                var advId = "";
                switch (menu_item.toLowerCase()) {
                    case "law":
                        advId = $("#lawAdvId").val();
                        break;
                    case "case":
                        advId = $("#caseAdvId").val();
                        break;
                    case "journal":
                        advId = $("#journalAdvId").val();
                        break;
                    case "lawfirm":
                        advId = $("#lawfirmAdvId").val();
                        break;
                    case "reference":
                        advId = $("#referenceAdvId").val();
                        break;
                    default:
                        advId = $("#IndexAdvId").val();
                        num = 2;
                        break;
                }
                if (advId == "") {
                    $("#hotVideo").remove();
                    return;
                }
                advUrl = advertisement + "?number=" + num + "&callback=?&Id=" + advId;
                $.ajax({
                    url: advUrl,
                    type: "Get",
                    dataType: 'jsonp',
                    success: function (adv) {
                        if (adv != null) {
                            var len = adv.length;
                            if (len > 0) {
                                for (var i = 0; i < len; i++) {
                                    var advSet = adv[i];
                                    var picSrc = advSet.PictureSrc;

                                    var picHref = advSet.PictureHref;
                                    var picAlt = advSet.PictureAlt;
                                    var errorPic = "/Content/ad-images/pic-1.jpg";
                                    var cha = '"';
                                    advStr += "<li>"
                                        + "<a href = \"" + picHref + "\"> "
                                        + "<img src = \"" + picPath + picSrc + "\" alt = \"\" title = \"\"> "
                                        + "<p> " + picAlt + "</p> "
                                        + "</a > "
                                        + "</li> ";
                                }
                                if (advStr != "") {
                                    window.document.getElementById("leftShowFbxtAd").innerHTML = advStr;
                                }

                            }
                        }
                    }

                });
            }
        );
    },

    //取消事件绑定
    dispose: function () {
        $("#leftContent").find("a").unbind();
        $("#leftContent").find(".filter-list").unbind();
        $(".more-list .recom").unbind();
    },

    CaseClassResultInit: function (classCodeKey) {
        var classNmaeTims = $("input[name='allClassNames']").val().split('#');
        $.each(classNmaeTims, function (i, n) {
            SingleClassResult(n, classCodeKey);
        })
    }
}

function SingleClassResult(className, classCodeKey) {
    var curPortId = className + "port";
    var targetId = $(".list-side-bar").find("[portid='" + curPortId + "']");
    //判断当前这一项是否是展开的 展开的就继续请求 关闭的就不请求了
    var isFold = targetId.parent().find(".fold").attr("isno");
    if (classCodeKey == undefined) {
        classCodeKey = "";
    }
    if (isFold == "false") {
        var urlChart = virtualPath + "/Tool/SingleClassResult";
        $(targetId).after("<div class=\"load-wrap\"><div class=\"mask\"></div><img src=\"/content/images/loading.gif\"></div>");
        var advDicArr = new Array();
        var idol = '"';
        var arrJson = "";
        var isAdv = $("input[name='IsAdv']").val();
        if (isAdv == "True") {
            $("div[advsearch]").each(function () {
                var prop = $(this).attr("property");
                var searchtype = $(this).attr("searchtype");
                switch (searchtype) {
                    case "date":
                    case "datebetween":
                    case "number":
                    case "numberbetween":
                        var newtval = "";
                        if (prop == "ExpirationDate2") {
                            newtval = $(this).find("dd.currentSelect").attr("filter_value");
                        } else {
                            newtval = "{ 'Start': '" + $(this).find("input[start]").val() + "', 'End': '" + $(this).find("input[end]").val() + "' }";
                        }
                        if (newtval == undefined) {
                            newtval = "";
                        }
                        var test = idol + prop + "\":" + "\"" + newtval + idol;
                        advDicArr.push(test);
                        return true;
                    case "text":
                        var newtval = $.trim($(this).find("input[prop]").val());
                        if (newtval != "") {
                            var checkInput = CheckIsChinese(newtval);
                            if (prop == "TitleEn") {
                                if (checkInput) {//查的包含中文
                                    prop = 'TitleCh';
                                }
                            }
                            if (prop == "CheckFullTextEn") {
                                if (checkInput) { //查的包含中文
                                    prop = 'CheckFullText';
                                }
                            }
                        }
                        if (newtval == undefined) {
                            newtval = "";
                        }
                        var test = idol + prop + "\":" + "\"" + newtval + idol;
                        advDicArr.push(test);
                        return true;
                    case "select":
                        var dialogValues = "";
                        $(this).find("span[filter_value]").each(function () {
                            dialogValues += this.getAttribute("filter_value") + ",";
                        });
                        if (dialogValues != "") {//加上逻辑关系
                            dialogValues += "#" + $(this).find("input[name='hidsearchLogic']").val();
                        }
                        if (newtval == undefined) {
                            newtval = "";
                        }
                        var test = idol + prop + "\":" + "\"" + dialogValues + idol;
                        advDicArr.push(test);
                        return true;
                    case "dropdown":
                    case "radio":
                        var newdval = $(this).find("span[filter_value]").attr("filter_value");
                        if (newdval == undefined || newdval == "") {
                            newdval = $(this).find("dd.currentSelect").attr("filter_value");
                        }
                        if (newtval == undefined) {
                            newtval = "";
                        }
                        var test = idol + prop + "\":" + "\"" + newtval + idol;
                        advDicArr.push(test);
                        return true;
                }

            })

            arrJson = '{' + advDicArr.toString() + '}';//JSON.stringify(advDicArr);


        }
        $.ajax({
            url: urlChart,
            type: "POST",
            data: { library: $("input[name='Library']").val(), className: className, classCodeKeys: classCodeKey, QueryBase64Request: $("input[name='QueryBase64Request']").val(), keyword: $("input[name='Keywords']").val(), advDic: arrJson },
            success: function (data) {
                var strHtml = "";
                data = data.replace(/[★☆▲]/g, "");
                var LeftanyouZhu = $("#Isanyou").val();
                var result = JSON.parse(data);
                if (result != null) {
                    var curClassCode = "";
                    if (classCodeKey != undefined && classCodeKey != "") {
                        var classCodeTim = classCodeKey.split(',');
                        var cluster_index = targetId.parent().attr("cluster_index");//获取当前聚类的classcodekey顺序
                        curClassCode = classCodeTim[cluster_index];
                    }
                    var lengthGroup = new Array();
                    //先循环获取长度分组
                    $.each(result, function (i, m) {
                        var keyLen = m.key.length;
                        var a = lengthGroup.indexOf(keyLen);
                        if (a < 0) {
                            lengthGroup.push(keyLen);
                        }
                    })
                    $.each(result, function (i, n) {
                        var classActive = curClassCode == n.key ? "current" : "";
                        var paddingLength = lengthGroup.indexOf(n.key.length) + 1;
                        var classPadding = "level-" + paddingLength;
                        var maxGroupItemLen = Math.max(lengthGroup);
                        var classIcon = "arrow-right";
                        var flag = "";
                        var activeKeyLen = curClassCode.length;
                        if (n.key.length >= maxGroupItemLen && n.key.length >= activeKeyLen) {
                            flag = "inner";
                        }
                        if (n.key.length < activeKeyLen) {
                            classIcon = "arrow-down";
                        }
                        else if (n.key.length == activeKeyLen) {
                            classIcon = lengthGroup.indexOf(activeKeyLen) > 0 ? "arrow-down" : "arrow-right";
                        }

                        if (className == "CaseGrade" && n.key == "01") {//参照级别添加标签
                            strHtml += "<li class=\"" + classActive + " " + flag + " " + classPadding + "\"><a href=\"javascript:void(0);\" cluster_code='" + n.key + "'><i class=\"c-icon " + classIcon + "\"></i>" + n.value + "</a><a href=\"https://www.pkulaw.com/case/guidcase\" target=\"_blank\" class=\"szyy\">实证应用</a></li>";
                        } else { 
                            var leftresult = IsXmlleftKey(n.key, LeftanyouZhu);
                            if (leftresult == "True") {
                                strHtml += "<li class=\"" + classActive + " " + flag + " " + classPadding + "\"><a href=\"javascript:void(0);\" cluster_code='" + n.key + "'><i class=\"c-icon " + classIcon + "\"></i>" + n.value + "</a><a href='javascript: void (0); 'url='/nav/anyouzhu?property=" + n.key + "&subLib=" + n.value + "' class='label-annotation' id='anyouZhu'>注</a></li>";
                            } else {
                                strHtml += "<li class=\"" + classActive + " " + flag + " " + classPadding + "\"><a href=\"javascript:void(0);\" cluster_code='" + n.key + "'><i class=\"c-icon " + classIcon + "\"></i>" + n.value + "</a></li>";
                            }

                        }


                    });
                }
                if (strHtml != "") {
                    var showText = targetId.parent().find(".classtitle");
                    if (showText != "作者" && showText != "关键词" && showText != "期刊名称" && showText != "合作机构" && showText != "合作刊物") {
                        //确定返回按钮是否展示
                        var firstKey = result[0].key;
                        var lastKey = result[result.length - 1].key;

                        if (firstKey != undefined && lastKey != undefined && firstKey != "" && lastKey != "") {
                            if (firstKey.length != lastKey.length) {
                                targetId.parent().find(".c-return").show();
                            } else {
                                targetId.parent().find(".c-return").hide();
                            }
                        }
                    }
                    targetId.parent().find(".load-wrap").remove();
                    targetId.html(strHtml);
                    ClassResultSearch.dispose();
                    ClassResultSearch.init();
                    targetId.parent().find(".page").html("");
                    //分组统计项分页
                    $("#leftContent").find(targetId).each(function (i, ul) {
                        //声明分页的容器
                        var pgcontainer = $(ul).next(".page");
                        //注意分页只是将最后一级分页
                        $(ul).find("li.inner").quickpaginate({ pager: pgcontainer, perpage: 13, showall: true });
                    });
                }
            }
        })
    }
}
//接收键，判断是否展示注
function IsXmlleftKey(key, LeftZhu) {
    var patrn = "," + key + ",";
    if (LeftZhu != undefined && LeftZhu.indexOf(patrn) >= 0) {
        return "True";
    }    
}

;
//内容检索 2016-5-6 by likai
//获取Url 里面指定参数的值
function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return decodeURI(r[2]); return null;
}

var RecordSearch = {

    init: function () {

        RecordSearch.dispose();

        var IsAdvSearch = $("#IsAdvSearch").val();
        if (IsAdvSearch != null && IsAdvSearch != "") {
            $("#recordsort").show();
        }

        $('.areajSelect').subSearchJselect();
        $('.subjSelect').subSearchJselect();

        //筛选项和聚类显示结果中检索
        var isShowResultSearch = $("#isShowResultSearch").val();
        if (isShowResultSearch != null && isShowResultSearch != "") {
            $('.results-btn').show();
            $("#btnSearch").html("新检索");

        }


        //批量下载
        $('.list-filtrater .oparetion .down-all').recordDown();
        //列表内容工具点击
        $('.tools-box').dropDowm();
        //全选勾选框
        $('#choose-all').checkBoxForAll();

        $('#checkReportItems').checkBoxForAll();
        //批量打印
        $('.print-all').fulltextPrint();

        //批量下载
        $('#batchDownload').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框
                $("#loginBtn").click();
                return false;
            };

            var selectedCount = $("input[name='recordList']:checkbox:checked").length;
            var downloadType = $("input[name='batchDownload']:radio:checked").val();

            if (selectedCount > 10 && (downloadType == "fullWord" || downloadType == "fullPdf" || downloadType == "fullHyper")) {
                return false;
            }

            var condition = "";
            var showType = $("input[name='ShowType']").val();

            $('.condition a').each(function () {
                var text = $(this).context.innerText + "；";
                condition = condition + text;
            });

            var lib = $("input[name='Library']").val();
            var gids = new Array();
            var gidJson = new Array();
            var isAISearch = $("input[name='IsAiSearch']").val();

            $("input[name='recordList']:checkbox:checked").each(function () {
                var groupName;
                if (isAISearch == "True") {
                    var grouptitle = $(".grouping-title");
                    if (grouptitle.length > 0) {
                        groupName = $(this).parents("ul").prev(".grouping-title").find("h4").text();
                    }

                } else {

                    if (lib.indexOf("en_") != -1) {
                        groupName = $(this).parent().parent().parent().parent().prev().children()[0].text();
                    } else {
                        groupName = $(this).parents("ul").prev(".grouping-title").find("h4").text();
                    }
                }
                groupName = groupName == null ? "" : groupName.substr(0, groupName.indexOf("（"));

                var idx = $(this).next().children().children()[0].innerText;
                if (idx != undefined && idx != "") {
                    idx = idx.replace(".", "");
                }

                if (showType == "Group" && groupName != "") {
                    idx = groupName + "_" + idx;
                }
                var gid = $(this).val();
                var obj = { "idx": idx, "gid": gid };
                gidJson.push(obj);
                gids.push(gid);
                idx++;
            });

            if (gids.length == 0) {
                alert("请勾选要下载的项");
                return false;
            }
            gids = gids.join(",");
            gidJson = JSON.stringify(gidJson);

            var libs = new Array();
            if (lib == "gdd") {
                $("input[name='recordList']:checkbox:checked").each(function () {
                    libs.push($(this).attr("lib"));
                });
            } else {
                libs.push(lib);
            }
            var orderIndex = $("input[name='OrderByIndex']").val();
            var fieldsChecked = new Array();
            $("input[name='catalog']:checkbox:checked").each(function () {

                fieldsChecked.push($(this).val());
            });
            var curMenu = $("input[name='curMenu']").val();
            var keepfields = $("input[name='keepfields']").is(':checked');
            if (curMenu == "english") {
                keepfields = $("input[name='fields']").is(':checked');
            }

            var keepFblxInFulltext = $("input[name='keepfblx']").is(':checked');
            var keeprelated = $("input[name='keeprelated']").is(':checked');

            var viewType = $("input[name='viewType']").val();
            var currentUrl = window.location.href;

            $("input[name='batchDownload']:radio:checked").each(function () {
                if ($(this).val() != null && $(this).val() != undefined) {

                    var checkLimitUrl = "";
                    var data = {};
                    var form;
                    var catalogType = $(this).val();
                    var url = "";
                    switch (catalogType) {
                        case 'catalogTxt':
                        case 'catalogWord':
                        case 'catalogHtml':
                        case 'catalogExcel':
                            url = "/full/DownloadCatalog";
                            checkLimitUrl = "/Tool/CheckDownloadLimit";
                            data = { "downloadType": "DownloadCatalog", "library": lib, "gids": gidJson, "curLib": libs };
                            form = $("<form></form>");
                            form.attr('action', url);
                            form.attr('method', 'post');
                            form.attr('target', '_blank');

                            form.append("<input name='typeName' value='" + catalogType + "'/>");
                            form.append("<input name='condition' value='" + condition + "'/>");
                            form.append("<input name='library' value='" + lib + "'/>");
                            form.append("<input name='gids' value='" + gidJson + "'/>");
                            form.append("<input name='curLib' value='" + libs + "'>");
                            form.append("<input name='fields' value='" + fieldsChecked + "'>");
                            break;
                        case 'fullTxt':
                        case 'fullWord':
                        case 'fullHyper':
                        case 'fullPure':
                        case 'fullPdf':
                        case 'english':
                        case 'chinese':
                        case 'block':
                        case 'list':
                        case 'EnglishTxt':
                            checkLimitUrl = "/Tool/CheckDownloadLimit";
                            url = "/Tool/BatchDownloadFulltext";
                            data = { "downloadType": "BatchDownloadFullText", "library": lib, "gids": gids, "curLib": libs, "isDetect": "true" };

                            form = $("<form></form>");
                            form.attr('action', url);
                            form.attr('method', 'post');
                            form.attr('target', '_blank');
                            form.append("<input name='typeName' value='" + catalogType + "'/>");
                            form.append("<input name='keepFields' value='" + keepfields + "'/>");
                            form.append("<input name='keepFblxInFulltext' value='" + keepFblxInFulltext + "'/>");
                            form.append("<input name='keepRelatedFile' value='" + keeprelated + "'/>");
                            form.append("<input name='library' value='" + lib + "'/>");
                            form.append("<input name='flag' value='" + viewType + "'>");
                            form.append("<input name='gids' value='" + gids + "'/>");
                            form.append("<input name='curLib' value='" + libs + "'>");
                            form.append("<input name='downloadType' value='DownloadFullText'>");
                            form.append("<input name='currentUrl' value='" + currentUrl + "'>");

                            break;
                    }

                    if (!checkIsLimited(checkLimitUrl, data)) {
                        form.appendTo("body");
                        form.css('display', 'none');
                        form.submit();
                        form.remove();
                    }
                }
            });
            return false;
        });

        //批量收藏
        $('#batchAddFav').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前弹框打开登录框

                $("#loginBtn").click();
                return false;
            }


            var lib = $("input[name='Library']").val();

            var addList = [];
            $("input[name='recordList']:checkbox:checked").each(function () {
                if ($(this).val() != null && $(this).val() != undefined) {
                    var title = $(this).parent().find("h4").find('a').eq(0).text();
                    if ($(this).parent().find("h4").find('input') == undefined) {
                        var item = {
                            Library: lib,
                            Gid: $(this).val(),
                            Title: title
                        };
                        addList.push(item);
                    } else {
                        var shixiao = $(this).parent().find("h4").find('input').eq(0).val();
                        var item = {
                            Library: lib,
                            Gid: $(this).val(),
                            Title: title,
                            OldShixiaoState: shixiao,
                            ShixiaoState: shixiao,
                        };
                        addList.push(item);
                    }
                }
            });
            addList = JSON.stringify(addList);

            if (addList == "[]") {
                alert("请勾选要收藏的项");
                return false;
            }


            var addurl = "/UserRelated/BatchAddFavorite";

            $.ajax({
                type: "POST",
                url: addurl,
                data: { param: addList },
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                //dataType: "JSON",
                success: function (data) {
                    var jsonObj = eval('(' + data + ')');

                    var suc = jsonObj.success;
                    var exi = jsonObj.exist;
                    var fai = jsonObj.failed;
                    var result = "";
                    //if (suc != "0") {
                    //    result += "收藏成功" + suc + "条  ";
                    //}
                    //if (exi != "0") {
                    //    result += "已经收藏过" + exi + "条 ";
                    //}
                    //if (fai != "0") {
                    //    result += "收藏失败" + fai + "条";
                    //}
                    if (suc != "0" || exi != "0") {
                        result += "收藏成功！";
                    }
                    if (fai != "0") {
                        result += "收藏失败！";
                    }
                    layer.msg(result, {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）                      
                    });
                },
                error: function (data) {
                }
            });
            return false;
        });

        //批量打印
        $('#batchPrint').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }
            var downloadType = $("input:radio[name='batchprint']:checked").val();

            var gids = new Array();
            var libs = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                gids.push($(this).val());
            });
            if (gids.length == 0) {
                alert("请勾选要打印的项");
                return false;
            }
            gids = gids.join(",");
            var lib = $("input[name='Library']").val();
            var orderIndex = $("input[name='OrderByIndex']").val();

            var url = "/Full/BatchPrint";
            //$.ajax({
            //    type: "GET",
            //    url: url,
            //    data: { downloadType: downloadType, library: lib, gids: gids },
            //    contentType: "application/x-www-form-urlencoded; charset=utf-8",
            //    //dataType: "JSON",
            //    success: function (data) {

            //    },
            //    error: function (data) {
            //    }
            //});

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='downloadType' value='" + downloadType + "'/>");
            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gids + "'/>");
            form.append("<input name='libs' value='" + libs + "'>");
            form.append("<input name='orderIndex' value='" + orderIndex + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });

        //批量转发
        $('.batchTransmit').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }

            var gids = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                gids.push($(this).val());
            });
            if (gids.length == 0) {
                alert("请勾选要转发的项");
                return false;
            }
            gids = gids.join(",");
            var lib = $("input[name='Library']").val();
            var orderIndex = $("input[name='OrderByIndex']").val();
            var queryFilter = $('.condition a').text();

            var url = "/Full/BatchTransmitPage";

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gids + "'/>");
            form.append("<input name='orderIndex' value='" + orderIndex + "'/>");
            form.append("<input name='queryFilter' value='" + queryFilter + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });

        //列表单篇文章下载弹窗
        $('.recordDownload').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }

            var library = $("input[name='Library']").val();
            if (library == "gdd") {
                library = $(this).parent().parent().parent().find("input[type='checkbox']").attr("lib");
            }
            var gid = $(this).parent().find("input").val();

            var width = '435px';
            var height = '240px';
            var title = "全文下载";


            if (library != "chl" && library != "lar" && library != "pfnl" && library != "gac") {
                width = "320px";
            }

            var libname = library.substring(0, 2);
            if (libname == "en") {
                width = "453px";
                height = '315px';
                title = "Download";
            }

            $.post("/Full/RecordDownloadFullText", { library: library }, function (html) {

                layer.open({
                    content: html, //内容
                    area: [width, height],
                    title: title, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {
                        $("#downLoadGid").val(gid);
                        $("#gddLib").val(library);
                        $('#recordFullTextDownload').click(function () {
                            downloadSingleFulltext();
                        });
                    }
                });
            });
        });

        //列表单篇全文收藏
        $('.recordAddFavorite').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }

            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();
            var title = $(this).parent().parent().parent().find("h4").find('a').eq(0).text();

            var sddurl = " /usercenter/addfavorite?gid=" + gid + "&library=" + lib + "&title=" + encodeURIComponent(title);

            $.ajax({
                type: "GET",
                url: sddurl,
                dataType: "script",
                contentType: "application/x-www-form-urlencoded; charset=utf-8"
            });

            return false;
        });

        //列表单篇文章打印
        $('.recordPrint').click(function () {

            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录 关闭当前下载框打开登录框

                $("#loginBtn").click();
                return false;
            }


            var downloadType = "FullText";
            var lib = $("input[name='Library']").val();
            if (lib == "gdd") {
                lib = $(this).parent().parent().parent().find("input[type='checkbox']").attr("lib");
            }

            var gid = $(this).parent().find("input").val();
            var libs = new Array();

            var form = $("<form></form>");
            form.attr('action', "/Full/BatchPrint");
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='downloadType' value='" + downloadType + "'/>");
            form.append("<input name='library' value='" + lib + "'/>");
            form.append("<input name='gids' value='" + gid + "'/>");
            form.append("<input name='libs' value='" + libs + "'>");

            var inputs = $("#right_form").find("input");
            for (var i = 0; i < inputs.length; i++) {
                form.append($(inputs[i]).clone());
            }


            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;
        });


        //列表单篇文章转发
        $(".recordTransfer").click(function () {
            var isUserLogin = $("#IsUserLogin").val();
            //用户未登录
            if (isUserLogin != "true") {
                $("#loginBtn").click();
                return false;
            };

            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();
            var title = $(this).parent().parent().parent().find("h4").find('a').eq(0).text();

            return window.open('/Full/TransmitPage?library=' + lib + "&gid=" + gid + "&title=" + encodeURIComponent(title));
        });


        //列表微信分享
        $(".recordShare").click(function () {


            var lib = $("input[name='Library']").val();
            var gid = $(this).parent().find("input").val();

            var codeUrl = "http://" + window.location.host + "/" + lib + "/" + gid + ".html";

            layer.open({
                title: false,
                btn: false,
                shadeClose: true,
                shade: 0.1,
                area: ['105px', '233px'],
                content: '<style>.layui-layer-dialog{min-width:195px!important;}.share-code{width: 155px;}.share-code.code{width:150px;}.share-code p{font-size: 12px;text-align: center;line-height: 18px;}</style><div class="share-code"><div class="code" id="fulltextWeiXinCode"></div><p>用微信扫描二维码<br/>分享至好友或朋友圈</p></div>'
            });


            if (window.browser.name == 'ie' && window.browser.version < 9) {
                $('#fulltextWeiXinCode').qrcode({
                    render: "table", //table方式
                    width: 150,
                    height: 150,
                    text: codeUrl
                });
            } else {
                $('#fulltextWeiXinCode').qrcode({
                    width: 150,
                    height: 150,
                    text: codeUrl
                });
            }
            return;

        });

        //检索列表案例报告(单篇)
        $(".addcasereport").click(function () {

            var isUserLogin = $("#IsUserLogin").val();
            //用户未登录
            if (isUserLogin != "true") {
                $("#loginBuyBtn").click();
                return false;
            } else {
                var authorityType = $("#authorityType").val();
                if (authorityType != "ValidUser") {
                    $("#loginAuthorityBtn").click();
                    return false;
                }
            }

            $U.showProgress();

            var signal = $(this);
            var gid = signal.parent().find("input").val();

            //去数据库取购物车文章
            var existGids = "";
            $.post("/Full/GetShoppingCart", {}, function (data) {
                if (data != "" && data != undefined) {
                    existGids = data;


                    var isExist = $.inArray(gid, existGids.split(','));
                    //-1说明不存在
                    if (isExist == -1) {

                        existGids = existGids + "," + gid;

                        $.post("/Full/AddShoppingCart", { gids: existGids }, function (returnData) {
                            if (returnData != "0") {
                                //文章数量
                                $("span[name='caseReportNum']").html(returnData);
                                $("span[name='caseReportNum']").show();
                                $("#shoppingCartGid").val(existGids);
                                signal.find("i").attr("class", "c-icon c-search-report-off");
                            }
                        });

                        //文章数量
                        //var existCount = existGids.split(',').length;
                        //$('.number').html(existCount);
                        //alert(existCount);

                    } else {
                        signal.find("i").attr("class", "c-icon c-search-report-off");
                        return false;
                    }

                } else {

                    $.post("/Full/AddShoppingCart", { gids: gid }, function (returnData) {
                        if (returnData != "0") {
                            //文章数量
                            $("span[name='caseReportNum']").html(returnData);
                            $("span[name='caseReportNum']").show();
                            $("#shoppingCartGid").val(gid);
                            signal.find("i").attr("class", "c-icon c-search-report-off");
                        }
                    });

                }
            });
            $U.hideProgress();

            //动画效果 数量添加
            $("span[name='caseReportNum']").animate({ 'font-size': '30px', opacity: '0.3' });
            $("span[name='caseReportNum']").animate({ 'font-size': '12px', opacity: '1' });


        });

        //批量案例报告
        $("#batchCaseReport").click(function () {

            var isUserLogin = $("#IsUserLogin").val();
            //用户未登录
            if (isUserLogin != "true") {
                $("#loginBtn").click();
                return false;
            };
            //是否选中
            var isChecked = $("input[name='recordList']:checkbox").is(":checked");
            if (isChecked) {

                //去数据库取购物车文章
                var existGids = "";
                $.post("/Full/GetShoppingCart", {}, function (data) {
                    if (data != null) {
                        existGids = data;

                        var newGids = "";
                        $("input[name='recordList']:checkbox:checked").each(function () {

                            var gid = $(this).val();
                            if (existGids != null && existGids != "") {
                                var isExist = $.inArray(gid, existGids.split(','));
                                //-1说明不存在
                                if (isExist == -1) {
                                    newGids = existGids + "," + gid;
                                    existGids = newGids;
                                }
                            } else {
                                newGids = gid;
                                existGids = gid;
                                $("#shoppingCartGid").val(existGids);
                            }
                        });

                        if (newGids != null && newGids != "") {
                            $U.showProgress();
                            $.post("/Full/AddShoppingCart", { gids: newGids }, function (returnData) {
                                if (returnData != "0") {
                                    //文章数量
                                    //$('.number').html(returnData);
                                    //$('.number').show();

                                    $("span[name='caseReportNum']").html(returnData);
                                    $("span[name='caseReportNum']").show();
                                    $("#shoppingCartGid").val(newGids);

                                    var gids = newGids.split(',');
                                    $.each(gids, function (index, value) {
                                        $(".grid-right").find("input[value='" + value + "']").prev().find("i").attr("class", "c-icon c-search-report-off");
                                    });

                                    $U.hideProgress();
                                }
                            });
                        }
                    }
                });
                //动画效果 数量添加
                //$(".number").animate({ 'font-size': '30px', opacity: '0.3' });
                //$(".number").animate({ 'font-size': '12px', opacity: '1' });
                $("span[name='caseReportNum']").animate({ 'font-size': '30px', opacity: '0.3' });
                $("span[name='caseReportNum']").animate({ 'font-size': '12px', opacity: '1' });


            } else {
                alert("请勾选要加入检索报告的项");
                return false;
            }
            return false;


        });


        //重命名案例报告
        $(".rename").click(function () {

            var reportId = $(this).parent().parent().find("input").val();


            $U.showProgress();

            $.post("UserRelated/ReportEditPage", {}, function (html) {
                $U.hideProgress();
                layer.open({
                    content: html, //内容
                    area: ['300px', '250px'],
                    title: false,
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {


                        $("#confirm").click(function () {

                            var newName = $("#newName").val();

                            if (newName != "" && newName != null) {
                                $("input[name='title']").val(newName);
                                $("input[name='caseReportId']").val(reportId);

                                var form = $("#right_form");
                                form.attr("action", "/usercenter/RenameCaseReport");
                                layer.closeAll();
                                form.submit();
                            } else {
                                return false;
                            }

                        });
                    }
                });
            });
        });

        //删除案例报告
        $(".deleteReport").click(function () {

            var reportId = $(this).parent().parent().find("input").val();
            $("input[name='caseReportId']").val(reportId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReport");

            form.submit();

        });

        //删除案例报告文章
        $(".deleteReportArticle").click(function () {
            var articleId = $(this).parent().parent().find("input[name='listArticleId']").val();
            $("input[name='articleId']").val(articleId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReportArticle");

            form.submit();
        });


        //批量删除案例报告文章
        $(".delete-all").click(function () {

            var articleId = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                articleId.push($(this).parent().parent().find("input[name='listArticleId']").val());
            });
            if (articleId.length == 0) {
                alert("请勾选要删除的项");
                return false;
            }

            var count = articleId.length;
            var pageCount = parseInt($("input[name='Pager.PageSize']").val());

            if (count >= pageCount) {
                var newPageIndex = 0;
                var pageIndex = parseInt($("input[name='Pager.PageIndex']").val());

                if (pageIndex > 0) {
                    newPageIndex = pageIndex - 1;
                    $("input[name='Pager.PageIndex']").val(newPageIndex);
                }

            }


            articleId = articleId.join(",");

            //var articleId = $(this).parent().parent().find("input[name='reportList']").val();
            $("input[name='articleId']").val(articleId);

            var form = $("#right_form");
            form.attr("action", "/usercenter/DeleteCaseReportArticle");

            form.submit();
        });

        //个人中心开始生成案例报告
        $(".transReport").click(function () {

            var casereportGids = new Array();
            $("input[name='recordList']:checkbox:checked").each(function () {
                casereportGids.push($(this).val());
            });
            if (casereportGids.length == 0) {
                alert("请勾选要生成报告的项");
                return false;
            }
            casereportGids = casereportGids.join(",");

            $("input[name='casereportGids']").val(casereportGids);

            $('#oneStep').hide();
            $('#twoStep').show();

        });

        //生成案例报告(上一步)
        $("#twoLastStep").click(function () {
            $('#oneStep').show();
            $('#twoStep').hide();

        });

        //生成案例报告(上上一步)
        $("#threeLastStep").click(function () {
            $('#threeStep').hide();
            $('#twoStep').show();
            $('.grid-left').show();


        });

        //生成案例报告(上上上一步)
        $("#fourLastStep").click(function () {
            $('#fourStep').hide();
            $('#threeStep').show();
        });

        //生成案例报告
        $("#generateReport").click(function () {

            $('#oneStep').hide();
            $('#twoStep').hide();
            $('.grid-left').hide();
            $('#threeStep').show();

            //报告对象
            var reportObjective = $("input[name='ReportObj']:radio:checked").val();
            $("input[name='caseReportObj']").val(reportObjective);

            //报告项目
            var reportItem = new Array();
            $("input[name='ReportItem']:checkbox:checked").each(function () {
                reportItem.push($(this).val());
            });
            reportItem = reportItem.join(",");
            $("input[name='caseReportItem']").val(reportItem);


            var casereportGids = $("input[name='casereportGids']").val();

            $U.showProgress();
            $.post("/Full/GenerateReport", {
                casereportGids: casereportGids,
                reportObjective: reportObjective,
                reportItem: reportItem
            }, function (data) {
                editor.html(data);
                $U.hideProgress();
            });
        });

        //保存案例报告
        $("#caseReportSave").click(function () {

            var content = editor.html();

            if (content == null || content == " ") {
                alert("报告内容不能为空！");
                return false;
            }

            var caseReportId = $("input[name='caseReportId']").val();

            var reportObjective = $("input[name='caseReportObj']").val();
            var reportItem = $("input[name='caseReportItem']").val();

            $.post("/Full/SaveCaseReport", { caseReportId: caseReportId, content: encodeURIComponent(content), reportObj: reportObjective, reportItem: reportItem }, function (data) {
                if (data == "true") {
                    //alert("保存成功");

                    $.post("/usercenter/CaseReportContent", { caseReportId: caseReportId }, function (result) {
                        $('#threeStep').hide();
                        $('#fourStep').show();
                        $('#showCaseReport').html(result);

                        //var gidArray = $("#shoppingCartGid").val();


                        //清空购物车
                        $.post("/Full/DeleteShoppingCart", {}, function (num) {
                            if (num != "0") {
                                //$(".number").html(0);
                                //$("#shoppingCartGid").val("");
                            }
                        });

                    });
                }

            });

        });

        //下载案例报告
        $("#caseReportDownload").click(function () {

            var caseReportId = $("input[name='caseReportId']").val();

            var url = "/Full/DownloadCaseReport";

            var form = $("<form></form>");
            form.attr('action', url);
            form.attr('method', 'post');
            form.attr('target', '_blank');

            form.append("<input name='caseReportId' value='" + caseReportId + "'/>");

            form.appendTo("body");
            form.css('display', 'none');
            form.submit();
            form.remove();
            return false;

        });


        //------案例对比Begin------------------------------------------------------------------------------
        //案例列表页、正文页添加案例对比
        //$(".addCaseCompare").click(function () {
        //    var curBtn = $(this);
        //    if (curBtn.innerText == "已加入对比" || curBtn.innerText == "") {
        //        return;
        //    }
        //    var isUserLogin = $("#IsUserLogin").val();
        //    //用户未登录
        //    if (isUserLogin != "true") {
        //        $("#loginBuyBtn").click();
        //        return false;
        //    } else {
        //        var authorityType = $("#authorityType").val();
        //        if (authorityType != "ValidUser") {
        //            $("#loginAuthorityBtn").click();
        //            return false;
        //        }
        //    }

        //    $U.showProgress();

        //    var signal = $(this);
        //    var gid = signal.attr("curgid");
        //    var lib = $("input[name='Library']").val();
        //    var title = signal.attr("curtitle");
        //    var relatedIfno = signal.attr("relatedIfno");
        //    var catagroy = signal.attr("catagroy");

        //    $.post("/Tool/AddToCaseCompareBox", { library: lib, caseGid: gid, title: title, relatedInfo: relatedIfno, category: catagroy }, function (result) {
        //        $U.hideProgress();
        //        if (result == null) {
        //            return;
        //        }

        //        var resultObj = JSON.parse(result);
        //        var state = resultObj.state;
        //        var message = resultObj.message;
        //        var num = resultObj.num;
        //        if (state == "success") {

        //            signal.html("<i class='c-icon c-contrast-selected'></i>已加入对比");
        //            //文章数量
        //            $("span[name='caseCompareNum']").show();
        //            $("span[name='caseCompareNum']").html(num);

        //            signal.find("i").attr("class", "c-icon c-contrast-selected");

        //            //动画效果 数量添加
        //            $("span[name='caseCompareNum']").animate({ 'font-size': '30px', opacity: '0.3' });
        //            $("span[name='caseCompareNum']").animate({ 'font-size': '12px', opacity: '1' });




        //            $("div[name='caseCompareMore']").each(function () {
        //                if ($(this).attr("style") == "display:inline-block") {
        //                    $(this).attr("style", "display:none");
        //                    var sort = $(this).attr("sort");
        //                    var newTitle = title;
        //                    if (title.Length >= 36) {
        //                        newTitle = title.Substring(0, 35) + "...";
        //                    }

        //                    $("#title_" + sort).attr("style", "display:inline-block");


        //                    $("#title_" + sort).children().first().children().first().attr("title", title).text(newTitle);
        //                    $("#title_" + sort).children().first().next().attr("currgid", gid).attr("title", title);
        //                    return false;
        //                }
        //            });


        //            return;

        //        } else if (state == "haveCase" || state == "failure") {

        //            alert(message);

        //        } else if (state == "moreCase") {

        //            var html = "<div class=\"layer-wrap\"><h4 class=\"title\">案例对比</h4><div class=\"tip-col-wrap\">" +
        //                "<p class=\"tip-col\">每次可最多加入5个案例</p><div class=\"btn-wrap\"><div class=\"two\">" +
        //                "<a href=\"javascript:layer.closeAll()\">确定</a>" +
        //                "</div></div></div></div>";

        //            layer.open({
        //                content: html, //内容
        //                area: ['400px', '220px'],
        //                title: false, //不要标题栏
        //                fix: false, //不随滚动条滚动
        //                move: false, //不可移动
        //                btn: false, //按钮不展示
        //                shade: [0.01, '#000'],
        //                success: function () {
        //                }, cancel: function () {
        //                    layer.closeAll();
        //                    RecordSearch.init();
        //                }
        //            });
        //        }
        //        $('.diff-wrap .block .list-title').each(function () {
        //            let me = $(this);
        //            me.hover(function () {
        //                me.next('.mask').show();
        //                me.next('.mask').animate({
        //                    height: 77,
        //                    opacity: 1
        //                })
        //            })
        //            me.mouseleave(function () {
        //                $(this).next('.mask').animate({
        //                    height: 0,
        //                    opacity: 0,
        //                    callback: function () {
        //                        me.next('.mask').hide();
        //                    }
        //                });
        //            })
        //        });
        //    });

        //});

        //重命名案例对比历史记录
        $(".renameCaseCompare").click(function () {
            var hisId = $(this).attr("hisId");

            var curBtn = $(this);
            var title = curBtn.parent().parent().children().children("a")[0];
            var titleContent = title.text;


            var html = "<div class=\"layer-wrap\"><div class=\"form\"><link rel=\"stylesheet\" href=\"\/Content\/style\/layer-case-report.css\"><ul><li class=\"row\"><div class=\"no-position\"><strong>名称：</strong><div class=\"text\"><input id=\"newCaseHisName\" type=\"text\" value='" + titleContent + "'/></div></div></li><li class=\"row\"><div class=\"btn\"><a href=\"javascript:void(0);\" class=\"search-btn\" name='caseCompareRenameBtn' hisId=" + hisId + " style=\"text-align:left;margin-left:-55px;margin-top:10px\">确定</a></div></li></ul></div></div>";

            layer.open({
                content: html, //内容
                area: ['', ''],
                title: "重命名",
                fix: false, //不随滚动条滚动
                move: false, //不可移动
                btn: false, //按钮不展示           
                shade: [0.01, '#000'],
                success: function () {

                    $("a[name='caseCompareRenameBtn']").click(function () {

                        var curHisId = $(this).attr("hisId");
                        var newName = $("#newCaseHisName").val();

                        $.post("UserRelated/CaseCompareHistoryUpdate", { caseCompareHistoryId: curHisId, newCaseCompareName: newName }, function (result) {

                            layer.closeAll();
                            var resultJson = JSON.parse(result);
                            var resState = resultJson.state;
                            var resMessage = resultJson.rowCount;
                            if (resState == "Y") {
                                title.text = newName;
                            } else if (resState == "N") {
                            }
                        });
                    })
                },
                cancel: function () {
                    layer.closeAll();
                }
            });
        });

        //删除某条案例对比历史记录
        $(".delCaseCompareHistory").click(function () {
            var curBtn = $(this);
            var hisId = curBtn.attr("hisId");
            var history = curBtn.parent().parent();
            $.post("UserRelated/DeleteCompareHistory", { caseCompareHistoryId: hisId }, function (result) {

                layer.closeAll();
                var resultJson = JSON.parse(result);
                var resState = resultJson.state;
                var resMessage = resultJson.rowCount;
                if (resState == "Y") {
                    history.remove();
                } else if (resState == "N") {
                }
            });
        });



        //------案例对比End------------------------------------------------------------------------------


        //法宝词云点击
        $(".wordCloud").click(function () {
            var isUserLogin = $("#IsUserLogin").val();
            //用户未登录
            if (isUserLogin != "true") {
                $("#loginBuyBtn").click();
                return false;
            } else {
                var authorityType = $("#authorityType").val();
                if (authorityType != "ValidUser") {
                    $("#loginAuthorityBtn").click();
                    return false;
                }
            }

            $U.showProgress();
            var keyword = $(this).text();
            if (keyword != "" & keyword != null) {
                var library = $("input[name='Library']").val();
                $.post("/law/Search/GetWordCloud", { keyword: keyword, library: library }, function (result) {

                    var jsonObj = eval('(' + result + ')');
                    if (jsonObj.data != "" && jsonObj.links != "") {
                        var cloudData = eval('(' + jsonObj.data + ')');
                        var cloudLinks = eval('(' + jsonObj.links + ')');

                        layer.open({
                            content: "<div id='wordcloudChart' style='width: 660px;height:530px;'></div>", //内容
                            area: ['700px', '620px'],

                            title: "法宝词云(双击节点跳转新检索)", //不要标题栏
                            fix: false, //不随滚动条滚动
                            move: false, //不可移动
                            btn: false, //按钮不展示           
                            shade: [0.01, '#000'],
                            success: function () {

                                $U.hideProgress();
                                var myChart = echarts.init(document.getElementById('wordcloudChart'));
                                $(myChart).show();

                                option = {
                                    //title: { text: keyword },
                                    tooltip: {
                                        formatter: function (x) {
                                            return x.data.des;
                                        }
                                    },
                                    series: [
                                        {
                                            type: 'graph',
                                            layout: 'force',
                                            //symbolSize: 80,
                                            roam: true,
                                            //edgeSymbol: ['circle', 'arrow'],
                                            edgeSymbolSize: [4, 10],
                                            edgeLabel: {
                                                normal: {
                                                    textStyle: {
                                                        fontSize: 20
                                                    }
                                                }
                                            },
                                            force: {
                                                repulsion: 600,
                                                edgeLength: [60, 80]
                                            },
                                            draggable: true,
                                            focusNodeAdjacency: false,
                                            itemStyle: {
                                                normal: {
                                                    color: '#4b565b'
                                                }
                                            },
                                            lineStyle: {
                                                normal: {
                                                    width: 2,
                                                    color: '#ccc'

                                                }
                                            },
                                            label: {
                                                normal: {
                                                    show: true,
                                                    textStyle: {
                                                        fontSize: 14,
                                                        //color: '#3c3c3c',
                                                        //fontWeight: 'bold'
                                                    }
                                                }
                                            },
                                            data: cloudData,
                                            links: cloudLinks

                                        }
                                    ]
                                };
                                myChart.setOption(option);
                                myChart.on('dblclick', function (params) {

                                    //http://localhost:7599/law/lar?Keywords=%E6%B3%95%E5%BE%8B&SearchKeywordType=Title
                                    var url = "http://" + window.location.host + "/law/" + library + "?Keywords=" + encodeURIComponent(params.value) + "&SearchKeywordType=Title";
                                    window.open(url);
                                });
                                //myChart.on('click', function (params) {

                                // //alert(1);
                                //});
                            }
                        });
                    }
                });
            }

        });

        //导航的分组统计（检索条件）
        $("div.condition,#navbar").find("a[cluster_code]").click(function () {
            var curCli = $(this);

            var curClass = curCli.find('b').text();
            var curClassName = curClass.substring(0, curClass.length - 1);
            var curGroupName = $("#recordgroup").find(".currentSelect").text();
            var lib = $("input[name='Library']").val();

            if (curClassName.toLowerCase() == curGroupName.toLowerCase() || lib == "specialtopic") {

                $("input[name='ShowType']").val("Group");

            }


            var classCodeKey = $("input[name='ClassCodeKey']").val();

            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");

            //获取当前点击项的所属组索引
            var thisClickIndex = $(this).attr("cluster_index") * 1;


            classCodeKeyArray[thisClickIndex] = "";

            classCodeKey = classCodeKeyArray.join(",");

            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);

            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");

            //列表分组项清空
            $("input[name='GroupValue']").val("");

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            var isRecordList = $("input[name='RecordShowType']").val();

            if (isRecordList == "Chart") {
                //$("#main_form").submit();
                var menu = $("input[name='Menu']").val();

                //法宝联想
                var isClinkSearch = $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == undefined || $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == "" ? false : true;

                var classUrl = "/" + menu + "/search/ClassSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    classUrl = "/" + menu + "/findarticle/ClassSearch";
                }
                if (isClinkSearch) {//法宝联想
                    classUrl = "/clink/search/ClassSearch";

                    var clinkTypeId = $(".fl .current").attr("id");//法宝联想类型ID

                    var libraryTab = $(".fblx > li > a.current");
                    var library = libraryTab.attr("library");

                    var grouplibraries = libraryTab.attr("grouplibraries");

                    var menu = libraryTab.attr("menu");

                    var gidtiao = libraryTab.attr("gidtiao");
                    var keyword = $("#subKeywords").val();

                    $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(gidtiao);
                    if (clinkTypeId == "ReferEach") {

                        var tiaoTims = $("input[name='hidTiaoTims']").val();
                        $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(tiaoTims + "#" + gidtiao);

                    } else if (clinkTypeId == "ReferTitle") {
                        var articleGidTiaoNum = $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val();
                        var tims = articleGidTiaoNum.split('#');
                        if (tims.length > 3) { //有款项目
                            tims[3] = "0";
                            tims[4] = "0";
                            tims[5] = "0";
                        }
                        $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(tims.join('#'));
                    }

                    $("input[name='Menu']").val(menu);

                    $("input[name='Library']").val(library);

                    $("input[name='ClassFlag']").val(library);

                    $("input[name='GroupLibraries']").val(grouplibraries);

                    $("input[name='Keywords']").val(keyword);
                    //清空所有的筛选项 
                    $("div.clearFilterItems").empty();
                    //回到首页
                    $("input[name='Pager.PageIndex']").val(0);

                    $.post(classUrl, $("#main_form").serializeArray(), function (result) {
                        $("#leftContent").hide();
                        $("#rightContent").html(result);
                        layer.closeAll();

                    });
                } else {
                    $.post(classUrl, $("#left_form").serializeArray(), function (result) {
                        $("#leftContent").hide();
                        $("#rightContent").html(result);
                        AdvSearch.init();
                        layer.closeAll();
                    });
                }

            } else {
                var pathname = window.location.pathname;

                if (lib == "pfnl" && !pathname.endsWith("rightkeyword")) {

                    ClassResultSearch.CaseClassResultInit(classCodeKey);

                } else {
                    $("#left_form").submit();
                }

                $("#right_form").submit();


                if ($("input[name='Menu']").val() != "case") {
                    $("#subLib_form").submit();
                }
            } 
            curCli.remove();
            var aOts = $('.condition a').length;
            if (aOts == 0) {
                $("#btnSearch").html("开始检索");
                $(".results-btn").attr("style", "display:none;");
            }

        });

        //导航的筛选项
        $("div.condition,#navbar").find("a[filter_value]").click(function () {

            var filterItemName = $(this).attr("prop");

            var filterItemObj = $("input[name='" + filterItemName + "']");

            filterItemObj.val("");

            if (filterItemName == "ExtCondition.GuidingCaseGid") {
                $("input[name='ExtCondition.GuidingCaseGid']").val("");
            }
            var jsonStr = $("input[name='QueryBase64Request']").val();
            if (jsonStr != undefined) {
                var filterSort = $(this).attr('ext_sort');
                var restored = Base64.decode(jsonStr, { to: 'string' });
                //移除隐藏域的条件
                var dataObj = eval("(" + restored + ")");
                var childs = dataObj.ChildNodes;
                childs.splice(filterSort, 1);
                dataObj.ChildNodes = childs;

                $("input[name='QueryBase64Request']").val(Base64.encode(JSON.stringify(dataObj)));
            } else {
                $("input[name='QueryBase64Request']").val();
            }
         

            //结果中检索，关键词置空
            // $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            //$("input[name='GroupValue']").val("");

            //分组置为初始化
            // $("input[name='ShowType']").val("Group");

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);


            if ($("input[name='Library']").val() == "pfnl") {
                ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
            } else {
                $("#left_form").submit();
            }

            $("#right_form").submit();
        });


        //导航的分组
        $("div.condition,#navbar").find("a[group_value]").click(function () {

            var groupIndex = $('input[name=GroupByIndex]').val();
            var orderIndex = $('#recordsort .currentSelect').attr('order_index');

            $("input[name='GroupValue']").val("");
            $("input[name='GroupByIndex']").val(groupIndex);
            $("input[name='ShowType']").val("Group");
            $("input[name='OrderByIndex']").val(orderIndex);
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
            if ($("input[name='Menu']").val() != "case") {
                $("#subLib_form").submit();
            }

        });

        //解决律所和期刊的整体收录情况没有检索条件按钮事件的bug/div.condition,
        $("#navbar").find("a[filter_sort]").click(function () {
            var jsonStr = $("input[name='QueryBase64Request']").val();
            //移除标签
            var filterSort = $(this).attr('filter_sort');

            var isTitleRemove = $(this).attr("title");

            var xClick = $(".condition").find("a[filter_sort=" + filterSort + "]");

            xClick.remove();

            if (isTitleRemove != "") {
                $("input[name='Keywords']").val("");
            }
            if (jsonStr != undefined) {
                var restored = Base64.decode(jsonStr, { to: 'string' });
                //移除隐藏域的条件
                var dataObj = eval("(" + restored + ")");
                var childs = dataObj.ChildNodes;
                childs.splice(filterSort, 1);
                dataObj.ChildNodes = childs;

                $("input[name='QueryBase64Request']").val(Base64.encode(JSON.stringify(dataObj)));

            } else {
                $("input[name='QueryBase64Request']").val();
            }
         

            var filterItemName = $(this).attr("prop");

            var filterItemObj = $("input[name='" + filterItemName + "']");

            filterItemObj.val("");

            //结果中检索，关键词置空
            // $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");

            //分组置为初始化
            // $("input[name='ShowType']").val("Group");
            $("input[name='OrderByIndex']").val(0);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);
            //同义词检索
            var isSynonym = $("#synonym").is(':checked');
            $("input[name='IsSynonymSearch']").val(isSynonym);

            var chartView = $("input[name='RecordShowType']").val();
            if (chartView == "Chart") {
                //$("#main_form").submit();
                var menu = $("input[name='Menu']").val();
                var classUrl = "/" + menu + "/search/ClassSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    classUrl = "/" + menu + "/findarticle/ClassSearch";
                }
                $.post(classUrl, $("#left_form").serializeArray(), function (result) {
                    $("#leftContent").hide();
                    $("#rightContent").html(result);
                });

                var subUrl = "/" + menu + "/search/SubLibrarySearch";
                if (menu == "journal" || menu == "lawfirm") {
                    subUrl = "/" + menu + "/findarticle/SubLibrarySearch";
                }

                $.post(subUrl, $("#subLib_form").serializeArray(), function (result) {
                    $("#subLibContent").html(result);
                    layer.closeAll();
                    SubLibrarySearch.init();

                });
            } else {
                $("#left_form").submit();

                $("#right_form").submit();

                if ($("input[name='Menu']").val() != "case") {
                    $("#subLib_form").submit();
                }
            }
        });


        //检索条件
        $("div.condition").find("a[filter_sort]").click(function () {

            var jsonStr = $("input[name='QueryBase64Request']").val();

            var restored = Base64.decode(jsonStr, { to: 'string' });


            //移除标签
            var filterSort = $(this).attr('filter_sort');

            var isTitleRemove = $(this).attr("title");

            var xClick = $(".condition").find("a[filter_sort=" + filterSort + "]");

            xClick.remove();

            if (isTitleRemove != "") {
                $("input[name='Keywords']").val("");
            }

            //移除隐藏域的条件
            var dataObj = eval("(" + restored + ")");
            var childs = dataObj.ChildNodes;
            childs.splice(filterSort, 1);
            dataObj.ChildNodes = childs;

            $("input[name='QueryBase64Request']").val(Base64.encode(JSON.stringify(dataObj)));

            var filterItemName = $(this).attr("prop");

            var filterItemObj = $("input[name='" + filterItemName + "']");

            filterItemObj.val("");

            //结果中检索，关键词置空
            // $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");

            //分组置为初始化
            // $("input[name='ShowType']").val("Group");
            $("input[name='OrderByIndex']").val(0);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("input[name='RequestFrom']").val('btnSearch');//检索之后置为空

            //同义词检索
            var isSynonym = $("#synonym").is(':checked');
            $("input[name='IsSynonymSearch']").val(isSynonym);
            var lib = $("input[name='Library']").val();

            var chartView = $("input[name='RecordShowType']").val();
            if (chartView == "Chart") {
                //$("#main_form").submit();
                var menu = $("input[name='Menu']").val();
                var classUrl = "/" + menu + "/search/ClassSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    classUrl = "/" + menu + "/findarticle/ClassSearch";
                }
                $.post(classUrl, $("#left_form").serializeArray(), function (result) {
                    $("#leftContent").hide();
                    $("#rightContent").html(result);
                });

                var subUrl = "/" + menu + "/search/SubLibrarySearch";
                if (menu == "journal" || menu == "lawfirm") {
                    subUrl = "/" + menu + "/findarticle/SubLibrarySearch";
                }

                $.post(subUrl, $("#subLib_form").serializeArray(), function (result) {
                    $("#subLibContent").html(result);
                    layer.closeAll();
                    SubLibrarySearch.init();

                });
            } else {
                if (lib == "pfnl") {
                    ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
                } else {
                    $("#left_form").submit();
                }


                $("#right_form").submit();
                if ($("input[name='Menu']").val() != "case") {
                    $("#subLib_form").submit();
                }
            } 
 
            var aOts = $('.condition a').length;
            if (aOts == 0) {
                $("#btnSearch").html("开始检索");
                $(".results-btn").attr("style", "display:none;");
            }

        });

        //检索条件清除
        $("div.oparetion #btn-clear").click(function () {

            $("input[name='QueryBase64Request']").val("");
            $("input[name='ClassCodeKey']").val("");
            $("input[name='GroupValue']").val("");
            $("input[name^='FilterItems']").val("");
            $("input[name^='ExtCondition']").val("");
            $("input[name='OrderByIndex']").val("0");
            $("input[name='Keywords']").val("");
            var lib = $("input[name='Library']").val();

            if (lib == "chl" || lib == "lar" || lib == "pfnl" || lib == "payz" || lib == "gac" || lib == "gdd") {
                $("input[name='ShowType']").val("Group");
                $("input[name='GroupByIndex']").val("0");
            }

            var recordShowType = $("input[name='RecordShowType']").val();
            var menu = $("input[name='Menu']").val();
            if (recordShowType == "Chart") {
                var classUrl = "/" + menu + "/search/ClassSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    classUrl = "/" + menu + "/findarticle/ClassSearch";
                }
                $.post(classUrl, $("#charts_form").serializeArray(), function (result) {

                    $("#rightContent").html(result);
                    layer.closeAll();

                });
            }
            else {
                if (lib == "pfnl") {
                    ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
                } else {
                    $("#left_form").submit();
                    if ($("input[name='Menu']").val() != "case") {
                        $("#subLib_form").submit();
                    }
                }
                $("#right_form").submit();
                // $("#main_form").submit();

            }

            $("#btnSearch").html("开始检索");
            $(".results-btn").attr("style", "display:none;");
            
        });


        //检索条件的保存
        $("div.oparetion #btn-save").click(function () {
            var isUserLogin = $("#IsUserLogin").val();
            //用户未登录
            if (isUserLogin != "true") {
                $("#loginBtn").click();
                return;
            }

            var html = $("#saveCondition-div").html();
            layer.open({
                content: html, //内容
                area: '360px', //宽带400，高度自适应
                title: false, //不要标题栏
                fix: false, //不随滚动条滚动
                move: false, //不可移动
                btn: false, //按钮不展示
                shade: [0.01, '#000'], //遮罩透明度
                shadeClose: true //点击遮罩关闭弹框
            });

            $(".layui-layer-content #saveCondition-savebtn").unbind("click").click(function () {
                if ($(".layui-layer-content #filterName").val() == "") {
                    alert("名称不可以为空！");
                    return false;
                }

                $.ajax({
                    type: "GET",
                    url: $(".layui-layer-content #saveCondition-savebtn").attr("checkurl"),
                    data: { saveName: $(".layui-layer-content #filterName").val() },
                    success: function (result) {

                        $(".form #filterName").focus(function () {
                            $(".form .tips").hide();
                        });

                        if (result == "false") {
                            $(".form .tips").show();
                        } else {
                            var baseRequestValue = $("input[name='QueryBase64Request']").val();
                            var classCodeKey = $("input[name='ClassCodeKey']").val();
                            var filterValue = "";
                            var filterItem = $("#right_form").find("input[name^='FilterItems']");
                            $.each(filterItem, function (n, m) {
                                if (n + 1 < filterItem.length) {
                                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value + "$";
                                } else {
                                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value;
                                }

                            });
                            var extValue = "";
                            var extCondition = $("#right_form").find("input[name^='ExtCondition']");
                            $.each(extCondition, function (l, k) {
                                if (l + 1 < extCondition.length) {
                                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value + "$";
                                } else {
                                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value;
                                }
                            });
                            var matchType = $("input[name='MatchType']").val();

                            //名称+栏目+库别+QueryBase64Request+聚类+筛选+匹配方式+ExtCondition
                            var strFilter = $(".layui-layer-content #filterName").val() + "◆" + $("input[name='Menu']").val() + "◆" + $("input[name='Library']").val() + "◆" + baseRequestValue + "◆" + classCodeKey + "◆" + filterValue + "◆" + matchType + "◆" + extValue;

                            $.ajax(
                                {
                                    url: $("#saveCondition-savebtn").attr("url"),
                                    type: "POST",
                                    data:
                                    {
                                        filterValue: strFilter,
                                        library: $("#saveCondition-savebtn").attr("library"),
                                        saveType: ""
                                    },

                                    success: function (data) {
                                        if (data == "ok") {
                                            layer.closeAll();
                                            layer.msg('保存成功！', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                            return;
                                        } else {
                                            layer.closeAll();
                                            layer.msg('保存失败！', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                            return;
                                        }

                                    }
                                });
                            return false;


                        }
                    }
                });


            });
        });

        //分享按钮
        $("div.oparetion #btn-sharewei").click(function () {
            //先保存 后分享
            var baseRequestValue = $("input[name='QueryBase64Request']").val();
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            var filterValue = "";
            var filterItem = $("#right_form").find("input[name^='FilterItems']");
            $.each(filterItem, function (n, m) {
                if (n + 1 < filterItem.length) {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value + "$";
                } else {
                    filterValue += m.name.replace("FilterItems.", "") + "▲" + m.value;
                }

            });

            var extValue = "";
            var extCondition = $("#right_form").find("input[name^='ExtCondition']");
            $.each(extCondition, function (l, k) {
                if (l + 1 < extCondition.length) {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value + "$";
                } else {
                    extValue += k.name.replace("ExtCondition.", "") + "▲" + k.value;
                }
            });

            var matchType = $("input[name='MatchType']").val();

            var conditionName = "检索条件" + new Date().toLocaleDateString();

            //名称+栏目+库别+QueryBase64Request+聚类+筛选+匹配方式
            var strFilter = conditionName + "◆" + $("input[name='Menu']").val() + "◆" + $("input[name='Library']").val() + "◆" + baseRequestValue + "◆" + classCodeKey + "◆" + filterValue + "◆" + matchType + "◆" + extValue;

            $.ajax(
                {
                    url: $("#saveCondition-savebtn").attr("url"),
                    type: "POST",
                    data:
                    {
                        filterValue: strFilter,
                        library: $("#saveCondition-savebtn").attr("library"),
                        saveType: "share"
                    },

                    success: function (data) {
                        if (data != "no") {

                            var codeUrl = "http://" + window.location.host + "/" + $("input[name='Menu']").val() + "/condition/" + $("input[name='Library']").val() + "?recordId=" + data;

                            layer.open({
                                title: false,
                                btn: false,
                                shadeClose: true,
                                shade: 0.1,
                                area: ['200px', '230px'],
                                content: '<style>.layui-layer-dialog{min-width:195px!important;}.share-code{width: 155px;}.share-code.code{width:150px;}.share-code p{font-size: 12px;text-align: center;line-height: 18px;}</style><div class="share-code"><div class="code" id="qrcodeHolder"></div><p>用微信扫描二维码<br/>分享至好友或朋友圈</p></div>'
                            });
                            $('#qrcodeHolder').qrcode({
                                width: 159,
                                height: 150,
                                text: codeUrl
                            });
                            return;
                        } else {
                            layer.closeAll();
                            layer.msg('分享失败！', {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            });
                            return;
                        }

                    }
                });
        });

        //立法背景资料，这类多库的导航
        $("#ugly").find("a").click(function () {

            var library = $(this).attr("library");

            var grouplibraries = $(this).attr("grouplibraries");

            $("input[name='Library']").val(library);
            $("input[name='ClassFlag']").val(library);

            $("input[name='GroupLibraries']").val(grouplibraries);

            //清空所有的筛选项pagination


            if ($("input[name='IsAdv']").val() != "True") {
                $("div.clearFilterItems").empty();
            }

            //回到首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();

        });

        $("#fblxtxtSearch").keypress(function (e) {
            var key = e.which; //e.which是按键的值 
            if (key == 13) {
                $("#fblxbtnSearch").click();
            }
        }).click(function (e) {
            e = e || window.event;
            if (e.stopPropagation) { //W3C阻止冒泡方法  
                e.stopPropagation();
            } else {
                e.cancelBubble = true; //IE阻止冒泡方法  
            }
        });

        //法宝联想点击其他引用图标
        $(".a-index-list").find(".c-bar").click(function () {

            var curBar = $(this);
            var curClass = curBar.attr("class");
            if (curClass == "c-icon c-bar c-bar-gray") {
                return false;
            } else {

                var gid = curBar.attr("gid");
                var lib = curBar.attr("lib");
                var myDiv = "<div id='otherbar' class='chart-bar' style='height:180px;'></div>";
                layer.open({
                    content: myDiv,
                    area: ['440px', '280px'],
                    title: '其他引用', //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示           
                    shade: [0.01, '#000'],
                    success: function () {
                        staticOtherQuoteBarChart(gid, lib);
                    }
                });
            }
            return true;
        });


        //法宝联想排序按钮点击
        $(".a-index-list").find("th a").click(function () {

            var curOrder = $(this);

            //点击显示当前隐藏其他的
            curOrder.find("i").css('visibility', 'visible');
            curOrder.parent().siblings().find("i").css('visibility', 'hidden');

            //根据点击的库别 修改排序字段 并提交表单
            var curOrderLib = curOrder.attr('order_lib'); //当前点击的排序库
            var curClinkLib = $("input[name='Library']").val(); //当前法宝联想库

            if (curClinkLib == "chl" || curClinkLib == "lar") {

                if (curOrderLib == "law") {
                    $("input[name='OrderByIndex']").val(6);
                } else if (curOrderLib == "case") {
                    $("input[name='OrderByIndex']").val(7);
                } else if (curOrderLib == "journal") {
                    $("input[name='OrderByIndex']").val(8);
                } else { //other
                    $("input[name='OrderByIndex']").val(9);
                }
            }

            if (curClinkLib == "eagn") {
                if (curOrderLib == "law") {
                    $("input[name='OrderByIndex']").val(3);
                } else if (curOrderLib == "case") {
                    $("input[name='OrderByIndex']").val(4);
                } else if (curOrderLib == "journal") {
                    $("input[name='OrderByIndex']").val(5);
                } else { //other
                    $("input[name='OrderByIndex']").val(6);
                }
            }

            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();


        });


        //历审文书点击
        $(".btn-list .history-btn").click(function () {
            var $link = $(this);
            var url = $link.attr('url');
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left;

            $.get(url, null, function (html) {

                layer.open({
                    content: html, //内容
                    area: '650px', //宽带400，高度自适应
                    offset: [off.top, off.left], //定位
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.01, '#000'], //遮罩透明度
                    shadeClose: true //点击遮罩关闭弹框
                });

            });

        });

        //争议焦点  裁判依据点击
        $(".btn-list .FocusAndBasis").click(function () {
            var $link = $(this);
            var url = $link.attr('url');
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left;
            $.get(url, null, function (html) {

                layer.open({
                    content: html, //内容
                    area: '650px', //宽带400，高度自适应
                    offset: [off.top, off.left], //定位
                    title: false, //不要标题栏
                    fix: false, //不随滚动条滚动
                    move: false, //不可移动
                    btn: false, //按钮不展示
                    shade: [0.01, '#000'], //遮罩透明度
                    shadeClose: true //点击遮罩关闭弹框
                });

            });
        });


        //法宝联想其他引用统计方法
        var staticOtherQuoteBarChart = function (gid, lib) {
            var barChartOther = echarts.init(document.getElementById('otherbar'));
            barChartOther.showLoading({
                effect: 'ring',
                text: '图表正在加载中...'
            });
            var urlChartAuthor = virtualPath + "/api/chart/GetOtherQuoteBarChartData" + "?library=" + lib + "&gid=" + gid;
            // 指定图表的配置项和数据
            var barOption = {
                color: ['#3398DB'],
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        // 坐标轴指示器，坐标轴触发有效
                        type: 'none' // 默认为直线，可选为：'line' | 'shadow'
                    },
                    formatter: "{b} <br/>{a} : {c}%"
                },
                grid: {
                    left: '1%',
                    right: '1%',
                    bottom: '3%',
                    top: '3%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        axisLine: {
                            lineStyle: {
                                color: '#c0c0c0'
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            //show: false

                        },
                        data: []
                    }
                ],
                yAxis: [
                    {
                        min: 0,
                        max: 100,
                        axisLabel: {
                            formatter: '{value}%'
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#c0c0c0'
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            //show:false
                            lineStyle: {
                                color: '#f2f2f2'
                            }
                        },
                        type: 'value'
                    }
                ],
                series: [
                    {
                        name: '数量',
                        type: 'bar',
                        barWidth: '18',
                        itemStyle: {
                            // 系列级个性化
                            normal: {
                                color: '#85caf5'
                            },
                            emphasis: {
                                label: { show: false },
                                color: '#4cc5ff'
                            }
                        },
                        markPoint: {
                            //data: [
                            //    { type: 'max', name: '最大值' },
                            //    { type: 'min', name: '最小值' },
                            //    { type: 'average', name: '平均值' }
                            //],
                            label: {
                                normal: {
                                    textStyle: {
                                        fontSize: 10
                                    }
                                }
                            },
                            symbolSize: 60,
                            itemStyle: {
                                // 系列级个性化
                                normal: {
                                    color: '#fe901b'
                                }
                            },
                        },
                        data: [100, 52, 200, 334, 390, 330, 220, 390, 830, 220]
                    }
                ]
            };
            $.get(urlChartAuthor).done(function (result) {

                var nameArray = [];
                var valueArray = [];
                var totalValue = 0;
                var i = 0;
                if (result) {

                    $.each(result, function (n, m) {
                        totalValue += m.count;

                    });

                    $.each(result, function (n, m) {

                        nameArray[i] = m.name;


                        var num = (m.count / totalValue) * 100;

                        valueArray[i] = num.toFixed(2);
                        i++;

                    });


                }
                barOption.xAxis[0].data = nameArray;
                barOption.series[0].data = valueArray;
                barChartOther.hideLoading();
                barChartOther.setOption(barOption);
            });
        }


        //法宝联想检索框
        $("#fblxbtnSearch").click(function (e) {

            var txtSearch = $("#fblxtxtSearch");
            var q = $.trim(txtSearch.val());
            if (q.length == 0) {
                txtSearch.focus();
                e.preventDefault();
            }

            $("input[name='TitleKeywords']").val(q);
            //回到首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });





        //筛选项下拉
        $(".filtrater").each(function () { $(this).Jselect(); });
        //筛选项
        $(".articleSelect > dl > dd").click(function () {


            var dd = $(this);

            var dl = $(this).parent();

            var filterProperty = dl.attr("prop");

            var isAdv = $("input[name='IsAdv']").val();


            var filterItemName = "FilterItems." + filterProperty;
            if (isAdv == "True") {
                filterItemName = "AdvSearchDic." + filterProperty;
            }
            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();
            var clickItemValue = dd.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }
            $("input[name='SearchKeywordType']").val("JournalId");
            filterItemObj.val(clickItemValue);





            //结果中检索，关键词置空
            //$("input[name='TitleKeywords']").val("");

            //修改=>点击筛选项的时候不清空排序跟分组 2017.04.28 zyt
            var groupIndex = $('input[name=GroupByIndex]').val();
            var orderIndex = $('#recordsort .currentSelect').attr('order_index');
            $("input[name='GroupByIndex']").val(groupIndex);
            $("input[name='OrderByIndex']").val(orderIndex);
            var groupVal = $("#recordgroup .currentSelect").text();

            //有分组时选择每页条数筛选项后，应为不分组
            var isMore = false;
            if (filterProperty == "TokenNum") {
                $("input[name='Pager.PageSize']").val(clickItemValue);
                $("input[name='ShowType']").val("Default");
                isMore = true;
            }
            var groupValue = $("input[name='GroupValue']").val();
            if (groupValue != null && groupValue != "") {
                isMore = true;
                $("input[name='Pager.PageSize']").val(clickItemValue);
            }

            //列表分组项清空
            //$("input[name='GroupValue']").val("");

            if (groupVal == "不分组" || groupVal == "不分組" || groupVal == "" || isMore) {
                $("input[name='ShowType']").val("Default");
            } else {
                $("input[name='ShowType']").val("Group");
            }

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }

            $("#left_form").submit();

            $("#right_form").submit();
        });

        //分组
        $(".grouping > a").click(function () {
            var a = $(this);

            var div = $(this).parent();

            var filterProperty = div.attr("prop");

            var filterItemName = "FilterItems." + filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = a.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }
            filterItemObj.val(clickItemValue);

            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");
            //列表分组项清空
            $("input[name='GroupValue']").val("");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);


            if ($("input[name='Library']").val() == "pfnl") {
                ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
            } else {
                $("#left_form").submit();
            }
            $("#right_form").submit();
        });


        $('.filtrater dd').addClassHover();


        //记录排序
        $("#recordsort > a").click(function () {


            $("input[name='AfterSearch']").val('False');
            var is_group = $(this).attr("is_group");
            var groupIndex = $("#recordgroup .currentSelect");
            var groupIndexVal = groupIndex.attr("group_index");
            var groupText = groupIndex.text();

            //分组的情况，分组索引
            if (is_group == "True") {
                $("input[name='GroupByIndex']").val($(this).attr("order_index"));
                $("input[name='ShowType']").val("Group");
                $("input[name='OrderByIndex']").val(0);
            } else if (is_group == "False") {
                if (groupText == "不分组" || groupText == "不分組" || groupText == "List View") { //无分组

                    $("input[name='GroupByIndex']").val(groupIndexVal);
                    $("input[name='ShowType']").val("Default");
                } else {

                    if (groupIndex.length > 0) { //有分组项
                        $("input[name='GroupByIndex']").val(groupIndexVal);
                        $("input[name='ShowType']").val("Group");
                        $("input[name='GroupValue']").val(""); //清空更多
                    }
                }


                var orderIndexObj = $("input[name='OrderByIndex']");

                //var currentOrderIndex = orderIndexObj.val();

                var orderIndex = $(this).attr("order_index");

                //if (currentOrderIndex == orderIndex) {
                //    return;
                //}

                orderIndexObj.val(orderIndex);
                //$("input[name='ShowType']").val("Default");
                //$("input[name='GroupByIndex']").val(0);
            }


            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();

        });

        //个人中心自定义案例报告筛选项
        $(".specialSelect > dl > dd").click(function () {

            var dd = $(this);

            var dl = $(this).parent();

            var filterProperty = dl.attr("prop");

            var filterItemName = "FilterItems." + filterProperty;

            var filterItemObj = $("input[name='" + filterItemName + "']");

            var filterItemValue = filterItemObj.val();

            var clickItemValue = dd.attr("filter_value");

            if (filterItemValue == clickItemValue) {
                return;
            }

            filterItemObj.val(clickItemValue);

            var orderIndex = $('#recordsort .currentSelect').attr('order_index');

            $("input[name='OrderByIndex']").val(orderIndex);

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
            //$("#CaseReportForm").submit();

        });

        //个人中心自定义案例报告排序
        $("#specialsort > a").click(function () {

            var orderIndexObj = $("input[name='OrderByIndex']");

            var orderIndex = $(this).attr("order_index");

            orderIndexObj.val(orderIndex);


            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
            //$("#CaseReportForm").submit();

        });

        //分组
        $("#recordgroup >a").click(function () {

            var groupIndex = $(this).attr("group_index");
            var showName = $(this).text();
            var orderIndex = $("#recordsort .currentSelect");
            var orderIndexVal = orderIndex.attr("order_index");

            if (showName == "不分组" || showName == "不分組" || showName == "List View") { //无分组
                $("input[name='GroupByIndex']").val(groupIndex);
                $("input[name='ShowType']").val("Default");
            } else {
                $("input[name='GroupByIndex']").val(groupIndex);
                $("input[name='ShowType']").val("Group");
                $("input[name='OrderByIndex']").val(orderIndexVal);

            }

            $("input[name='GroupValue']").val("");

            //切换分组时，每页条数重置为10条
            $("input[name='Pager.PageSize']").val("10");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
        });


        //分组效果
        $('.team').addClassHover();
        $('.team a').sortChang();

        //排序效果
        $('.sort').addClassHover();
        $('.sort a').sortChang();


        //分组按钮 保留 高级检索里英文会用到
        $("#recordGroup [name='ckbShowType'] ").click(function () {
            if ($(this).is(':checked')) {
                $("input[name='GroupByIndex']").val(0);
                $("input[name='ShowType']").val("Group");
                //$("input[name='OrderByIndex']").val(0);
            } else {
                $("input[name='ShowType']").val("Default");
                $("input[name='GroupByIndex']").val(0);
            }
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#right_form").submit();
        });

        //列表分组更多
        $(".grouping-title a[groupvalue]").click(function () {
            var groupvalue = $(this).attr("groupvalue");
            $("input[name='GroupValue']").val("");

            $("input[name='ShowType']").val("Default");
            //$("input[name='OrderByIndex']").val(0);
            $("input[name='Pager.PageIndex']").val(0);
            var isAdv = $("input[name='IsAdv']").val();

            $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

            //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
            var thisClickIndex = "";
            thisClickIndex = $(this).attr("clusterIndex") * 1;
            //获取分组统计项值
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");
            classCodeKeyArray[thisClickIndex] = groupvalue;
            classCodeKey = classCodeKeyArray.join(",");
            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);
            $("#right_form").submit();
            if ($("input[name='Library']").val() == "pfnl") {
                ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
            } else {
                $("#left_form").submit();
            }
            if (isAdv != "True" && $("input[name='Menu']").val() != "case") {
                $("#subLib_form").submit();
            }
        });



        //列表底部分组更多
        $(".more a[groupvalue]").click(function () {
            var groupvalue = $(this).attr("groupvalue");
            $("input[name='GroupValue']").val("");

            $("input[name='ShowType']").val("Default");
            //$("input[name='OrderByIndex']").val(0);
            $("input[name='Pager.PageIndex']").val(0);
            var isAdv = $("input[name='IsAdv']").val();
            //获取当前点击项的所属组索引（法规聚类相关提示特殊处理）
            var thisClickIndex = "";
            thisClickIndex = $(this).attr("clusterIndex") * 1;
            //获取分组统计项值
            var classCodeKey = $("input[name='ClassCodeKey']").val();
            //将分组值按，打节，
            var classCodeKeyArray = classCodeKey.split(",");
            classCodeKeyArray[thisClickIndex] = groupvalue;
            classCodeKey = classCodeKeyArray.join(",");
            //重新给分组统计项赋值
            $("input[name='ClassCodeKey']").val(classCodeKey);
            $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());
            $("#right_form").submit();
            if ($("input[name='Library']").val() == "pfnl") {
                ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
            } else {
                $("#left_form").submit();
            }
            if (isAdv != "True" && $("input[name='Menu']").val() != "case") {
                $("#subLib_form").submit();
            }
        });


        $('#subKeywords').keypress(function (e) {
            var key = e.which; //e.which是按键的值 
            if (key == 13) {
                $("#btnSubSearch").click();
            }
        }).click(function (e) {
            e = e || window.event;
            if (e.stopPropagation) { //W3C阻止冒泡方法  
                e.stopPropagation();
            } else {
                e.cancelBubble = true; //IE阻止冒泡方法  
            }
        });


        //在结果中检索
        $("#btnSubSearch").click(function () {

            var Menu = $("input[name='Menu']").val();
            if (Menu != undefined && (Menu == "case" || Menu == "procuratorate")) {
                var isUserLogin = $("#IsUserLogin").val();
                //用户未登录
                if (isUserLogin != "true") {
                    $("#loginBtn").click();
                    return false;
                }
            }
            //法宝联想
            var referenceGid = $("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val();
            $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(referenceGid);


            var newKeywords = $("#subKeywords").val(); //当前输入的搜索内容          
            var lib = $("input[name='Library']").val();
            //如果没变，则不动，讲究一个敌不动，我不动。
            if ($.trim(newKeywords).length == 0) {
                return;
            }

            if (lib == "lbzlaw") {

                $("input[name='TitleKeywords']").val(newKeywords);
            } else {
                $("input[name='Keywords']").val(newKeywords);
            }

            $("input[name='GroupValue']").val("");

            $("input[name='Pager.PageIndex']").val(0);



            if (lib == "pfnl") {
                ClassResultSearch.CaseClassResultInit($("input[name='ClassCodeKey']").val());
            } else {
                $("#left_form").submit();
            }


            $("#right_form").submit();

            if ($("input[name='Menu']").val() != "case") {
                $("#subLib_form").submit();
            }
        });

        //关键词展开命中
        $(".search-hit-box").each(function () {

            //
            var hitBox = $(this);

            //当前条的gid
            var gidFlag = $(this).attr("flag");

            //当前条对应的全文链接
            var fullTextUrl = $(this).siblings("div").first().find("a[flink]").attr("href");
            var expandUrl = $(this).find(".more-hit a").attr("url");
            var HadExpandText = "收起命中", NoExpandText = "展开命中", NoExpandTextt = "展開命中";



            var lib = $("input[name='Library']").val();

            var libSub = lib.substring(0, 3);


            if (libSub == "en_") {

                HadExpandText = "Collapse", NoExpandText = "Expand";
            }


            //第一条命中
            var firstRecordContainer = hitBox.find("p[flag='" + gidFlag + "']");

            //展开命中按钮的容器
            var btnContainer = hitBox.find("div.more-hit[flag='" + gidFlag + "']");

            //分页容器
            var pagecontainer = hitBox.find("div.page[flag='" + gidFlag + "']");

            //展开命中按钮
            var showHitBtn = hitBox.find(".btn");

            var perpage = 5;

            //展开之后要执行的方法
            var afterExpandFun = function () {

                var _ulContainer = hitBox.find("ul[flag='" + gidFlag + "']");

                if (_ulContainer.length > 0) {

                    //_ulContainer.show();
                    _ulContainer.slideDown("slow");

                    if (_ulContainer.children().length > perpage) {

                        pagecontainer.show();
                    }

                    showHitBtn.text(HadExpandText);

                    firstRecordContainer.hide();

                }
            };
            var clickOne = false;
            //展开命中点击事件
            showHitBtn.click(function () {

                var btn = $(this);

                var thisText = btn.text();
                //如果是点击的“展开命中”
                if ((thisText == NoExpandText || thisText == NoExpandTextt) && !clickOne) {

                    if (hitBox.find("ul[flag='" + gidFlag + "']").length > 0) {
                        afterExpandFun();
                        return;
                    }
                    clickOne = true;
                    $.ajax({
                        beforeSend: function () {
                            btn.attr("disabled", true);
                        },
                        type: "POST",
                        url: btn.attr("url"),
                        data: { queryJson: $("input[name='QueryBase64Request']").val() },
                        dataType: "JSON",
                        success: function (data) {

                            console.log(data);
                            if (data.length > 0) {
                                var ulDom = $("<ul flag='" + gidFlag + "'></ul>");

                                btnContainer.before(ulDom);
                                ulDom.hide();
                                $.each(data, function (i, item) {
                                    //var reg = new RegExp("keyword=([^&]*)(&|$)");
                                    //var p = fullTextUrl.match(reg);
                                    //var l = expandUrl.match(reg);
                                    //var curFullTextUrl = fullTextUrl;
                                    //if (p != null && l != null) {

                                    //    curFullTextUrl = fullTextUrl.replace(p[1], l[1]);
                                    //} else {
                                    //    curFullTextUrl = fullTextUrl + "?keyword=" + l[1];

                                    //}
                                    var curFullTextUrl = fullTextUrl;

                                    if (curFullTextUrl.indexOf("keyword") > 0) {

                                        curFullTextUrl = curFullTextUrl + "&tiao=" + (item.HitIndex + 1);
                                    }

                                    ulDom.append(
                                        "<li> <a target='_blank' href='" + curFullTextUrl + "'>" + item.Content + "</a></li>"
                                    );
                                });
                                ulDom.slideDown("slow");

                                if (data.length <= perpage) {

                                    //ulDom.height(data.length * 64);

                                } else {

                                    ulDom.find("li").quickpaginate({
                                        perpage: perpage,
                                        pager: pagecontainer,
                                        showall: false
                                    });
                                }

                                afterExpandFun();
                            }
                        },
                        complete: function () {
                            btn.removeAttr("disabled");
                            clickOne = false;
                        }
                    });
                } else { //如果点击的是“收起命中”

                    hitBox.find("ul[flag='" + gidFlag + "']").slideUp("slow");

                    pagecontainer.hide();

                    firstRecordContainer.show();

                    btn.text(NoExpandText);
                }

            });

        });

        //分页控件
        $(".pagination li").not("[class]").click(function () {

            var btn = $(this);
            var type = typeof (btn);
            var name = $(this).find("input").attr("name");
            if (name == "jumpToNum") {
                return;
            }
            var text = btn.text();
            var menu = $("input[name='Menu']").val();
            var re = /^[0-9]+.?[0-9]*$/;
            var jumpToNum = $("input[name='jumpToNum']").val();

            var pagerIndexObj = $("input[name='Pager.PageIndex']");
            var pagerPageSize = $("#right_form>input[name='Pager.PageSize']").val();

            var pagerIndex = (pagerIndexObj.val() * 1);

            var newpagerIndex = ($(this).find("a").attr("pageindex") * 1) - 1;
            if ((text == "确定" || text == "確定" || text == "Go") && jumpToNum.trim() != "") {
                newpagerIndex = parseInt(jumpToNum) - 1;

            }
            var lastPageIndex = 0;
            $(".pagination>li>a").each(function () {
                if ($(this).text() == "尾页" || $(this).text() == "尾頁" || $(this).text() == "Last") {
                    lastPageIndex = $(this).attr("pageindex");
                }
            })
            if (newpagerIndex >= parseInt(lastPageIndex) && lastPageIndex != 0) {

                var htmlcontent = "<div class=\"layer-wrap\"><h4 class=\"title\">温馨提示</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">尊敬的用户，您好！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;抱歉，您输入的数字超出最大允许翻页数。如果您对检索结果不满意，请修改检索条件进行尝试。</p><div style=\"margin-top:40px;\"><div style=\"text-align:center;margin:0\" class=\"btn-wrap\"><a href=\"javascript:void(0);\" style=\" width: 142px;height: 38px;font-size: 16px;color: white;background: #218fc4;\" onclick=\"layer.closeAll();\" id=\"btnhulue\">确定</a></div></div></div></div>";
                if (menu == "english") {
                    htmlcontent = "<div class=\"layer-wrap\"><h4 class=\"title\">Tips</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">Dear users:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorry, the number you entered has exceeded the maximum number of pages allowed for turning.If you are not satisfied with the search results, please change the search conditions to try again.</p><div style=\"margin-top:40px;\"><div style=\"text-align:center;margin:0\" class=\"btn-wrap\"><a href=\"javascript:void(0);\" style=\" width: 142px;height: 38px;font-size: 16px;color: white;background: #218fc4;\" onclick=\"layer.closeAll();\" id=\"btnhulue\">OK</a></div></div></div></div>";
                }
                layer.open({
                    content: htmlcontent, //内容 
                    area: menu == "english" ? ['560px', '310px'] : ['520px', '290px'], //宽带400，高度自适应
                    title: false, //不要标题栏
                    fix: true, //不随滚动条滚动
                    move: true, //不可移动
                    btn: false, //按钮不展示
                    shade: 0.5, //遮罩透明度
                    shadeClose: false, //点击遮罩关闭弹框
                    cancel: function (index, layero) {


                        $("#newPageIndex").val("");
                        $("input[name='Pager.PageIndex']").val($("input[name='OldPageIndex']").val());
                    }
                });
                $("input[name='jumpToNum']").val("");
                return;
            }
            //如果没变，则不动，讲究一个敌不动，我不动。
            if (pagerIndex == newpagerIndex) {
                return;
            }
            $("#newPageIndex").val(newpagerIndex);
            //获取限制页数
            $.ajax({
                url: "/VerificationCode/GetRecordVerifyListCount",
                type: "POST",
                datatype: 'text',
                async: false,
                success: function (listCountLimit) {

                    //翻页页数达到限制，进行弹窗验证
                    if (pagerPageSize * (newpagerIndex + 1) > listCountLimit) {

                        var isPc = isPcDevice();
                        var url = isPc ? "/VerificationCode/VerificationCodePage" : "/ClickVerify/ClickVerifyPage";
                        $.ajax({
                            url: url, //弹出验证码窗口
                            type: "POST",
                            async: false,
                            beforeSend: function () {
                                AjaxRequestFun.ajaxBegin();
                            },
                            complete: function () {
                                AjaxRequestFun.ajaxComplete();
                            },
                            error: function () {
                                AjaxRequestFun.ajaxFailure();
                            },
                            success: function (html) {

                                $("input[name='OldPageIndex']").val(pagerIndex);
                                pagerIndexObj.val(newpagerIndex);
                                $("input[name='PageIndex']").val(newpagerIndex);
                                layer.open({
                                    content: html, //内容 
                                    area: isPc ? ['340px', '274px'] : ['440px', '240px'], //宽带400，高度自适应
                                    title: false, //不要标题栏
                                    fix: true, //不随滚动条滚动
                                    move: true, //不可移动
                                    btn: false, //按钮不展示
                                    shade: 0.5, //遮罩透明度
                                    shadeClose: false, //点击遮罩关闭弹框
                                    cancel: function (index, layero) {
                                        $("#newPageIndex").val("");
                                        $("input[name='Pager.PageIndex']").val($("input[name='OldPageIndex']").val());
                                    }
                                });
                                $("input[name='jumpToNum']").val("");

                            }
                        });
                    } else {

                        //正常翻页
                        $("input[name='OldPageIndex']").val(pagerIndex);
                        pagerIndexObj.val(newpagerIndex);
                        $("input[name='PageIndex']").val(newpagerIndex);
                        var searchType = $(".tab-nav .current a").attr("searchtype");
                        if (searchType != undefined) {
                            $("input[name='searchType']").val(searchType);
                        }
                        $("#right_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val($("#main_form").find("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val());

                        $("#right_form").submit();
                    }
                }
            });

        });

        function isPcDevice() {
            if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
                /*window.location.href="你的手机版地址";*/
                return false;
            } else {
                /*window.location.href="你的电脑版地址";    */
                return true;
            }
        }

        //引用统计权限判断
        $("a.citeStat").each(function () {
            $(this).click(function () {
                var isUserLogin = $("#IsUserLogin").val();
                //用户未登录
                if (isUserLogin != "true") {
                    $("#loginBuyBtn").click();
                    return false;
                } else {//判断权限类型
                    var authorityType = $("#authorityType").val();
                    if (authorityType != "ValidUser") {
                        $("#loginAuthorityBtn").click();
                        return false;
                    }
                }
            });
        });

        //背景资料，本法变迁  
        $(".isHaveExt").click(function () {
            var $link = $(this);
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left - 400;
            var url = $link.attr("url");
            $.get(url, null, function (html) {
                var verifyLayer = layer.open({
                    content: html,//内容
                    area: '650px',//宽带400，高度自适应
                    offset: [off.top, off.left],//定位
                    title: false,//不要标题栏
                    fix: false,//不随滚动条滚动
                    move: false,//不可移动
                    btn: false,//按钮不展示
                    shade: [0.01, '#000'],//遮罩透明度
                    shadeClose: true//点击遮罩关闭弹框
                });

                $(".layer-wrap a").click(function () {
                    if ($link.text() == "本法变迁") {
                        var isUserLogin = $("#IsUserLogin").val();
                        //用户未登录
                        if (isUserLogin != "true") {
                            $("#loginBuyBtn").click();
                            return false;
                        } else {//判断权限类型
                            var authorityType = $("#authorityType").val();
                            if (authorityType != "ValidUser") {
                                $("#loginAuthorityBtn").click();
                                return false;
                            }
                        }
                    }
                });


            });

        });

        //法宝联想弹框
        $(".isHaveAssociation").click(function () {
            var $link = $(this);
            var off = $link.offset();
            off.top = off.top - $U.getViewPortScrollY();
            off.left = off.left - 400;
            var url = $link.attr("url");
            $.get(url, null, function (html) {

                if (html == "") {
                    html = "暂无数据！";
                }
                layer.open({
                    content: html,//内容
                    area: '650px',//宽带400，高度自适应
                    offset: [off.top, off.left],//定位
                    title: false,//不要标题栏
                    fix: false,//不随滚动条滚动
                    move: false,//不可移动
                    btn: false,//按钮不展示
                    shade: [0.01, '#000'],//遮罩透明度
                    shadeClose: true//点击遮罩关闭弹框
                });

            });

        });


        //点击更多
        $(".author-list .title .more").click(function () {

            var filterVaule = $(this).attr("filterValue");
            $("input[name='ExtCondition.AuthorPy']").val(filterVaule);
            $("input[name='ExtCondition.UnitPy']").val(filterVaule);
            $("input[name='ShowType']").val('Default');
            $("#right_form").submit();

            return false;

        });

        //专题参考书籍展示方式
        $(".view-type > a").click(function () {
            var a = $(this);

            var clickItemValue = a.attr("filter_value");
            var filterItemValue = $("input[name='displayType']").val();

            if (filterItemValue == clickItemValue) {
                return;
            }

            $("input[name='displayType']").val(clickItemValue);

            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").submit();
        });

        $('.view-type a').imagesType();

        //筛选项判断分辨率及数量是否 > 3
        $('.list-filtrater').filtraterWidth();

        //下载目录
        $(".downloadCatalogue").fulltextDown();

        //个人中心 消息点击全部
        $(".tool-bar .tool .c-all").click(function () {

            $("#right_form").find("[name='MsgType']").remove();
            $("#right_form").submit();

        });
        //个人中心 消息点击推荐
        $(".tool-bar .tool #recomend").click(function () {

            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").find("[name='MsgType']").val("Rcommend");
            $("#right_form").submit();

        });
        //个人中心 消息点击账户通知
        $(".tool-bar .tool #inform").click(function () {

            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").find("[name='MsgType']").val("Notice");
            $("#right_form").submit();

        });
        //个人中心 消息点击删除
        $(".tool-bar .tool .btn-delete").click(function () {
            var form = $("#right_form");
            form.find("#opType").val("delete");
            var ids = "";

            $("div.table tr td input[type='checkbox']:checked").each(function (i, item) {
                ids += $(item).attr("id") + ",";
            });
            if (ids == "") {
                alert("请先勾选需要设置的项目");
                return false;
            }
            form.find("#ids").val(ids);
            form.attr("action", $("#msgOpUrl").val());
            form.submit();
        });
        //个人中心 消息点击已读
        $(".tool-bar .tool .btn-readed").click(function () {
            var form = $("#right_form");
            form.find("#opType").val("readed");
            var ids = "";

            $("div.table tr td input[type='checkbox']:checked").each(function (i, item) {
                ids += $(item).attr("id") + ",";
            });
            if (ids == "") {
                alert("请先勾选需要设置的项目");
                return false;
            }
            form.find("#ids").val(ids);
            form.attr("action", $("#msgOpUrl").val());
            //form.attr("data-ajax-success", test());
            form.submit();

        });


        //个人中心 全选
        $("div.table #chkAll").click(function () {


            $("div.table tr td input[type='checkbox']").prop('checked', $(this).prop('checked'));
        });
        //个人中心 收藏删除
        $("div.table .deleteadd").click(function () {
            var form = $("#right_form");
            var me = $(this);
            $("#hidRecordId").val(me.attr("id"));
            form.attr("action", $("#deleteUrl").val());
            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }
            form.submit();
        });
        //个人中心 收藏置顶
        $("div.table .topsort").click(function () {
            var form = $("#right_form");
            var me = $(this);
            $("#hidRecordId").val(me.attr("id"));
            form.attr("action", $("#topSortUrl").val());
            form.submit();
        });
        //个人中心 检索删除
        $("div.table .btn").click(function () {
            var form = $("#right_form");
            var me = $(this);
            $("#hidRecordId").val(me.attr("id"));
            form.attr("action", $("#deleteUrl").val());
            var searchType = $(".tab-nav .current a").attr("searchtype");
            if (searchType != undefined) {
                $("input[name='searchType']").val(searchType);
            }
            form.submit();
        });
        $(".btn-Consent").click(function () {
            var isEng = $("#isEng").val();
            if (isEng == "True") {
                if (!confirm("Are you sure?")) {
                    return false;
                }
            } else {
                if (!confirm("确定同意？")) {
                    return false;
                }
            }

            var msg;
            var userApplyJoinGroupId = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 1, "UserApplyJoinGroupId": userApplyJoinGroupId },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                window.location.href = "/UserCenter/BindAccountManager";
            } else {
                alert("获取用户信息失败！");
            }
        });

        $(".btn-unConsent").click(function () {
            if (!confirm("确定不同意？")) {
                return false;
            }
            var msg;
            var userApplyJoinGroupId = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 2, "UserApplyJoinGroupId": userApplyJoinGroupId },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                window.location.href = "/UserCenter/BindAccountManager";
            } else {
                alert("获取用户信息失败！");
            }
        });
        $(".btn-Relieve").click(function () {
            if (!confirm("确定解除绑定？")) {
                return false;
            }
            var msg;
            var Id = $(this).siblings("input[name='hidValue']").val();
            $.ajax({
                type: "POST",
                cache: false,
                url: "/UserCenter/BindManagerOperation",
                dataType: "text",
                data: { "BindMessage": 3, "UserApplyJoinGroupId": Id },
                async: false,
                success: function (data) {
                    msg = data;
                }
            });
            if (msg == "ok") {
                $(".binders > a[filter_value='havebind']").click();
            }
        });
        //绑定和未绑定的选择
        $(".binders > a").click(function () {
            var filterItemName = "FilterItems.BindState";
            var filterItemObj = $("input[name='" + filterItemName + "']");
            var filterItemValue = filterItemObj.val;
            var clickItemValue = $(this).attr("filter_value");
            if (filterItemValue == clickItemValue) {
                return;
            }
            filterItemObj.val(clickItemValue);
            //结果中检索，关键词置空
            $("input[name='TitleKeywords']").val("");
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            $("#left_form").submit();

            $("#right_form").submit();
        });
        //绑定管理页搜索
        $(".userSearch").click(function () {
            var serachName = $("input[name='TitleKeywords']").val();
            $("input[name='SearchName']").val(serachName);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);
            $("#left_form").submit();

            $("#top_form").submit();
        });

        //个人中心 搜索记录tab切换事件
        $(".tab-nav a").click(function () {
            $(this).parent().addClass("current");
            $(this).parent().siblings().removeClass("current");
            // alert($(this).attr("searchType"));
            var searchType = $(this).attr("searchType");
            var filterItem = $("#articleSelect").find("dl .currentSelect");
            var filterProperty = filterItem.attr("prop");
            var filterItemName = "FilterItems." + filterProperty;
            var filterItemObj = $("input[name='" + filterItemName + "']");
            var clickItemValue = filterItem.attr("filter_value");
            filterItemObj.val(clickItemValue);
            $("input[name='searchType']").val(searchType);
            $("input[name='Pager.PageIndex']").val(0);
            $("#right_form").submit();


        });

        //专题参考 首页推荐更多
        $(".block-list .title").find("a.more").click(function () {

            var code = $(this).attr("code") + ",,,";
            $("input[name='ClassCodeKey']").val(code);
            //分页置为首页
            $("input[name='Pager.PageIndex']").val(0);

            var lib = $("input[name='Library']").val();

            if (lib == "specialtopic") {
                $("input[name='ShowType']").val("Default");
            }

            $("#left_form").submit();

            $("#right_form").submit();

        });


        $('.btnAudio').click(function () {
            if ('true' != $('#IsUserLogin').val()) {
                $("#loginBtn").click();
                return false;
            }
            return true;
        });



        var allemail = $('#allemail');
        if (allemail != undefined && allemail.length > 0) {
            $('#allemail').autoMail({
                emails: ['163.com', '126.com', 'qq.com', 'sina.com', 'sohu.com', 'yahoo.cn', 'gmail.com', 'hotmail.com', 'live.cn']
            });
        }

        $("a[name='returnAll']").click(function () {
            var rootUrl = window.location.pathname;
            var reg = new RegExp(/condition/, 'gi');
            if (reg.test(rootUrl)) {
                rootUrl = rootUrl.replace('condition', '');
            }
            var reg1 = /allsearch/i;
            var result = reg1.test(rootUrl);
            if (result) {
                rootUrl = rootUrl.replace('allsearch', 'searchall');
            }
            window.location.href = rootUrl;
        });

        //----------可视化功能Begin--------------------------------------------------------------------------------------------------
        //切换到图表
        $("a[name='btnChangeToChart']").click(function () {
            var menu = $("#input[name='Menu']").val();
            //1、判断登录
            var isLogin = $("#IsUserLogin").val(); //是否登录的标志
            if (isLogin != "true") { //没登录
                var menuName = $("div.main-nav").find("li.current").find("a").text();
                var html = "<div class=\"layer-wrap\"><h4 class=\"title\">登录提示</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您好，此功能仅限购买[<label style=\"color:red\">" + menuName + "</label>]付费会员专享。<br>您可以进行如下操作：</p><br>" +
                    "<div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"https://login.pkulaw.com/\">付费会员登录</a>" +
                    "<a target =\"_blank\" href =\"https://login.pkulaw.com/registerlayer\" >注册试用</a></div></div><div class=\"go-on\">" +
                    "<a href =\"javascript:void(0);\" id=\"btnhulue\">继续浏览</a></div></div></div> ";

                var layerLogin = layer.open({
                    type: 1,
                    title: false, //不显示标题  
                    area: ['520px', '300px'],
                    offset: 'auto',
                    btn: false,
                    move: false, //不可移动
                    content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                    shade: [0.05, '#000'], //遮罩透明度
                    shadeClose: false, //点击遮罩关闭弹框
                    success: function () {
                        $('#btnhulue').click(function () {
                            layer.close(layerLogin);
                        });
                    }
                });
                return false;
            }
            //2、判断权限
            var menu = $("input[name='Menu']").val();
            $.ajax({
                url: "/charts/IsHaveMenuRight?currentMenu=" + menu,
                type: "POST",
                success: function (result) {

                    //无权限提示
                    if (result == "False") {

                        var menuName = $("div.main-nav").find("li.current").find("a").text();

                        var html = "<div class=\"layer-wrap\"><h4 class=\"title\">您已登录北大法宝</h4><div class=\"tip-col-wrap\"><p class=\"tip-col\">您好，此功能仅限购买[<label style=\"color:red\">" + menuName + "</label>]或绑定有[<label style=\"color:red\">" + menuName + "</label>]权限账号的会员使用。<br>您可以进行如下操作：</p><br>" +
                            "<div class=\"btn-wrap\"><div class=\"two\"><a target=\"_blank\" href=\"https://www.pkulaw.com/BuyBdfb/63.html\">购买</a>" +
                            "<a target =\"_blank\" href =\"https://pkulaw.com/usercenter/bindaccount/False\" >绑定账号</a></div></div><div class=\"go-on\">" +
                            "<a href =\"javascript:void(0);\" id=\"btnhulue\" onclick=\"layer.closeAll()\">继续浏览</a></div></div></div> ";
                        layer.open({
                            type: 1,
                            title: false, //不显示标题  
                            area: ['520px', ''],
                            offset: 'auto',
                            btn: false,
                            move: false, //不可移动
                            content: html, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                            shade: [0.05, '#000'], //遮罩透明度
                            shadeClose: false, //点击遮罩关闭弹框
                            success: function () {
                            }
                        });
                        return false;
                    }
                    else {
                        //有权限跳转
                        layer.load(1, { shade: [0.1, '#fff'] });
                        $("input[name='RecordShowType']").val("Chart");
                        var menu = $("input[name='Menu']").val();

                        //高级检索
                        var isAdvSearch = $("input[name='IsAdv']").val();

                        //法宝联想
                        var isClinkSearch = $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == undefined || $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == "" ? false : true;

                        var classUrl = "/" + menu + "/search/ClassSearch";
                        if (menu == "journal" || menu == "lawfirm") {
                            classUrl = "/" + menu + "/findarticle/ClassSearch";
                        }

                        if (isAdvSearch == "True") {
                            $.post(classUrl, $("#left_form").serializeArray(), function (result) {

                                $("#leftContent").hide();
                                $("#rightContent").html(result);
                                AdvSearch.init();
                                layer.closeAll();

                            });


                        } else if (isClinkSearch) {//法宝联想
                            classUrl = "/clink/search/ClassSearch";

                            var clinkTypeId = $(".fl .current").attr("id");//法宝联想类型ID

                            var libraryTab = $(".fblx > li > a.current");
                            var library = libraryTab.attr("library");

                            var grouplibraries = libraryTab.attr("grouplibraries");

                            var menu = libraryTab.attr("menu");

                            var gidtiao = libraryTab.attr("gidtiao");
                            var keyword = $("#subKeywords").val();

                            $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(gidtiao);
                            if (clinkTypeId == "ReferEach") {

                                var tiaoTims = $("input[name='hidTiaoTims']").val();
                                $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(tiaoTims + "#" + gidtiao);

                            } else if (clinkTypeId == "ReferTitle") {
                                var articleGidTiaoNum = $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val();
                                var tims = articleGidTiaoNum.split('#');
                                if (tims.length > 3) { //有款项目
                                    tims[3] = "0";
                                    tims[4] = "0";
                                    tims[5] = "0";
                                }
                                $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val(tims.join('#'));
                            }

                            $("input[name='Menu']").val(menu);

                            $("input[name='Library']").val(library);

                            $("input[name='ClassFlag']").val(library);

                            $("input[name='GroupLibraries']").val(grouplibraries);

                            $("input[name='Keywords']").val(keyword);
                            //清空所有的筛选项 
                            $("div.clearFilterItems").empty();
                            //回到首页
                            $("input[name='Pager.PageIndex']").val(0);

                            $.post(classUrl, $("#main_form").serializeArray(), function (result) {
                                $("#leftContent").hide();
                                $("#rightContent").html(result);
                                layer.closeAll();

                            });
                        }
                        else {

                            $.post(classUrl, $("#left_form").serializeArray(), function (result) {
                                $("#leftContent").hide();
                                $("#rightContent").html(result);

                            });

                            var subUrl = "/" + menu + "/search/SubLibrarySearch";
                            if (menu == "journal" || menu == "lawfirm") {
                                subUrl = "/" + menu + "/findarticle/SubLibrarySearch";
                            }

                            $.post(subUrl, $("#subLib_form").serializeArray(), function (result) {
                                $("#subLibContent").html(result);
                                layer.closeAll();
                                SubLibrarySearch.init();

                            });
                        }
                    }
                }
            });
        });

        //切换到列表
        $("a[name='btnChangeToList']").click(function () {

            var isClinkSearch = $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == undefined || $("input[name='ExtCondition.ReferenceArticleGidTiaoNum']").val() == "" ? false : true;
            $("input[name='RecordShowType']").val("List");
            var isAdvSearch = $("input[name='IsAdv']").val();
            var menu = $("input[name='Menu']").val();
            var lib = $("input[name='Library']").val();
            var classCodeKey = $("input[name='ClassCodeKey']").val();

            layer.load(1, { shade: [0.1, '#fff'] });

            if (isClinkSearch) {
                $(".fblx > li > a.current").click();

            } else {
                var recordUrl = "/" + menu + "/search/RecordSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    recordUrl = "/" + menu + "/findarticle/RecordSearch";
                }

                $.post(recordUrl, $("#charts_form").serializeArray(), function (result) {
                    $("#rightContent").html(result);

                    RecordSearch.init();
                });

                var classUrl = "/" + menu + "/search/ClassSearch";
                if (menu == "journal" || menu == "lawfirm") {
                    classUrl = "/" + menu + "/findarticle/ClassSearch";
                }
                if (lib == "pfnl") {
                    $("#leftContent").show();
                    ClassResultSearch.init();
                    ClassResultSearch.CaseClassResultInit(classCodeKey);
                    layer.closeAll();

                } else {
                    $.post(classUrl, $("#charts_form").serializeArray(), function (result) {

                        $("#leftContent").html(result);
                        layer.closeAll();
                        $("#leftContent").show();
                        ClassResultSearch.init();
                    });
                }

                if (isAdvSearch != "True" && !isClinkSearch) {
                    $("#subLib_form").submit();
                }
            }
        });

        //----------可视化功能end--------------------------------------------------------------------------------------------------
    },


    dispose: function () {
        $('.areajSelect').unbind();
        $('.subjSelect').unbind();
        $('.list-filtrater').unbind();
        $('.list-filtrater .oparetion .down-all').unbind();
        $("#fblxtxtSearch").unbind();
        $('.tools-box').unbind();
        $('#choose-all').unbind();
        $('#checkReportItems').unbind();
        $('.print-all').unbind();
        $("#ugly").find("a").unbind();
        $(".filtrater").unbind();
        $('.filtrater dd').unbind();
        $(".articleSelect > dl > dd").unbind();
        $('#recordsort').unbind();
        $('#recordsort > a').unbind();
        $("#btnSubSearch").unbind();
        $(".pagination li").not("[class]").unbind();
        $(".grouping > a").unbind();
        $(".search-hit-box").unbind();
        $(".search-hit-box").find(".btn").unbind();
        $(".isHaveExt").unbind();
        $("div.condition").find("a").unbind();
        $("div.condition,#navbar").find("a[cluster_code]").unbind();
        $("div.condition,#navbar").find("a[filter_value]").unbind();
        $("div.condition,#navbar").find("a[group_value]").unbind();
        $("div.condition").find("a[filter_sort]").unbind();
        $("div.oparetion #btn-clear").unbind();
        $("div.oparetion #btn-save").unbind();
        $("div.oparetion #btn-sharewei").unbind();
        $(".more").unbind();
        $("#recordGroup [name='ShowType']").unbind();
        $("#recordGroup [name='ckbShowType']").unbind();
        $("#recordgroup >a").unbind();
        $('#batchDownload').unbind();
        $('#batchAddFav').unbind();
        $('#batchPrint').unbind();
        $('.recordDownload').unbind();
        $('.recordAddFavorite').unbind();
        $('.recordPrint').unbind();
        $('.recordTransfer').unbind();
        $('.recordShare').unbind();
        $('.batchTransmit').unbind();
        $('#batchCaseReport').unbind();
        $('#generateReport').unbind();
        $('.addcasereport').unbind();
        //$('.casereport').unbind();
        $(".wordCloud").unbind();
        $(".rename").unbind();
        $(".deleteReport").unbind();
        $(".deleteReportArticle").unbind();
        $(".delete-all").unbind();
        $(".transReport").unbind();
        $("#twoLastStep").unbind();
        $("#threeLastStep").unbind();
        $("#fourLastStep").unbind();
        $("#generateReport").unbind();
        $("#caseReportSave").unbind();
        $("#caseReportDownload").unbind();
        $(".a-index-list").find(".c-bar").unbind();
        $(".a-index-list").find("th a").unbind();
        $(".btn-list .history-btn").unbind();
        $(".btn-list .FocusAndBasis").unbind();
        $("#fblxbtnSearch").unbind();
        $(".specialSelect > dl > dd").unbind();
        $("#specialsort > a").unbind();
        $('.sort').unbind();
        $('.sort a').unbind();
        $('.team').unbind();
        $('.team a').unbind();
        $(".grouping-title a[groupvalue]").unbind();
        $(".more a[groupvalue]").unbind();
        $('#subKeywords').unbind();
        $("a.citeStat").unbind();
        $(".isHaveAssociation").unbind();
        $(".author-list .title .more").unbind();
        $(".view-type > a").unbind();
        $('.view-type a').unbind();
        $(".downloadCatalogue").unbind();
        $('.btnAudio').unbind();
        $(".addCaseCompare").unbind();
        //$("div[name='delCaseFromBox']").unbind();
        //$("#removeAll").unbind();
        $("a[name='btnChangeToChart']").unbind();
        $("a[name='btnChangeToList']").unbind();
    },
    getCatalogDownLoadAllFields: function () {
        var lib = $("input[name='Library']").val();
        $.ajax({
            url: "/full/GetCatalogDownLoadFields",
            type: "POST",
            async: false,
            data: {
                "library": lib
            },
            success: function (results) {
                return results;
            }, error: function () {

            }
        });
    }

}

var Show_reply = function (r) {
    if (r == 1)
        layer.msg('收藏成功！', {
            icon: 1,
            time: 2000//2秒关闭（如果不配置，默认是3秒）                      
        });
    else if (r == 2)
        layer.msg('收藏成功！', {
            icon: 1,
            time: 2000//2秒关闭（如果不配置，默认是3秒）                      
        });
    else {
        alert('收藏失败！');
    }
};
;
